


<!DOCTYPE html>
<html class="writer-html5" lang="en" >
<head>
  <meta charset="utf-8" />
  
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  
  <title>qutip.qip.circuit &mdash; QuTiP 4.7 Documentation</title>
  

  
  <link rel="stylesheet" href="../../../_static/css/theme.css" type="text/css" />
  <link rel="stylesheet" href="../../../_static/pygments.css" type="text/css" />
  <link rel="stylesheet" href="../../../_static/gallery.css" type="text/css" />
  <link rel="stylesheet" href="../../../_static/gallery-binder.css" type="text/css" />
  <link rel="stylesheet" href="../../../_static/gallery-dataframe.css" type="text/css" />
  <link rel="stylesheet" href="../../../_static/gallery-rendered-html.css" type="text/css" />
  <link rel="stylesheet" href="../../../_static/site.css" type="text/css" />

  
  
    <link rel="shortcut icon" href="../../../_static/favicon.ico"/>
  

  
  

  

  
  <!--[if lt IE 9]>
    <script src="../../../_static/js/html5shiv.min.js"></script>
  <![endif]-->
  
    
      <script type="text/javascript" id="documentation_options" data-url_root="../../../" src="../../../_static/documentation_options.js"></script>
        <script src="../../../_static/jquery.js"></script>
        <script src="../../../_static/underscore.js"></script>
        <script src="../../../_static/doctools.js"></script>
    
    <script type="text/javascript" src="../../../_static/js/theme.js"></script>

    
    <link rel="index" title="Index" href="../../../genindex.html" />
    <link rel="search" title="Search" href="../../../search.html" />
    <link rel="copyright" title="Copyright" href="../../../copyright.html" /> 
</head>

<body class="wy-body-for-nav">

   
  <div class="wy-grid-for-nav">
    
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search" >
          

          
            <a href="../../../index.html" class="icon icon-home"> QuTiP: Quantum Toolbox in Python
          

          
          </a>

          
            
            
              <div class="version">
                4.7
              </div>
            
          

          
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="../../../search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>

          
        </div>

        
        <div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="main navigation">
          
            
            
              
            
            
              <ul>
<li class="toctree-l1"><a class="reference internal" href="../../../frontmatter.html">Frontmatter</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../installation.html">Installation</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../guide/guide.html">Users Guide</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../gallery/build/index.html">Gallery</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../apidoc/apidoc.html">API documentation</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../changelog.html">Change Log</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../contributors.html">Developers</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../development/development.html">Development Documentation</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../biblio.html">Bibliography</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../copyright.html">Copyright and Licensing</a></li>
</ul>

            
          
        </div>
        
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap">

      
      <nav class="wy-nav-top" aria-label="top navigation">
        
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="../../../index.html">QuTiP: Quantum Toolbox in Python</a>
        
      </nav>


      <div class="wy-nav-content">
        
        <div class="rst-content">
        
          

















<div role="navigation" aria-label="breadcrumbs navigation">

  <ul class="wy-breadcrumbs">
    
      <li><a href="../../../index.html" class="icon icon-home"></a> &raquo;</li>
        
          <li><a href="../../index.html">Module code</a> &raquo;</li>
        
      <li>qutip.qip.circuit</li>
    
    
      <li class="wy-breadcrumbs-aside">
        
      </li>
    
  </ul>

  
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
            
  <h1>Source code for qutip.qip.circuit</h1><div class="highlight"><pre>
<span></span><span class="kn">from</span> <span class="nn">collections.abc</span> <span class="kn">import</span> <span class="n">Iterable</span>
<span class="kn">from</span> <span class="nn">itertools</span> <span class="kn">import</span> <span class="n">product</span>
<span class="kn">import</span> <span class="nn">numbers</span>

<span class="kn">import</span> <span class="nn">warnings</span>
<span class="kn">import</span> <span class="nn">inspect</span>

<span class="kn">import</span> <span class="nn">numpy</span> <span class="k">as</span> <span class="nn">np</span>
<span class="kn">from</span> <span class="nn">copy</span> <span class="kn">import</span> <span class="n">deepcopy</span>

<span class="kn">from</span> <span class="nn">qutip.qip</span> <span class="kn">import</span> <span class="n">circuit_latex</span> <span class="k">as</span> <span class="n">_latex</span>
<span class="kn">from</span> <span class="nn">qutip.qip.operations.gates</span> <span class="kn">import</span> <span class="p">(</span><span class="n">rx</span><span class="p">,</span> <span class="n">ry</span><span class="p">,</span> <span class="n">rz</span><span class="p">,</span> <span class="n">sqrtnot</span><span class="p">,</span> <span class="n">snot</span><span class="p">,</span> <span class="n">phasegate</span><span class="p">,</span>
                                        <span class="n">x_gate</span><span class="p">,</span> <span class="n">y_gate</span><span class="p">,</span> <span class="n">z_gate</span><span class="p">,</span> <span class="n">cy_gate</span><span class="p">,</span>
                                        <span class="n">cz_gate</span><span class="p">,</span> <span class="n">s_gate</span><span class="p">,</span> <span class="n">t_gate</span><span class="p">,</span> <span class="n">cs_gate</span><span class="p">,</span>
                                        <span class="n">qasmu_gate</span><span class="p">,</span> <span class="n">ct_gate</span><span class="p">,</span> <span class="n">cphase</span><span class="p">,</span> <span class="n">cnot</span><span class="p">,</span>
                                        <span class="n">csign</span><span class="p">,</span> <span class="n">berkeley</span><span class="p">,</span> <span class="n">swapalpha</span><span class="p">,</span> <span class="n">swap</span><span class="p">,</span>
                                        <span class="n">iswap</span><span class="p">,</span> <span class="n">sqrtswap</span><span class="p">,</span> <span class="n">sqrtiswap</span><span class="p">,</span> <span class="n">fredkin</span><span class="p">,</span>
                                        <span class="n">toffoli</span><span class="p">,</span> <span class="n">controlled_gate</span><span class="p">,</span> <span class="n">globalphase</span><span class="p">,</span>
                                        <span class="n">expand_operator</span><span class="p">,</span> <span class="n">gate_sequence_product</span><span class="p">)</span>
<span class="kn">from</span> <span class="nn">qutip</span> <span class="kn">import</span> <span class="n">tensor</span><span class="p">,</span> <span class="n">basis</span><span class="p">,</span> <span class="n">identity</span><span class="p">,</span> <span class="n">ket2dm</span>
<span class="kn">from</span> <span class="nn">qutip.qobj</span> <span class="kn">import</span> <span class="n">Qobj</span>
<span class="kn">from</span> <span class="nn">qutip.measurement</span> <span class="kn">import</span> <span class="n">measurement_statistics</span>


<span class="k">try</span><span class="p">:</span>
    <span class="kn">from</span> <span class="nn">IPython.display</span> <span class="kn">import</span> <span class="n">Image</span> <span class="k">as</span> <span class="n">DisplayImage</span><span class="p">,</span> <span class="n">SVG</span> <span class="k">as</span> <span class="n">DisplaySVG</span>
<span class="k">except</span> <span class="ne">ImportError</span><span class="p">:</span>
    <span class="c1"># If IPython doesn&#39;t exist, then we set the nice display hooks to be simple</span>
    <span class="c1"># pass-throughs.</span>
    <span class="k">def</span> <span class="nf">DisplayImage</span><span class="p">(</span><span class="n">data</span><span class="p">,</span> <span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
        <span class="k">return</span> <span class="n">data</span>

    <span class="k">def</span> <span class="nf">DisplaySVG</span><span class="p">(</span><span class="n">data</span><span class="p">,</span> <span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
        <span class="k">return</span> <span class="n">data</span>

<span class="n">__all__</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;Gate&#39;</span><span class="p">,</span> <span class="s1">&#39;QubitCircuit&#39;</span><span class="p">,</span> <span class="s1">&#39;Measurement&#39;</span><span class="p">,</span>
           <span class="s1">&#39;CircuitResult&#39;</span><span class="p">,</span> <span class="s1">&#39;CircuitSimulator&#39;</span><span class="p">]</span>

<span class="n">_single_qubit_gates</span> <span class="o">=</span> <span class="p">[</span><span class="s2">&quot;RX&quot;</span><span class="p">,</span> <span class="s2">&quot;RY&quot;</span><span class="p">,</span> <span class="s2">&quot;RZ&quot;</span><span class="p">,</span> <span class="s2">&quot;SNOT&quot;</span><span class="p">,</span> <span class="s2">&quot;SQRTNOT&quot;</span><span class="p">,</span> <span class="s2">&quot;PHASEGATE&quot;</span><span class="p">,</span>
                       <span class="s2">&quot;X&quot;</span><span class="p">,</span> <span class="s2">&quot;Y&quot;</span><span class="p">,</span> <span class="s2">&quot;Z&quot;</span><span class="p">,</span> <span class="s2">&quot;S&quot;</span><span class="p">,</span> <span class="s2">&quot;T&quot;</span><span class="p">,</span> <span class="s2">&quot;QASMU&quot;</span><span class="p">]</span>
<span class="n">_para_gates</span> <span class="o">=</span> <span class="p">[</span><span class="s2">&quot;RX&quot;</span><span class="p">,</span> <span class="s2">&quot;RY&quot;</span><span class="p">,</span> <span class="s2">&quot;RZ&quot;</span><span class="p">,</span> <span class="s2">&quot;CPHASE&quot;</span><span class="p">,</span> <span class="s2">&quot;SWAPalpha&quot;</span><span class="p">,</span> <span class="s2">&quot;PHASEGATE&quot;</span><span class="p">,</span>
               <span class="s2">&quot;GLOBALPHASE&quot;</span><span class="p">,</span> <span class="s2">&quot;CRX&quot;</span><span class="p">,</span> <span class="s2">&quot;CRY&quot;</span><span class="p">,</span> <span class="s2">&quot;CRZ&quot;</span><span class="p">,</span> <span class="s2">&quot;QASMU&quot;</span><span class="p">]</span>
<span class="n">_ctrl_gates</span> <span class="o">=</span> <span class="p">[</span><span class="s2">&quot;CNOT&quot;</span><span class="p">,</span> <span class="s2">&quot;CSIGN&quot;</span><span class="p">,</span> <span class="s2">&quot;CRX&quot;</span><span class="p">,</span> <span class="s2">&quot;CRY&quot;</span><span class="p">,</span> <span class="s2">&quot;CRZ&quot;</span><span class="p">,</span> <span class="s2">&quot;CY&quot;</span><span class="p">,</span> <span class="s2">&quot;CZ&quot;</span><span class="p">,</span>
               <span class="s2">&quot;CS&quot;</span><span class="p">,</span> <span class="s2">&quot;CT&quot;</span><span class="p">,</span> <span class="s2">&quot;CPHASE&quot;</span><span class="p">]</span>
<span class="n">_swap_like</span> <span class="o">=</span> <span class="p">[</span><span class="s2">&quot;SWAP&quot;</span><span class="p">,</span> <span class="s2">&quot;ISWAP&quot;</span><span class="p">,</span> <span class="s2">&quot;SQRTISWAP&quot;</span><span class="p">,</span> <span class="s2">&quot;SQRTSWAP&quot;</span><span class="p">,</span> <span class="s2">&quot;BERKELEY&quot;</span><span class="p">,</span>
              <span class="s2">&quot;SWAPalpha&quot;</span><span class="p">]</span>
<span class="n">_toffoli_like</span> <span class="o">=</span> <span class="p">[</span><span class="s2">&quot;TOFFOLI&quot;</span><span class="p">]</span>
<span class="n">_fredkin_like</span> <span class="o">=</span> <span class="p">[</span><span class="s2">&quot;FREDKIN&quot;</span><span class="p">]</span>


<div class="viewcode-block" id="Gate"><a class="viewcode-back" href="../../../apidoc/classes.html#qutip.qip.Gate">[docs]</a><span class="k">class</span> <span class="nc">Gate</span><span class="p">:</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Representation of a quantum gate, with its required parameters, and target</span>
<span class="sd">    and control qubits.</span>

<span class="sd">    Parameters</span>
<span class="sd">    ----------</span>
<span class="sd">    name : string</span>
<span class="sd">        Gate name.</span>
<span class="sd">    targets : list or int</span>
<span class="sd">        Gate targets.</span>
<span class="sd">    controls : list or int</span>
<span class="sd">        Gate controls.</span>
<span class="sd">    arg_value : float</span>
<span class="sd">        Argument value(phi).</span>
<span class="sd">    arg_label : string</span>
<span class="sd">        Label for gate representation.</span>
<span class="sd">    classical_controls : int or list of int, optional</span>
<span class="sd">        indices of classical bits to control gate on.</span>
<span class="sd">    control_value : int, optional</span>
<span class="sd">        value of classical bits to control on, the classical controls are</span>
<span class="sd">        interpreted as an integer with lowest bit being the first one.</span>
<span class="sd">        If not specified, then the value is interpreted to be</span>
<span class="sd">        2 ** len(classical_controls) - 1 (i.e. all classical controls are 1).</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">name</span><span class="p">,</span> <span class="n">targets</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">controls</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
                 <span class="n">arg_value</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">arg_label</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
                 <span class="n">classical_controls</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">control_value</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Create a gate with specified parameters.</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">name</span> <span class="o">=</span> <span class="n">name</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">targets</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">controls</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">classical_controls</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">control_value</span> <span class="o">=</span> <span class="kc">None</span>

        <span class="k">if</span> <span class="ow">not</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">targets</span><span class="p">,</span> <span class="n">Iterable</span><span class="p">)</span> <span class="ow">and</span> <span class="n">targets</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">targets</span> <span class="o">=</span> <span class="p">[</span><span class="n">targets</span><span class="p">]</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">targets</span> <span class="o">=</span> <span class="n">targets</span>

        <span class="k">if</span> <span class="ow">not</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">controls</span><span class="p">,</span> <span class="n">Iterable</span><span class="p">)</span> <span class="ow">and</span> <span class="n">controls</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">controls</span> <span class="o">=</span> <span class="p">[</span><span class="n">controls</span><span class="p">]</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">controls</span> <span class="o">=</span> <span class="n">controls</span>

        <span class="k">if</span> <span class="p">(</span><span class="ow">not</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">classical_controls</span><span class="p">,</span> <span class="n">Iterable</span><span class="p">)</span> <span class="ow">and</span>
                <span class="n">classical_controls</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">):</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">classical_controls</span> <span class="o">=</span> <span class="p">[</span><span class="n">classical_controls</span><span class="p">]</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">classical_controls</span> <span class="o">=</span> <span class="n">classical_controls</span>

        <span class="k">if</span> <span class="p">(</span><span class="n">control_value</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span>
                <span class="ow">and</span> <span class="n">control_value</span> <span class="o">&lt;</span> <span class="mi">2</span> <span class="o">**</span> <span class="nb">len</span><span class="p">(</span><span class="n">classical_controls</span><span class="p">)):</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">control_value</span> <span class="o">=</span> <span class="n">control_value</span>

        <span class="k">for</span> <span class="n">ind_list</span> <span class="ow">in</span> <span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">targets</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">controls</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">classical_controls</span><span class="p">]:</span>
            <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">ind_list</span><span class="p">,</span> <span class="n">Iterable</span><span class="p">):</span>
                <span class="n">all_integer</span> <span class="o">=</span> <span class="nb">all</span><span class="p">(</span>
                    <span class="p">[</span><span class="nb">isinstance</span><span class="p">(</span><span class="n">ind</span><span class="p">,</span> <span class="n">numbers</span><span class="o">.</span><span class="n">Integral</span><span class="p">)</span> <span class="k">for</span> <span class="n">ind</span> <span class="ow">in</span> <span class="n">ind_list</span><span class="p">])</span>
                <span class="k">if</span> <span class="ow">not</span> <span class="n">all_integer</span><span class="p">:</span>
                    <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">&quot;Index of a qubit must be an integer&quot;</span><span class="p">)</span>

        <span class="k">if</span> <span class="n">name</span> <span class="ow">in</span> <span class="n">_single_qubit_gates</span><span class="p">:</span>
            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">targets</span> <span class="ow">is</span> <span class="kc">None</span> <span class="ow">or</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">targets</span><span class="p">)</span> <span class="o">!=</span> <span class="mi">1</span><span class="p">:</span>
                <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">&quot;Gate </span><span class="si">%s</span><span class="s2"> requires one target&quot;</span> <span class="o">%</span> <span class="n">name</span><span class="p">)</span>
            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">controls</span><span class="p">:</span>
                <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">&quot;Gate </span><span class="si">%s</span><span class="s2"> cannot have a control&quot;</span> <span class="o">%</span> <span class="n">name</span><span class="p">)</span>
        <span class="k">elif</span> <span class="n">name</span> <span class="ow">in</span> <span class="n">_swap_like</span><span class="p">:</span>
            <span class="k">if</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">targets</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">)</span> <span class="ow">or</span> <span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">targets</span><span class="p">)</span> <span class="o">!=</span> <span class="mi">2</span><span class="p">):</span>
                <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">&quot;Gate </span><span class="si">%s</span><span class="s2"> requires two targets&quot;</span> <span class="o">%</span> <span class="n">name</span><span class="p">)</span>
            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">controls</span><span class="p">:</span>
                <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">&quot;Gate </span><span class="si">%s</span><span class="s2"> cannot have a control&quot;</span> <span class="o">%</span> <span class="n">name</span><span class="p">)</span>
        <span class="k">elif</span> <span class="n">name</span> <span class="ow">in</span> <span class="n">_ctrl_gates</span><span class="p">:</span>
            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">targets</span> <span class="ow">is</span> <span class="kc">None</span> <span class="ow">or</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">targets</span><span class="p">)</span> <span class="o">!=</span> <span class="mi">1</span><span class="p">:</span>
                <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">&quot;Gate </span><span class="si">%s</span><span class="s2"> requires one target&quot;</span> <span class="o">%</span> <span class="n">name</span><span class="p">)</span>
            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">controls</span> <span class="ow">is</span> <span class="kc">None</span> <span class="ow">or</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">controls</span><span class="p">)</span> <span class="o">!=</span> <span class="mi">1</span><span class="p">:</span>
                <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">&quot;Gate </span><span class="si">%s</span><span class="s2"> requires one control&quot;</span> <span class="o">%</span> <span class="n">name</span><span class="p">)</span>
        <span class="k">elif</span> <span class="n">name</span> <span class="ow">in</span> <span class="n">_fredkin_like</span><span class="p">:</span>
            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">targets</span> <span class="ow">is</span> <span class="kc">None</span> <span class="ow">or</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">targets</span><span class="p">)</span> <span class="o">!=</span> <span class="mi">2</span><span class="p">:</span>
                <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">&quot;Gate </span><span class="si">%s</span><span class="s2"> requires one target&quot;</span> <span class="o">%</span> <span class="n">name</span><span class="p">)</span>
            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">controls</span> <span class="ow">is</span> <span class="kc">None</span> <span class="ow">or</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">controls</span><span class="p">)</span> <span class="o">!=</span> <span class="mi">1</span><span class="p">:</span>
                <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">&quot;Gate </span><span class="si">%s</span><span class="s2"> requires two control&quot;</span> <span class="o">%</span> <span class="n">name</span><span class="p">)</span>
        <span class="k">elif</span> <span class="n">name</span> <span class="ow">in</span> <span class="n">_toffoli_like</span><span class="p">:</span>
            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">targets</span> <span class="ow">is</span> <span class="kc">None</span> <span class="ow">or</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">targets</span><span class="p">)</span> <span class="o">!=</span> <span class="mi">1</span><span class="p">:</span>
                <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">&quot;Gate </span><span class="si">%s</span><span class="s2"> requires one target&quot;</span> <span class="o">%</span> <span class="n">name</span><span class="p">)</span>
            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">controls</span> <span class="ow">is</span> <span class="kc">None</span> <span class="ow">or</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">controls</span><span class="p">)</span> <span class="o">!=</span> <span class="mi">2</span><span class="p">:</span>
                <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">&quot;Gate </span><span class="si">%s</span><span class="s2"> requires two control&quot;</span> <span class="o">%</span> <span class="n">name</span><span class="p">)</span>

        <span class="k">if</span> <span class="n">name</span> <span class="ow">in</span> <span class="n">_para_gates</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">arg_value</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
                <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">&quot;Gate </span><span class="si">%s</span><span class="s2"> requires an argument value&quot;</span> <span class="o">%</span> <span class="n">name</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">if</span> <span class="p">(</span><span class="n">name</span> <span class="ow">in</span> <span class="n">_GATE_NAME_TO_LABEL</span><span class="p">)</span> <span class="ow">and</span> <span class="p">(</span><span class="n">arg_value</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">):</span>
                <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">&quot;Gate </span><span class="si">%s</span><span class="s2"> does not take argument value&quot;</span> <span class="o">%</span> <span class="n">name</span><span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">arg_value</span> <span class="o">=</span> <span class="n">arg_value</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">arg_label</span> <span class="o">=</span> <span class="n">arg_label</span>

    <span class="k">def</span> <span class="nf">get_inds</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">N</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">controls</span><span class="p">:</span>
            <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">controls</span> <span class="o">+</span> <span class="bp">self</span><span class="o">.</span><span class="n">targets</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">targets</span><span class="p">:</span>
            <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">targets</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">return</span> <span class="nb">list</span><span class="p">(</span><span class="nb">range</span><span class="p">(</span><span class="n">N</span><span class="p">))</span>

    <span class="k">def</span> <span class="fm">__str__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="n">str_name</span> <span class="o">=</span> <span class="p">((</span><span class="s2">&quot;Gate(</span><span class="si">%s</span><span class="s2">, targets=</span><span class="si">%s</span><span class="s2">, controls=</span><span class="si">%s</span><span class="s2">,&quot;</span>
                    <span class="s2">&quot; classical controls=</span><span class="si">%s</span><span class="s2">, control_value=</span><span class="si">%s</span><span class="s2">)&quot;</span><span class="p">)</span>
                    <span class="o">%</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">name</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">targets</span><span class="p">,</span>
                       <span class="bp">self</span><span class="o">.</span><span class="n">controls</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">classical_controls</span><span class="p">,</span>
                       <span class="bp">self</span><span class="o">.</span><span class="n">control_value</span><span class="p">))</span>
        <span class="k">return</span> <span class="n">str_name</span>

    <span class="k">def</span> <span class="fm">__repr__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="nb">str</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">_repr_latex_</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="nb">str</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">_to_qasm</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">qasm_out</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Pipe output of gate signature and application to QasmOutput object.</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        qasm_out: QasmOutput</span>
<span class="sd">            object to store QASM output.</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="n">qasm_gate</span> <span class="o">=</span> <span class="n">qasm_out</span><span class="o">.</span><span class="n">qasm_name</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">name</span><span class="p">)</span>

        <span class="k">if</span> <span class="ow">not</span> <span class="n">qasm_gate</span><span class="p">:</span>
            <span class="n">error_str</span> <span class="o">=</span>\
                 <span class="s2">&quot;</span><span class="si">{}</span><span class="s2"> gate&#39;s qasm defn is not specified&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">name</span><span class="p">)</span>
            <span class="k">raise</span> <span class="ne">NotImplementedError</span><span class="p">(</span><span class="n">error_str</span><span class="p">)</span>

        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">classical_controls</span><span class="p">:</span>
            <span class="n">err_msg</span> <span class="o">=</span> <span class="s2">&quot;Exporting controlled gates is not implemented yet.&quot;</span>
            <span class="k">raise</span> <span class="ne">NotImplementedError</span><span class="p">(</span><span class="n">err_msg</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">qasm_out</span><span class="o">.</span><span class="n">output</span><span class="p">(</span><span class="n">qasm_out</span><span class="o">.</span><span class="n">_qasm_str</span><span class="p">(</span><span class="n">qasm_gate</span><span class="p">,</span>
                                               <span class="bp">self</span><span class="o">.</span><span class="n">controls</span><span class="p">,</span>
                                               <span class="bp">self</span><span class="o">.</span><span class="n">targets</span><span class="p">,</span>
                                               <span class="bp">self</span><span class="o">.</span><span class="n">arg_value</span><span class="p">))</span></div>


<span class="n">_GATE_NAME_TO_LABEL</span> <span class="o">=</span> <span class="p">{</span>
    <span class="s1">&#39;X&#39;</span><span class="p">:</span> <span class="sa">r</span><span class="s1">&#39;X&#39;</span><span class="p">,</span>
    <span class="s1">&#39;Y&#39;</span><span class="p">:</span> <span class="sa">r</span><span class="s1">&#39;Y&#39;</span><span class="p">,</span>
    <span class="s1">&#39;CY&#39;</span><span class="p">:</span> <span class="sa">r</span><span class="s1">&#39;C_y&#39;</span><span class="p">,</span>
    <span class="s1">&#39;Z&#39;</span><span class="p">:</span> <span class="sa">r</span><span class="s1">&#39;Z&#39;</span><span class="p">,</span>
    <span class="s1">&#39;CZ&#39;</span><span class="p">:</span> <span class="sa">r</span><span class="s1">&#39;C_z&#39;</span><span class="p">,</span>
    <span class="s1">&#39;S&#39;</span><span class="p">:</span> <span class="sa">r</span><span class="s1">&#39;S&#39;</span><span class="p">,</span>
    <span class="s1">&#39;CS&#39;</span><span class="p">:</span> <span class="sa">r</span><span class="s1">&#39;C_s&#39;</span><span class="p">,</span>
    <span class="s1">&#39;T&#39;</span><span class="p">:</span> <span class="sa">r</span><span class="s1">&#39;T&#39;</span><span class="p">,</span>
    <span class="s1">&#39;CT&#39;</span><span class="p">:</span> <span class="sa">r</span><span class="s1">&#39;C_t&#39;</span><span class="p">,</span>
    <span class="s1">&#39;RX&#39;</span><span class="p">:</span> <span class="sa">r</span><span class="s1">&#39;R_x&#39;</span><span class="p">,</span>
    <span class="s1">&#39;RY&#39;</span><span class="p">:</span> <span class="sa">r</span><span class="s1">&#39;R_y&#39;</span><span class="p">,</span>
    <span class="s1">&#39;RZ&#39;</span><span class="p">:</span> <span class="sa">r</span><span class="s1">&#39;R_z&#39;</span><span class="p">,</span>
    <span class="s1">&#39;CRX&#39;</span><span class="p">:</span> <span class="sa">r</span><span class="s1">&#39;R_x&#39;</span><span class="p">,</span>
    <span class="s1">&#39;CRY&#39;</span><span class="p">:</span> <span class="sa">r</span><span class="s1">&#39;R_y&#39;</span><span class="p">,</span>
    <span class="s1">&#39;CRZ&#39;</span><span class="p">:</span> <span class="sa">r</span><span class="s1">&#39;R_z&#39;</span><span class="p">,</span>
    <span class="s1">&#39;SQRTNOT&#39;</span><span class="p">:</span> <span class="sa">r</span><span class="s1">&#39;\sqrt{\rm NOT}&#39;</span><span class="p">,</span>
    <span class="s1">&#39;SNOT&#39;</span><span class="p">:</span> <span class="sa">r</span><span class="s1">&#39;{\rm H}&#39;</span><span class="p">,</span>
    <span class="s1">&#39;PHASEGATE&#39;</span><span class="p">:</span> <span class="sa">r</span><span class="s1">&#39;{\rm PHASE}&#39;</span><span class="p">,</span>
    <span class="s1">&#39;QASMU&#39;</span><span class="p">:</span> <span class="sa">r</span><span class="s1">&#39;{\rm QASM-U}&#39;</span><span class="p">,</span>
    <span class="s1">&#39;CPHASE&#39;</span><span class="p">:</span> <span class="sa">r</span><span class="s1">&#39;{\rm R}&#39;</span><span class="p">,</span>
    <span class="s1">&#39;CNOT&#39;</span><span class="p">:</span> <span class="sa">r</span><span class="s1">&#39;{\rm CNOT}&#39;</span><span class="p">,</span>
    <span class="s1">&#39;CSIGN&#39;</span><span class="p">:</span> <span class="sa">r</span><span class="s1">&#39;{\rm Z}&#39;</span><span class="p">,</span>
    <span class="s1">&#39;BERKELEY&#39;</span><span class="p">:</span> <span class="sa">r</span><span class="s1">&#39;{\rm BERKELEY}&#39;</span><span class="p">,</span>
    <span class="s1">&#39;SWAPalpha&#39;</span><span class="p">:</span> <span class="sa">r</span><span class="s1">&#39;{\rm SWAPalpha}&#39;</span><span class="p">,</span>
    <span class="s1">&#39;SWAP&#39;</span><span class="p">:</span> <span class="sa">r</span><span class="s1">&#39;{\rm SWAP}&#39;</span><span class="p">,</span>
    <span class="s1">&#39;ISWAP&#39;</span><span class="p">:</span> <span class="sa">r</span><span class="s1">&#39;</span><span class="si">{i}</span><span class="s1">{\rm SWAP}&#39;</span><span class="p">,</span>
    <span class="s1">&#39;SQRTSWAP&#39;</span><span class="p">:</span> <span class="sa">r</span><span class="s1">&#39;\sqrt{\rm SWAP}&#39;</span><span class="p">,</span>
    <span class="s1">&#39;SQRTISWAP&#39;</span><span class="p">:</span> <span class="sa">r</span><span class="s1">&#39;\sqrt{{i}\rm SWAP}&#39;</span><span class="p">,</span>
    <span class="s1">&#39;FREDKIN&#39;</span><span class="p">:</span> <span class="sa">r</span><span class="s1">&#39;{\rm FREDKIN}&#39;</span><span class="p">,</span>
    <span class="s1">&#39;TOFFOLI&#39;</span><span class="p">:</span> <span class="sa">r</span><span class="s1">&#39;{\rm TOFFOLI}&#39;</span><span class="p">,</span>
    <span class="s1">&#39;GLOBALPHASE&#39;</span><span class="p">:</span> <span class="sa">r</span><span class="s1">&#39;{\rm Ph}&#39;</span><span class="p">,</span>
<span class="p">}</span>


<span class="k">def</span> <span class="nf">_gate_label</span><span class="p">(</span><span class="n">name</span><span class="p">,</span> <span class="n">arg_label</span><span class="p">):</span>

    <span class="k">if</span> <span class="n">name</span> <span class="ow">in</span> <span class="n">_GATE_NAME_TO_LABEL</span><span class="p">:</span>
        <span class="n">gate_label</span> <span class="o">=</span> <span class="n">_GATE_NAME_TO_LABEL</span><span class="p">[</span><span class="n">name</span><span class="p">]</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">warnings</span><span class="o">.</span><span class="n">warn</span><span class="p">(</span><span class="s2">&quot;Unknown gate </span><span class="si">%s</span><span class="s2">&quot;</span> <span class="o">%</span> <span class="n">name</span><span class="p">)</span>
        <span class="n">gate_label</span> <span class="o">=</span> <span class="n">name</span>

    <span class="k">if</span> <span class="n">arg_label</span><span class="p">:</span>
        <span class="k">return</span> <span class="sa">r</span><span class="s1">&#39;</span><span class="si">%s</span><span class="s1">(</span><span class="si">%s</span><span class="s1">)&#39;</span> <span class="o">%</span> <span class="p">(</span><span class="n">gate_label</span><span class="p">,</span> <span class="n">arg_label</span><span class="p">)</span>
    <span class="k">return</span> <span class="sa">r</span><span class="s1">&#39;</span><span class="si">%s</span><span class="s1">&#39;</span> <span class="o">%</span> <span class="n">gate_label</span>


<div class="viewcode-block" id="Measurement"><a class="viewcode-back" href="../../../apidoc/classes.html#qutip.qip.Measurement">[docs]</a><span class="k">class</span> <span class="nc">Measurement</span><span class="p">:</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Representation of a quantum measurement, with its required parameters,</span>
<span class="sd">    and target qubits.</span>

<span class="sd">    Parameters</span>
<span class="sd">    ----------</span>
<span class="sd">    name : string</span>
<span class="sd">        Measurement name.</span>
<span class="sd">    targets : list or int</span>
<span class="sd">        Gate targets.</span>
<span class="sd">    classical_store : int</span>
<span class="sd">        Result of the measurment is stored in this</span>
<span class="sd">        classical register of the circuit.</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">name</span><span class="p">,</span> <span class="n">targets</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">index</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">classical_store</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Create a measurement with specified parameters.</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">name</span> <span class="o">=</span> <span class="n">name</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">targets</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">classical_store</span> <span class="o">=</span> <span class="n">classical_store</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">index</span> <span class="o">=</span> <span class="n">index</span>

        <span class="k">if</span> <span class="ow">not</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">targets</span><span class="p">,</span> <span class="n">Iterable</span><span class="p">)</span> <span class="ow">and</span> <span class="n">targets</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">targets</span> <span class="o">=</span> <span class="p">[</span><span class="n">targets</span><span class="p">]</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">targets</span> <span class="o">=</span> <span class="n">targets</span>

        <span class="k">for</span> <span class="n">ind_list</span> <span class="ow">in</span> <span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">targets</span><span class="p">]:</span>
            <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">ind_list</span><span class="p">,</span> <span class="n">Iterable</span><span class="p">):</span>
                <span class="n">all_integer</span> <span class="o">=</span> <span class="nb">all</span><span class="p">(</span>
                    <span class="p">[</span><span class="nb">isinstance</span><span class="p">(</span><span class="n">ind</span><span class="p">,</span> <span class="n">numbers</span><span class="o">.</span><span class="n">Integral</span><span class="p">)</span> <span class="k">for</span> <span class="n">ind</span> <span class="ow">in</span> <span class="n">ind_list</span><span class="p">])</span>
                <span class="k">if</span> <span class="ow">not</span> <span class="n">all_integer</span><span class="p">:</span>
                    <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">&quot;Index of a qubit must be an integer&quot;</span><span class="p">)</span>

<div class="viewcode-block" id="Measurement.measurement_comp_basis"><a class="viewcode-back" href="../../../apidoc/classes.html#qutip.qip.Measurement.measurement_comp_basis">[docs]</a>    <span class="k">def</span> <span class="nf">measurement_comp_basis</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">state</span><span class="p">):</span>
        <span class="sd">&#39;&#39;&#39;</span>
<span class="sd">        Measures a particular qubit (determined by the target)</span>
<span class="sd">        whose ket vector/ density matrix is specified in the</span>
<span class="sd">        computational basis and returns collapsed_states and probabilities</span>
<span class="sd">        (retains full dimension).</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        state : ket or oper</span>
<span class="sd">                state to be measured on specified by</span>
<span class="sd">                ket vector or density matrix</span>

<span class="sd">        Returns</span>
<span class="sd">        -------</span>
<span class="sd">        collapsed_states : List of Qobjs</span>
<span class="sd">                        the collapsed state obtained after measuring the qubits</span>
<span class="sd">                        and obtaining the qubit specified by the target in the</span>
<span class="sd">                        state specified by the index.</span>
<span class="sd">        probabilities : List of floats</span>
<span class="sd">                        the probability of measuring a state in a the state</span>
<span class="sd">                        specified by the index.</span>
<span class="sd">        &#39;&#39;&#39;</span>

        <span class="n">n</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">log2</span><span class="p">(</span><span class="n">state</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">]))</span>
        <span class="n">target</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">targets</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>

        <span class="k">if</span> <span class="n">target</span> <span class="o">&lt;</span> <span class="n">n</span><span class="p">:</span>
            <span class="n">op0</span> <span class="o">=</span> <span class="n">basis</span><span class="p">(</span><span class="mi">2</span><span class="p">,</span> <span class="mi">0</span><span class="p">)</span> <span class="o">*</span> <span class="n">basis</span><span class="p">(</span><span class="mi">2</span><span class="p">,</span> <span class="mi">0</span><span class="p">)</span><span class="o">.</span><span class="n">dag</span><span class="p">()</span>
            <span class="n">op1</span> <span class="o">=</span> <span class="n">basis</span><span class="p">(</span><span class="mi">2</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span> <span class="o">*</span> <span class="n">basis</span><span class="p">(</span><span class="mi">2</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span><span class="o">.</span><span class="n">dag</span><span class="p">()</span>
            <span class="n">measurement_ops</span> <span class="o">=</span> <span class="p">[</span><span class="n">op0</span><span class="p">,</span> <span class="n">op1</span><span class="p">]</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">&quot;target is not valid&quot;</span><span class="p">)</span>

        <span class="k">return</span> <span class="n">measurement_statistics</span><span class="p">(</span><span class="n">state</span><span class="p">,</span> <span class="n">measurement_ops</span><span class="p">,</span>
                                      <span class="n">targets</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">targets</span><span class="p">)</span></div>

    <span class="k">def</span> <span class="fm">__str__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="n">str_name</span> <span class="o">=</span> <span class="p">((</span><span class="s2">&quot;Measurement(</span><span class="si">%s</span><span class="s2">, target=</span><span class="si">%s</span><span class="s2">, classical_store=</span><span class="si">%s</span><span class="s2">)&quot;</span><span class="p">)</span> <span class="o">%</span>
                    <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">name</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">targets</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">classical_store</span><span class="p">))</span>
        <span class="k">return</span> <span class="n">str_name</span>

    <span class="k">def</span> <span class="fm">__repr__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="nb">str</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">_repr_latex_</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="nb">str</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">_to_qasm</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">qasm_out</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Pipe output of measurement to QasmOutput object.</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        qasm_out: QasmOutput</span>
<span class="sd">            object to store QASM output.</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="n">qasm_out</span><span class="o">.</span><span class="n">output</span><span class="p">(</span><span class="s2">&quot;measure q[</span><span class="si">{}</span><span class="s2">] -&gt; c[</span><span class="si">{}</span><span class="s2">]&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">targets</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span>
                                                        <span class="bp">self</span><span class="o">.</span><span class="n">classical_store</span><span class="p">))</span></div>


<div class="viewcode-block" id="QubitCircuit"><a class="viewcode-back" href="../../../apidoc/classes.html#qutip.qip.QubitCircuit">[docs]</a><span class="k">class</span> <span class="nc">QubitCircuit</span><span class="p">:</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Representation of a quantum program/algorithm, maintaining a sequence</span>
<span class="sd">    of gates.</span>

<span class="sd">    Parameters</span>
<span class="sd">    ----------</span>
<span class="sd">    N : int</span>
<span class="sd">        Number of qubits in the system.</span>
<span class="sd">    user_gates : dict</span>
<span class="sd">        Define a dictionary of the custom gates. See examples for detail.</span>
<span class="sd">    input_states : list</span>
<span class="sd">        A list of string such as `0`,&#39;+&#39;, &quot;A&quot;, &quot;Y&quot;. Only used for latex.</span>
<span class="sd">    dims : list</span>
<span class="sd">        A list of integer for the dimension of each composite system.</span>
<span class="sd">        e.g [2,2,2,2,2] for 5 qubits system. If None, qubits system</span>
<span class="sd">        will be the default option.</span>
<span class="sd">    num_cbits : int</span>
<span class="sd">        Number of classical bits in the system.</span>

<span class="sd">    Examples</span>
<span class="sd">    --------</span>
<span class="sd">    &gt;&gt;&gt; def user_gate():</span>
<span class="sd">    ...     mat = np.array([[1.,   0],</span>
<span class="sd">    ...                     [0., 1.j]])</span>
<span class="sd">    ...     return Qobj(mat, dims=[[2], [2]])</span>
<span class="sd">    &gt;&gt;&gt; qubit_circuit = QubitCircuit(2, user_gates={&quot;T&quot;:user_gate})</span>
<span class="sd">    &gt;&gt;&gt; qubit_circuit.add_gate(&quot;T&quot;, targets=[0])</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">N</span><span class="p">,</span> <span class="n">input_states</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">output_states</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
                 <span class="n">reverse_states</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">user_gates</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">dims</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">num_cbits</span><span class="o">=</span><span class="mi">0</span><span class="p">):</span>
        <span class="c1"># number of qubits in the register</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">N</span> <span class="o">=</span> <span class="n">N</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">reverse_states</span> <span class="o">=</span> <span class="n">reverse_states</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">gates</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">U_list</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">dims</span> <span class="o">=</span> <span class="n">dims</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">num_cbits</span> <span class="o">=</span> <span class="n">num_cbits</span>

        <span class="k">if</span> <span class="n">input_states</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">input_states</span> <span class="o">=</span> <span class="n">input_states</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">input_states</span> <span class="o">=</span> <span class="p">[</span><span class="kc">None</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">N</span><span class="o">+</span><span class="n">num_cbits</span><span class="p">)]</span>

        <span class="k">if</span> <span class="n">output_states</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">output_states</span> <span class="o">=</span> <span class="n">output_states</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">output_states</span> <span class="o">=</span> <span class="p">[</span><span class="kc">None</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">N</span><span class="o">+</span><span class="n">num_cbits</span><span class="p">)]</span>

        <span class="k">if</span> <span class="n">user_gates</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">user_gates</span> <span class="o">=</span> <span class="p">{}</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">user_gates</span><span class="p">,</span> <span class="nb">dict</span><span class="p">):</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">user_gates</span> <span class="o">=</span> <span class="n">user_gates</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span>
                    <span class="s2">&quot;`user_gate` takes a python dictionary of the form&quot;</span>
                    <span class="s2">&quot;{{str: gate_function}}, not </span><span class="si">{}</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">user_gates</span><span class="p">))</span>

<div class="viewcode-block" id="QubitCircuit.add_state"><a class="viewcode-back" href="../../../apidoc/classes.html#qutip.qip.QubitCircuit.add_state">[docs]</a>    <span class="k">def</span> <span class="nf">add_state</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">state</span><span class="p">,</span> <span class="n">targets</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">state_type</span><span class="o">=</span><span class="s2">&quot;input&quot;</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Add an input or ouput state to the circuit. By default all the input</span>
<span class="sd">        and output states will be initialized to `None`. A particular state can</span>
<span class="sd">        be added by specifying the state and the qubit where it has to be added</span>
<span class="sd">        along with the type as input or output.</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        state: str</span>
<span class="sd">            The state that has to be added. It can be any string such as `0`,</span>
<span class="sd">            &#39;+&#39;, &quot;A&quot;, &quot;Y&quot;</span>
<span class="sd">        targets: list</span>
<span class="sd">            A list of qubit positions where the given state has to be added.</span>
<span class="sd">        state_type: str</span>
<span class="sd">            One of either &quot;input&quot; or &quot;output&quot;. This specifies whether the state</span>
<span class="sd">            to be added is an input or output.</span>
<span class="sd">            default: &quot;input&quot;</span>

<span class="sd">        &quot;&quot;&quot;</span>

        <span class="k">if</span> <span class="n">state_type</span> <span class="o">==</span> <span class="s2">&quot;input&quot;</span><span class="p">:</span>
            <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="n">targets</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">input_states</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">=</span> <span class="n">state</span>
        <span class="k">if</span> <span class="n">state_type</span> <span class="o">==</span> <span class="s2">&quot;output&quot;</span><span class="p">:</span>
            <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="n">targets</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">output_states</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">=</span> <span class="n">state</span></div>

<div class="viewcode-block" id="QubitCircuit.add_measurement"><a class="viewcode-back" href="../../../apidoc/classes.html#qutip.qip.QubitCircuit.add_measurement">[docs]</a>    <span class="k">def</span> <span class="nf">add_measurement</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">measurement</span><span class="p">,</span> <span class="n">targets</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">index</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
                        <span class="n">classical_store</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Adds a measurement with specified parameters to the circuit.</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        measurement: string</span>
<span class="sd">            Measurement name. If name is an instance of `Measuremnent`,</span>
<span class="sd">            parameters are unpacked and added.</span>
<span class="sd">        targets: list</span>
<span class="sd">            Gate targets</span>
<span class="sd">        index : list</span>
<span class="sd">            Positions to add the gate.</span>
<span class="sd">        classical_store : int</span>
<span class="sd">            Classical register where result of measurement is stored.</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">measurement</span><span class="p">,</span> <span class="n">Measurement</span><span class="p">):</span>
            <span class="n">name</span> <span class="o">=</span> <span class="n">measurement</span><span class="o">.</span><span class="n">name</span>
            <span class="n">targets</span> <span class="o">=</span> <span class="n">measurement</span><span class="o">.</span><span class="n">targets</span>
            <span class="n">classical_store</span> <span class="o">=</span> <span class="n">measurement</span><span class="o">.</span><span class="n">classical_store</span>

        <span class="k">else</span><span class="p">:</span>
            <span class="n">name</span> <span class="o">=</span> <span class="n">measurement</span>

        <span class="k">if</span> <span class="n">index</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">gates</span><span class="o">.</span><span class="n">append</span><span class="p">(</span>
                    <span class="n">Measurement</span><span class="p">(</span><span class="n">name</span><span class="p">,</span> <span class="n">targets</span><span class="o">=</span><span class="n">targets</span><span class="p">,</span>
                                <span class="n">classical_store</span><span class="o">=</span><span class="n">classical_store</span><span class="p">))</span>

        <span class="k">else</span><span class="p">:</span>
            <span class="k">for</span> <span class="n">position</span> <span class="ow">in</span> <span class="n">index</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">gates</span><span class="o">.</span><span class="n">insert</span><span class="p">(</span>
                    <span class="n">position</span><span class="p">,</span>
                    <span class="n">Measurement</span><span class="p">(</span><span class="n">name</span><span class="p">,</span> <span class="n">targets</span><span class="o">=</span><span class="n">targets</span><span class="p">,</span>
                                <span class="n">classical_store</span><span class="o">=</span><span class="n">classical_store</span><span class="p">))</span></div>

<div class="viewcode-block" id="QubitCircuit.add_gate"><a class="viewcode-back" href="../../../apidoc/classes.html#qutip.qip.QubitCircuit.add_gate">[docs]</a>    <span class="k">def</span> <span class="nf">add_gate</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">gate</span><span class="p">,</span> <span class="n">targets</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">controls</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">arg_value</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
                 <span class="n">arg_label</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">index</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
                 <span class="n">classical_controls</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">control_value</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Adds a gate with specified parameters to the circuit.</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        gate: string or :class:`.Gate`</span>
<span class="sd">            Gate name. If gate is an instance of :class:`.Gate`, parameters are</span>
<span class="sd">            unpacked and added.</span>
<span class="sd">        targets: list</span>
<span class="sd">            Gate targets.</span>
<span class="sd">        controls: list</span>
<span class="sd">            Gate controls.</span>
<span class="sd">        arg_value: float</span>
<span class="sd">            Argument value(phi).</span>
<span class="sd">        arg_label: string</span>
<span class="sd">            Label for gate representation.</span>
<span class="sd">        index : list</span>
<span class="sd">            Positions to add the gate. Each index in the supplied list refers</span>
<span class="sd">            to a position in the original list of gates.</span>
<span class="sd">        classical_controls : int or list of int, optional</span>
<span class="sd">            indices of classical bits to control gate on.</span>
<span class="sd">        control_value : int, optional</span>
<span class="sd">            value of classical bits to control on, the classical controls are</span>
<span class="sd">            interpreted as an integer with lowest bit being the first one.</span>
<span class="sd">            If not specified, then the value is interpreted to be</span>
<span class="sd">            2 ** len(classical_controls) - 1</span>
<span class="sd">            (i.e. all classical controls are 1).</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">gate</span><span class="p">,</span> <span class="n">Gate</span><span class="p">):</span>
            <span class="n">name</span> <span class="o">=</span> <span class="n">gate</span><span class="o">.</span><span class="n">name</span>
            <span class="n">targets</span> <span class="o">=</span> <span class="n">gate</span><span class="o">.</span><span class="n">targets</span>
            <span class="n">controls</span> <span class="o">=</span> <span class="n">gate</span><span class="o">.</span><span class="n">controls</span>
            <span class="n">arg_value</span> <span class="o">=</span> <span class="n">gate</span><span class="o">.</span><span class="n">arg_value</span>
            <span class="n">arg_label</span> <span class="o">=</span> <span class="n">gate</span><span class="o">.</span><span class="n">arg_label</span>
            <span class="n">classical_controls</span> <span class="o">=</span> <span class="n">gate</span><span class="o">.</span><span class="n">classical_controls</span>
            <span class="n">control_value</span> <span class="o">=</span> <span class="n">gate</span><span class="o">.</span><span class="n">control_value</span>

        <span class="k">else</span><span class="p">:</span>
            <span class="n">name</span> <span class="o">=</span> <span class="n">gate</span>

        <span class="k">if</span> <span class="n">index</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">gate</span> <span class="o">=</span> <span class="n">Gate</span><span class="p">(</span><span class="n">name</span><span class="p">,</span> <span class="n">targets</span><span class="o">=</span><span class="n">targets</span><span class="p">,</span> <span class="n">controls</span><span class="o">=</span><span class="n">controls</span><span class="p">,</span>
                        <span class="n">arg_value</span><span class="o">=</span><span class="n">arg_value</span><span class="p">,</span> <span class="n">arg_label</span><span class="o">=</span><span class="n">arg_label</span><span class="p">,</span>
                        <span class="n">classical_controls</span><span class="o">=</span><span class="n">classical_controls</span><span class="p">,</span>
                        <span class="n">control_value</span><span class="o">=</span><span class="n">control_value</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">gates</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">gate</span><span class="p">)</span>

        <span class="k">else</span><span class="p">:</span>
            <span class="c1"># NOTE: Every insertion shifts the indices in the original list of</span>
            <span class="c1">#       gates by an additional position to the right.</span>
            <span class="n">shifted_inds</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">sort</span><span class="p">(</span><span class="n">index</span><span class="p">)</span> <span class="o">+</span> <span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">index</span><span class="p">))</span>
            <span class="k">for</span> <span class="n">position</span> <span class="ow">in</span> <span class="n">shifted_inds</span><span class="p">:</span>
                <span class="n">gate</span> <span class="o">=</span> <span class="n">Gate</span><span class="p">(</span><span class="n">name</span><span class="p">,</span> <span class="n">targets</span><span class="o">=</span><span class="n">targets</span><span class="p">,</span> <span class="n">controls</span><span class="o">=</span><span class="n">controls</span><span class="p">,</span>
                            <span class="n">arg_value</span><span class="o">=</span><span class="n">arg_value</span><span class="p">,</span> <span class="n">arg_label</span><span class="o">=</span><span class="n">arg_label</span><span class="p">,</span>
                            <span class="n">classical_controls</span><span class="o">=</span><span class="n">classical_controls</span><span class="p">,</span>
                            <span class="n">control_value</span><span class="o">=</span><span class="n">control_value</span><span class="p">)</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">gates</span><span class="o">.</span><span class="n">insert</span><span class="p">(</span><span class="n">position</span><span class="p">,</span> <span class="n">gate</span><span class="p">)</span></div>

<div class="viewcode-block" id="QubitCircuit.add_1q_gate"><a class="viewcode-back" href="../../../apidoc/classes.html#qutip.qip.QubitCircuit.add_1q_gate">[docs]</a>    <span class="k">def</span> <span class="nf">add_1q_gate</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">name</span><span class="p">,</span> <span class="n">start</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span> <span class="n">end</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">qubits</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
                    <span class="n">arg_value</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">arg_label</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
                    <span class="n">classical_controls</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">control_value</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Adds a single qubit gate with specified parameters on a variable</span>
<span class="sd">        number of qubits in the circuit. By default, it applies the given gate</span>
<span class="sd">        to all the qubits in the register.</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        name : string</span>
<span class="sd">            Gate name.</span>
<span class="sd">        start : int</span>
<span class="sd">            Starting location of qubits.</span>
<span class="sd">        end : int</span>
<span class="sd">            Last qubit for the gate.</span>
<span class="sd">        qubits : list</span>
<span class="sd">            Specific qubits for applying gates.</span>
<span class="sd">        arg_value : float</span>
<span class="sd">            Argument value(phi).</span>
<span class="sd">        arg_label : string</span>
<span class="sd">            Label for gate representation.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="n">name</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">_single_qubit_gates</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">&quot;</span><span class="si">%s</span><span class="s2"> is not a single qubit gate&quot;</span> <span class="o">%</span> <span class="n">name</span><span class="p">)</span>

        <span class="k">if</span> <span class="n">qubits</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="k">for</span> <span class="n">_</span><span class="p">,</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">qubits</span><span class="p">):</span>
                <span class="n">gate</span> <span class="o">=</span> <span class="n">Gate</span><span class="p">(</span><span class="n">name</span><span class="p">,</span> <span class="n">targets</span><span class="o">=</span><span class="n">qubits</span><span class="p">[</span><span class="n">i</span><span class="p">],</span> <span class="n">controls</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
                            <span class="n">arg_value</span><span class="o">=</span><span class="n">arg_value</span><span class="p">,</span> <span class="n">arg_label</span><span class="o">=</span><span class="n">arg_label</span><span class="p">,</span>
                            <span class="n">classical_controls</span><span class="o">=</span><span class="n">classical_controls</span><span class="p">,</span>
                            <span class="n">control_value</span><span class="o">=</span><span class="n">control_value</span><span class="p">)</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">gates</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">gate</span><span class="p">)</span>

        <span class="k">else</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">end</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
                <span class="n">end</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">N</span> <span class="o">-</span> <span class="mi">1</span>
            <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">start</span><span class="p">,</span> <span class="n">end</span><span class="o">+</span><span class="mi">1</span><span class="p">):</span>
                <span class="n">gate</span> <span class="o">=</span> <span class="n">Gate</span><span class="p">(</span><span class="n">name</span><span class="p">,</span> <span class="n">targets</span><span class="o">=</span><span class="n">i</span><span class="p">,</span> <span class="n">controls</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
                            <span class="n">arg_value</span><span class="o">=</span><span class="n">arg_value</span><span class="p">,</span> <span class="n">arg_label</span><span class="o">=</span><span class="n">arg_label</span><span class="p">,</span>
                            <span class="n">classical_controls</span><span class="o">=</span><span class="n">classical_controls</span><span class="p">,</span>
                            <span class="n">control_value</span><span class="o">=</span><span class="n">control_value</span><span class="p">)</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">gates</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">gate</span><span class="p">)</span></div>

<div class="viewcode-block" id="QubitCircuit.add_circuit"><a class="viewcode-back" href="../../../apidoc/classes.html#qutip.qip.QubitCircuit.add_circuit">[docs]</a>    <span class="k">def</span> <span class="nf">add_circuit</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">qc</span><span class="p">,</span> <span class="n">start</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span> <span class="n">overwrite_user_gates</span><span class="o">=</span><span class="kc">False</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Adds a block of a qubit circuit to the main circuit.</span>
<span class="sd">        Globalphase gates are not added.</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        qc : :class:`.QubitCircuit`</span>
<span class="sd">            The circuit block to be added to the main circuit.</span>
<span class="sd">        start : int</span>
<span class="sd">            The qubit on which the first gate is applied.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">N</span> <span class="o">-</span> <span class="n">start</span> <span class="o">&lt;</span> <span class="n">qc</span><span class="o">.</span><span class="n">N</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">NotImplementedError</span><span class="p">(</span><span class="s2">&quot;Targets exceed number of qubits.&quot;</span><span class="p">)</span>

        <span class="c1"># Inherit the user gates</span>
        <span class="k">for</span> <span class="n">user_gate</span> <span class="ow">in</span> <span class="n">qc</span><span class="o">.</span><span class="n">user_gates</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">user_gate</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">user_gates</span> <span class="ow">and</span> <span class="ow">not</span> <span class="n">overwrite_user_gates</span><span class="p">:</span>
                <span class="k">continue</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">user_gates</span><span class="p">[</span><span class="n">user_gate</span><span class="p">]</span> <span class="o">=</span> <span class="n">qc</span><span class="o">.</span><span class="n">user_gates</span><span class="p">[</span><span class="n">user_gate</span><span class="p">]</span>

        <span class="k">for</span> <span class="n">circuit_op</span> <span class="ow">in</span> <span class="n">qc</span><span class="o">.</span><span class="n">gates</span><span class="p">:</span>

            <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">circuit_op</span><span class="p">,</span> <span class="n">Gate</span><span class="p">):</span>

                <span class="k">if</span> <span class="n">circuit_op</span><span class="o">.</span><span class="n">targets</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
                    <span class="n">tar</span> <span class="o">=</span> <span class="p">[</span><span class="n">target</span> <span class="o">+</span> <span class="n">start</span> <span class="k">for</span> <span class="n">target</span> <span class="ow">in</span> <span class="n">circuit_op</span><span class="o">.</span><span class="n">targets</span><span class="p">]</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="n">tar</span> <span class="o">=</span> <span class="kc">None</span>
                <span class="k">if</span> <span class="n">circuit_op</span><span class="o">.</span><span class="n">controls</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
                    <span class="n">ctrl</span> <span class="o">=</span> <span class="p">[</span><span class="n">control</span> <span class="o">+</span> <span class="n">start</span> <span class="k">for</span> <span class="n">control</span> <span class="ow">in</span> <span class="n">circuit_op</span><span class="o">.</span><span class="n">controls</span><span class="p">]</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="n">ctrl</span> <span class="o">=</span> <span class="kc">None</span>

                <span class="bp">self</span><span class="o">.</span><span class="n">add_gate</span><span class="p">(</span>
                    <span class="n">circuit_op</span><span class="o">.</span><span class="n">name</span><span class="p">,</span> <span class="n">targets</span><span class="o">=</span><span class="n">tar</span><span class="p">,</span> <span class="n">controls</span><span class="o">=</span><span class="n">ctrl</span><span class="p">,</span>
                    <span class="n">arg_value</span><span class="o">=</span><span class="n">circuit_op</span><span class="o">.</span><span class="n">arg_value</span><span class="p">)</span>
            <span class="k">elif</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">circuit_op</span><span class="p">,</span> <span class="n">Measurement</span><span class="p">):</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">add_measurement</span><span class="p">(</span>
                    <span class="n">circuit_op</span><span class="o">.</span><span class="n">name</span><span class="p">,</span>
                    <span class="n">targets</span><span class="o">=</span><span class="p">[</span><span class="n">target</span> <span class="o">+</span> <span class="n">start</span> <span class="k">for</span> <span class="n">target</span> <span class="ow">in</span> <span class="n">circuit_op</span><span class="o">.</span><span class="n">targets</span><span class="p">],</span>
                    <span class="n">classical_store</span><span class="o">=</span><span class="n">circuit_op</span><span class="o">.</span><span class="n">classical_store</span><span class="p">)</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="k">raise</span> <span class="ne">TypeError</span><span class="p">(</span><span class="s2">&quot;The circuit to be added contains unknown </span><span class="se">\</span>
<span class="s2">                    operator </span><span class="si">{}</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">circuit_op</span><span class="p">))</span></div>

<div class="viewcode-block" id="QubitCircuit.remove_gate_or_measurement"><a class="viewcode-back" href="../../../apidoc/classes.html#qutip.qip.QubitCircuit.remove_gate_or_measurement">[docs]</a>    <span class="k">def</span> <span class="nf">remove_gate_or_measurement</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">index</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">end</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
                                   <span class="n">name</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">remove</span><span class="o">=</span><span class="s2">&quot;first&quot;</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Remove a gate from a specific index or between two indexes or the</span>
<span class="sd">        first, last or all instances of a particular gate.</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        index : int</span>
<span class="sd">            Location of gate or measurement to be removed.</span>
<span class="sd">        name : string</span>
<span class="sd">            Gate or Measurement name to be removed.</span>
<span class="sd">        remove : string</span>
<span class="sd">            If first or all gates/measurements are to be removed.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="n">index</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">index</span> <span class="o">&gt;</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">gates</span><span class="p">):</span>
                <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">&quot;Index exceeds number </span><span class="se">\</span>
<span class="s2">                                    of gates + measurements.&quot;</span><span class="p">)</span>
            <span class="k">if</span> <span class="n">end</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span> <span class="ow">and</span> <span class="n">end</span> <span class="o">&lt;=</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">gates</span><span class="p">):</span>
                <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">end</span> <span class="o">-</span> <span class="n">index</span><span class="p">):</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">gates</span><span class="o">.</span><span class="n">pop</span><span class="p">(</span><span class="n">index</span> <span class="o">+</span> <span class="n">i</span><span class="p">)</span>
            <span class="k">elif</span> <span class="n">end</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span> <span class="ow">and</span> <span class="n">end</span> <span class="o">&gt;</span> <span class="bp">self</span><span class="o">.</span><span class="n">N</span><span class="p">:</span>
                <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">&quot;End target exceeds number </span><span class="se">\</span>
<span class="s2">                                    of gates + measurements.&quot;</span><span class="p">)</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">gates</span><span class="o">.</span><span class="n">pop</span><span class="p">(</span><span class="n">index</span><span class="p">)</span>

        <span class="k">elif</span> <span class="n">name</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span> <span class="ow">and</span> <span class="n">remove</span> <span class="o">==</span> <span class="s2">&quot;first&quot;</span><span class="p">:</span>
            <span class="k">for</span> <span class="n">circuit_op</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">gates</span><span class="p">:</span>
                <span class="k">if</span> <span class="n">name</span> <span class="o">==</span> <span class="n">circuit_op</span><span class="o">.</span><span class="n">name</span><span class="p">:</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">gates</span><span class="o">.</span><span class="n">remove</span><span class="p">(</span><span class="n">circuit_op</span><span class="p">)</span>
                    <span class="k">break</span>

        <span class="k">elif</span> <span class="n">name</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span> <span class="ow">and</span> <span class="n">remove</span> <span class="o">==</span> <span class="s2">&quot;last&quot;</span><span class="p">:</span>
            <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">reversed</span><span class="p">(</span><span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">gates</span><span class="p">))):</span>
                <span class="k">if</span> <span class="n">name</span> <span class="o">==</span> <span class="bp">self</span><span class="o">.</span><span class="n">gates</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="o">.</span><span class="n">name</span><span class="p">:</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">gates</span><span class="o">.</span><span class="n">pop</span><span class="p">(</span><span class="n">i</span><span class="p">)</span>
                    <span class="k">break</span>

        <span class="k">elif</span> <span class="n">name</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span> <span class="ow">and</span> <span class="n">remove</span> <span class="o">==</span> <span class="s2">&quot;all&quot;</span><span class="p">:</span>
            <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">reversed</span><span class="p">(</span><span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">gates</span><span class="p">))):</span>
                <span class="k">if</span> <span class="n">name</span> <span class="o">==</span> <span class="bp">self</span><span class="o">.</span><span class="n">gates</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="o">.</span><span class="n">name</span><span class="p">:</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">gates</span><span class="o">.</span><span class="n">pop</span><span class="p">(</span><span class="n">i</span><span class="p">)</span>

        <span class="k">else</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">gates</span><span class="o">.</span><span class="n">pop</span><span class="p">()</span></div>

<div class="viewcode-block" id="QubitCircuit.reverse_circuit"><a class="viewcode-back" href="../../../apidoc/classes.html#qutip.qip.QubitCircuit.reverse_circuit">[docs]</a>    <span class="k">def</span> <span class="nf">reverse_circuit</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Reverse an entire circuit of unitary gates.</span>

<span class="sd">        Returns</span>
<span class="sd">        -------</span>
<span class="sd">        qubit_circuit : :class:`.QubitCircuit`</span>
<span class="sd">            Return :class:`.QubitCircuit` of resolved gates for the</span>
<span class="sd">            qubit circuit in the reverse order.</span>

<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">temp</span> <span class="o">=</span> <span class="n">QubitCircuit</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">N</span><span class="p">,</span> <span class="n">reverse_states</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">reverse_states</span><span class="p">,</span>
                            <span class="n">num_cbits</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">num_cbits</span><span class="p">,</span>
                            <span class="n">input_states</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">input_states</span><span class="p">,</span>
                            <span class="n">output_states</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">output_states</span><span class="p">)</span>

        <span class="k">for</span> <span class="n">circuit_op</span> <span class="ow">in</span> <span class="nb">reversed</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">gates</span><span class="p">):</span>
            <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">circuit_op</span><span class="p">,</span> <span class="n">Gate</span><span class="p">):</span>
                <span class="n">temp</span><span class="o">.</span><span class="n">add_gate</span><span class="p">(</span><span class="n">circuit_op</span><span class="p">)</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">temp</span><span class="o">.</span><span class="n">add_measurement</span><span class="p">(</span><span class="n">circuit_op</span><span class="p">)</span>

        <span class="k">return</span> <span class="n">temp</span></div>

    <span class="k">def</span> <span class="nf">_resolve_to_universal</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">gate</span><span class="p">,</span> <span class="n">temp_resolved</span><span class="p">,</span> <span class="n">basis_1q</span><span class="p">,</span> <span class="n">basis_2q</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;A dispatch method&quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="n">gate</span><span class="o">.</span><span class="n">name</span> <span class="ow">in</span> <span class="n">basis_2q</span><span class="p">:</span>
            <span class="n">method</span> <span class="o">=</span> <span class="nb">getattr</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="s1">&#39;_gate_basis_2q&#39;</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">gate</span><span class="o">.</span><span class="n">name</span> <span class="o">==</span> <span class="s2">&quot;SWAP&quot;</span> <span class="ow">and</span> <span class="s2">&quot;ISWAP&quot;</span> <span class="ow">in</span> <span class="n">basis_2q</span><span class="p">:</span>
                <span class="n">method</span> <span class="o">=</span> <span class="nb">getattr</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="s1">&#39;_gate_IGNORED&#39;</span><span class="p">)</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">method</span> <span class="o">=</span> <span class="nb">getattr</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="s1">&#39;_gate_&#39;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">gate</span><span class="o">.</span><span class="n">name</span><span class="p">))</span>
        <span class="n">method</span><span class="p">(</span><span class="n">gate</span><span class="p">,</span> <span class="n">temp_resolved</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">_gate_IGNORED</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">gate</span><span class="p">,</span> <span class="n">temp_resolved</span><span class="p">):</span>
        <span class="n">temp_resolved</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">gate</span><span class="p">)</span>
    <span class="n">_gate_RY</span> <span class="o">=</span> <span class="n">_gate_RZ</span> <span class="o">=</span> <span class="n">_gate_basis_2q</span> <span class="o">=</span> <span class="n">_gate_IGNORED</span>
    <span class="n">_gate_CNOT</span> <span class="o">=</span> <span class="n">_gate_RX</span> <span class="o">=</span> <span class="n">_gate_IGNORED</span>

    <span class="k">def</span> <span class="nf">_gate_SQRTNOT</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">gate</span><span class="p">,</span> <span class="n">temp_resolved</span><span class="p">):</span>
        <span class="n">temp_resolved</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">Gate</span><span class="p">(</span><span class="s2">&quot;GLOBALPHASE&quot;</span><span class="p">,</span> <span class="kc">None</span><span class="p">,</span> <span class="kc">None</span><span class="p">,</span>
                                  <span class="n">arg_value</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">pi</span> <span class="o">/</span> <span class="mi">4</span><span class="p">,</span> <span class="n">arg_label</span><span class="o">=</span><span class="sa">r</span><span class="s2">&quot;\pi/4&quot;</span><span class="p">))</span>
        <span class="n">temp_resolved</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">Gate</span><span class="p">(</span><span class="s2">&quot;RX&quot;</span><span class="p">,</span> <span class="n">gate</span><span class="o">.</span><span class="n">targets</span><span class="p">,</span> <span class="kc">None</span><span class="p">,</span>
                                  <span class="n">arg_value</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">pi</span> <span class="o">/</span> <span class="mi">2</span><span class="p">,</span> <span class="n">arg_label</span><span class="o">=</span><span class="sa">r</span><span class="s2">&quot;\pi/2&quot;</span><span class="p">))</span>

    <span class="k">def</span> <span class="nf">_gate_SNOT</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">gate</span><span class="p">,</span> <span class="n">temp_resolved</span><span class="p">):</span>
        <span class="n">half_pi</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">pi</span> <span class="o">/</span> <span class="mi">2</span>
        <span class="n">temp_resolved</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">Gate</span><span class="p">(</span><span class="s2">&quot;GLOBALPHASE&quot;</span><span class="p">,</span> <span class="kc">None</span><span class="p">,</span> <span class="kc">None</span><span class="p">,</span>
                                  <span class="n">arg_value</span><span class="o">=</span><span class="n">half_pi</span><span class="p">,</span>
                                  <span class="n">arg_label</span><span class="o">=</span><span class="sa">r</span><span class="s2">&quot;\pi/2&quot;</span><span class="p">))</span>
        <span class="n">temp_resolved</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">Gate</span><span class="p">(</span><span class="s2">&quot;RY&quot;</span><span class="p">,</span> <span class="n">gate</span><span class="o">.</span><span class="n">targets</span><span class="p">,</span> <span class="kc">None</span><span class="p">,</span>
                                  <span class="n">arg_value</span><span class="o">=</span><span class="n">half_pi</span><span class="p">,</span>
                                  <span class="n">arg_label</span><span class="o">=</span><span class="sa">r</span><span class="s2">&quot;\pi/2&quot;</span><span class="p">))</span>
        <span class="n">temp_resolved</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">Gate</span><span class="p">(</span><span class="s2">&quot;RX&quot;</span><span class="p">,</span> <span class="n">gate</span><span class="o">.</span><span class="n">targets</span><span class="p">,</span> <span class="kc">None</span><span class="p">,</span>
                                  <span class="n">arg_value</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">pi</span><span class="p">,</span> <span class="n">arg_label</span><span class="o">=</span><span class="sa">r</span><span class="s2">&quot;\pi&quot;</span><span class="p">))</span>

    <span class="k">def</span> <span class="nf">_gate_PHASEGATE</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">gate</span><span class="p">,</span> <span class="n">temp_resolved</span><span class="p">):</span>
        <span class="n">temp_resolved</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">Gate</span><span class="p">(</span><span class="s2">&quot;GLOBALPHASE&quot;</span><span class="p">,</span> <span class="kc">None</span><span class="p">,</span> <span class="kc">None</span><span class="p">,</span>
                                  <span class="n">arg_value</span><span class="o">=</span><span class="n">gate</span><span class="o">.</span><span class="n">arg_value</span> <span class="o">/</span> <span class="mi">2</span><span class="p">,</span>
                                  <span class="n">arg_label</span><span class="o">=</span><span class="n">gate</span><span class="o">.</span><span class="n">arg_label</span><span class="p">))</span>
        <span class="n">temp_resolved</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">Gate</span><span class="p">(</span><span class="s2">&quot;RZ&quot;</span><span class="p">,</span> <span class="n">gate</span><span class="o">.</span><span class="n">targets</span><span class="p">,</span> <span class="kc">None</span><span class="p">,</span>
                                  <span class="n">gate</span><span class="o">.</span><span class="n">arg_value</span><span class="p">,</span> <span class="n">gate</span><span class="o">.</span><span class="n">arg_label</span><span class="p">))</span>

    <span class="k">def</span> <span class="nf">_gate_NOTIMPLEMENTED</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">gate</span><span class="p">,</span> <span class="n">temp_resolved</span><span class="p">):</span>
        <span class="k">raise</span> <span class="ne">NotImplementedError</span><span class="p">(</span><span class="s2">&quot;Cannot be resolved in this basis&quot;</span><span class="p">)</span>

    <span class="n">_gate_PHASEGATE</span> <span class="o">=</span> <span class="n">_gate_BERKELEY</span> <span class="o">=</span> <span class="n">_gate_SWAPalpha</span> <span class="o">=</span> <span class="n">_gate_NOTIMPLEMENTED</span>
    <span class="n">_gate_SQRTSWAP</span> <span class="o">=</span> <span class="n">_gate_SQRTISWAP</span> <span class="o">=</span> <span class="n">_gate_NOTIMPLEMENTED</span>

    <span class="k">def</span> <span class="nf">_gate_CSIGN</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">gate</span><span class="p">,</span> <span class="n">temp_resolved</span><span class="p">):</span>
        <span class="n">half_pi</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">pi</span> <span class="o">/</span> <span class="mi">2</span>
        <span class="n">temp_resolved</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">Gate</span><span class="p">(</span><span class="s2">&quot;RY&quot;</span><span class="p">,</span> <span class="n">gate</span><span class="o">.</span><span class="n">targets</span><span class="p">,</span> <span class="kc">None</span><span class="p">,</span>
                                  <span class="n">arg_value</span><span class="o">=</span><span class="n">half_pi</span><span class="p">,</span>
                                  <span class="n">arg_label</span><span class="o">=</span><span class="sa">r</span><span class="s2">&quot;\pi/2&quot;</span><span class="p">))</span>
        <span class="n">temp_resolved</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">Gate</span><span class="p">(</span><span class="s2">&quot;RX&quot;</span><span class="p">,</span> <span class="n">gate</span><span class="o">.</span><span class="n">targets</span><span class="p">,</span> <span class="kc">None</span><span class="p">,</span>
                                  <span class="n">arg_value</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">pi</span><span class="p">,</span> <span class="n">arg_label</span><span class="o">=</span><span class="sa">r</span><span class="s2">&quot;\pi&quot;</span><span class="p">))</span>
        <span class="n">temp_resolved</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">Gate</span><span class="p">(</span><span class="s2">&quot;CNOT&quot;</span><span class="p">,</span> <span class="n">gate</span><span class="o">.</span><span class="n">targets</span><span class="p">,</span> <span class="n">gate</span><span class="o">.</span><span class="n">controls</span><span class="p">))</span>
        <span class="n">temp_resolved</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">Gate</span><span class="p">(</span><span class="s2">&quot;RY&quot;</span><span class="p">,</span> <span class="n">gate</span><span class="o">.</span><span class="n">targets</span><span class="p">,</span> <span class="kc">None</span><span class="p">,</span>
                                  <span class="n">arg_value</span><span class="o">=</span><span class="n">half_pi</span><span class="p">,</span>
                                  <span class="n">arg_label</span><span class="o">=</span><span class="sa">r</span><span class="s2">&quot;\pi/2&quot;</span><span class="p">))</span>
        <span class="n">temp_resolved</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">Gate</span><span class="p">(</span><span class="s2">&quot;RX&quot;</span><span class="p">,</span> <span class="n">gate</span><span class="o">.</span><span class="n">targets</span><span class="p">,</span> <span class="kc">None</span><span class="p">,</span>
                                  <span class="n">arg_value</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">pi</span><span class="p">,</span> <span class="n">arg_label</span><span class="o">=</span><span class="sa">r</span><span class="s2">&quot;\pi&quot;</span><span class="p">))</span>
        <span class="n">temp_resolved</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">Gate</span><span class="p">(</span><span class="s2">&quot;GLOBALPHASE&quot;</span><span class="p">,</span> <span class="kc">None</span><span class="p">,</span> <span class="kc">None</span><span class="p">,</span>
                                  <span class="n">arg_value</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">pi</span><span class="p">,</span> <span class="n">arg_label</span><span class="o">=</span><span class="sa">r</span><span class="s2">&quot;\pi&quot;</span><span class="p">))</span>

    <span class="k">def</span> <span class="nf">_gate_SWAP</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">gate</span><span class="p">,</span> <span class="n">temp_resolved</span><span class="p">):</span>
        <span class="n">temp_resolved</span><span class="o">.</span><span class="n">append</span><span class="p">(</span>
            <span class="n">Gate</span><span class="p">(</span><span class="s2">&quot;CNOT&quot;</span><span class="p">,</span> <span class="n">gate</span><span class="o">.</span><span class="n">targets</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">gate</span><span class="o">.</span><span class="n">targets</span><span class="p">[</span><span class="mi">1</span><span class="p">]))</span>
        <span class="n">temp_resolved</span><span class="o">.</span><span class="n">append</span><span class="p">(</span>
            <span class="n">Gate</span><span class="p">(</span><span class="s2">&quot;CNOT&quot;</span><span class="p">,</span> <span class="n">gate</span><span class="o">.</span><span class="n">targets</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span> <span class="n">gate</span><span class="o">.</span><span class="n">targets</span><span class="p">[</span><span class="mi">0</span><span class="p">]))</span>
        <span class="n">temp_resolved</span><span class="o">.</span><span class="n">append</span><span class="p">(</span>
            <span class="n">Gate</span><span class="p">(</span><span class="s2">&quot;CNOT&quot;</span><span class="p">,</span> <span class="n">gate</span><span class="o">.</span><span class="n">targets</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">gate</span><span class="o">.</span><span class="n">targets</span><span class="p">[</span><span class="mi">1</span><span class="p">]))</span>

    <span class="k">def</span> <span class="nf">_gate_ISWAP</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">gate</span><span class="p">,</span> <span class="n">temp_resolved</span><span class="p">):</span>
        <span class="n">half_pi</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">pi</span> <span class="o">/</span> <span class="mi">2</span>
        <span class="n">temp_resolved</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">Gate</span><span class="p">(</span><span class="s2">&quot;CNOT&quot;</span><span class="p">,</span> <span class="n">gate</span><span class="o">.</span><span class="n">targets</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span>
                                  <span class="n">gate</span><span class="o">.</span><span class="n">targets</span><span class="p">[</span><span class="mi">1</span><span class="p">]))</span>
        <span class="n">temp_resolved</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">Gate</span><span class="p">(</span><span class="s2">&quot;CNOT&quot;</span><span class="p">,</span> <span class="n">gate</span><span class="o">.</span><span class="n">targets</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span>
                                  <span class="n">gate</span><span class="o">.</span><span class="n">targets</span><span class="p">[</span><span class="mi">0</span><span class="p">]))</span>
        <span class="n">temp_resolved</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">Gate</span><span class="p">(</span><span class="s2">&quot;CNOT&quot;</span><span class="p">,</span> <span class="n">gate</span><span class="o">.</span><span class="n">targets</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span>
                                  <span class="n">gate</span><span class="o">.</span><span class="n">targets</span><span class="p">[</span><span class="mi">1</span><span class="p">]))</span>
        <span class="n">temp_resolved</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">Gate</span><span class="p">(</span><span class="s2">&quot;RZ&quot;</span><span class="p">,</span> <span class="n">gate</span><span class="o">.</span><span class="n">targets</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="kc">None</span><span class="p">,</span>
                                  <span class="n">arg_value</span><span class="o">=</span><span class="n">half_pi</span><span class="p">,</span>
                                  <span class="n">arg_label</span><span class="o">=</span><span class="sa">r</span><span class="s2">&quot;\pi/2&quot;</span><span class="p">))</span>
        <span class="n">temp_resolved</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">Gate</span><span class="p">(</span><span class="s2">&quot;RZ&quot;</span><span class="p">,</span> <span class="n">gate</span><span class="o">.</span><span class="n">targets</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span> <span class="kc">None</span><span class="p">,</span>
                                  <span class="n">arg_value</span><span class="o">=</span><span class="n">half_pi</span><span class="p">,</span>
                                  <span class="n">arg_label</span><span class="o">=</span><span class="sa">r</span><span class="s2">&quot;\pi/2&quot;</span><span class="p">))</span>
        <span class="n">temp_resolved</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">Gate</span><span class="p">(</span><span class="s2">&quot;RY&quot;</span><span class="p">,</span> <span class="n">gate</span><span class="o">.</span><span class="n">targets</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="kc">None</span><span class="p">,</span>
                                  <span class="n">arg_value</span><span class="o">=</span><span class="n">half_pi</span><span class="p">,</span>
                                  <span class="n">arg_label</span><span class="o">=</span><span class="sa">r</span><span class="s2">&quot;\pi/2&quot;</span><span class="p">))</span>
        <span class="n">temp_resolved</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">Gate</span><span class="p">(</span><span class="s2">&quot;RX&quot;</span><span class="p">,</span> <span class="n">gate</span><span class="o">.</span><span class="n">targets</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="kc">None</span><span class="p">,</span>
                                  <span class="n">arg_value</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">pi</span><span class="p">,</span> <span class="n">arg_label</span><span class="o">=</span><span class="sa">r</span><span class="s2">&quot;\pi&quot;</span><span class="p">))</span>
        <span class="n">temp_resolved</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">Gate</span><span class="p">(</span><span class="s2">&quot;CNOT&quot;</span><span class="p">,</span> <span class="n">gate</span><span class="o">.</span><span class="n">targets</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span>
                                  <span class="n">gate</span><span class="o">.</span><span class="n">targets</span><span class="p">[</span><span class="mi">1</span><span class="p">]))</span>
        <span class="n">temp_resolved</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">Gate</span><span class="p">(</span><span class="s2">&quot;RY&quot;</span><span class="p">,</span> <span class="n">gate</span><span class="o">.</span><span class="n">targets</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="kc">None</span><span class="p">,</span>
                                  <span class="n">arg_value</span><span class="o">=</span><span class="n">half_pi</span><span class="p">,</span>
                                  <span class="n">arg_label</span><span class="o">=</span><span class="sa">r</span><span class="s2">&quot;\pi/2&quot;</span><span class="p">))</span>
        <span class="n">temp_resolved</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">Gate</span><span class="p">(</span><span class="s2">&quot;RX&quot;</span><span class="p">,</span> <span class="n">gate</span><span class="o">.</span><span class="n">targets</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="kc">None</span><span class="p">,</span>
                                  <span class="n">arg_value</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">pi</span><span class="p">,</span> <span class="n">arg_label</span><span class="o">=</span><span class="sa">r</span><span class="s2">&quot;\pi&quot;</span><span class="p">))</span>
        <span class="n">temp_resolved</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">Gate</span><span class="p">(</span><span class="s2">&quot;GLOBALPHASE&quot;</span><span class="p">,</span> <span class="kc">None</span><span class="p">,</span> <span class="kc">None</span><span class="p">,</span>
                                  <span class="n">arg_value</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">pi</span><span class="p">,</span> <span class="n">arg_label</span><span class="o">=</span><span class="sa">r</span><span class="s2">&quot;\pi&quot;</span><span class="p">))</span>
        <span class="n">temp_resolved</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">Gate</span><span class="p">(</span><span class="s2">&quot;GLOBALPHASE&quot;</span><span class="p">,</span> <span class="kc">None</span><span class="p">,</span> <span class="kc">None</span><span class="p">,</span>
                                  <span class="n">arg_value</span><span class="o">=</span><span class="n">half_pi</span><span class="p">,</span>
                                  <span class="n">arg_label</span><span class="o">=</span><span class="sa">r</span><span class="s2">&quot;\pi/2&quot;</span><span class="p">))</span>

    <span class="k">def</span> <span class="nf">_gate_FREDKIN</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">gate</span><span class="p">,</span> <span class="n">temp_resolved</span><span class="p">):</span>
        <span class="n">pi</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">pi</span>
        <span class="n">temp_resolved</span> <span class="o">+=</span> <span class="p">[</span>
            <span class="n">Gate</span><span class="p">(</span><span class="s2">&quot;CNOT&quot;</span><span class="p">,</span>
                 <span class="n">controls</span><span class="o">=</span><span class="n">gate</span><span class="o">.</span><span class="n">targets</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span>
                 <span class="n">targets</span><span class="o">=</span><span class="n">gate</span><span class="o">.</span><span class="n">targets</span><span class="p">[</span><span class="mi">0</span><span class="p">]),</span>
            <span class="n">Gate</span><span class="p">(</span><span class="s2">&quot;RZ&quot;</span><span class="p">,</span>
                 <span class="n">controls</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
                 <span class="n">targets</span><span class="o">=</span><span class="n">gate</span><span class="o">.</span><span class="n">targets</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span>
                 <span class="n">arg_value</span><span class="o">=</span><span class="n">pi</span><span class="p">,</span>
                 <span class="n">arg_label</span><span class="o">=</span><span class="sa">r</span><span class="s2">&quot;\pi&quot;</span><span class="p">),</span>
            <span class="n">Gate</span><span class="p">(</span><span class="s2">&quot;RX&quot;</span><span class="p">,</span>
                 <span class="n">controls</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
                 <span class="n">targets</span><span class="o">=</span><span class="n">gate</span><span class="o">.</span><span class="n">targets</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span>
                 <span class="n">arg_value</span><span class="o">=</span><span class="n">pi</span> <span class="o">/</span> <span class="mi">2</span><span class="p">,</span>
                 <span class="n">arg_label</span><span class="o">=</span><span class="sa">r</span><span class="s2">&quot;\pi/2&quot;</span><span class="p">),</span>
            <span class="n">Gate</span><span class="p">(</span><span class="s2">&quot;RZ&quot;</span><span class="p">,</span>
                 <span class="n">controls</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
                 <span class="n">targets</span><span class="o">=</span><span class="n">gate</span><span class="o">.</span><span class="n">targets</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span>
                 <span class="n">arg_value</span><span class="o">=-</span> <span class="n">pi</span> <span class="o">/</span> <span class="mi">2</span><span class="p">,</span>
                 <span class="n">arg_label</span><span class="o">=</span><span class="sa">r</span><span class="s2">&quot;-\pi/2&quot;</span><span class="p">),</span>
            <span class="n">Gate</span><span class="p">(</span><span class="s2">&quot;RX&quot;</span><span class="p">,</span>
                 <span class="n">controls</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
                 <span class="n">targets</span><span class="o">=</span><span class="n">gate</span><span class="o">.</span><span class="n">targets</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span>
                 <span class="n">arg_value</span><span class="o">=</span><span class="n">pi</span> <span class="o">/</span> <span class="mi">2</span><span class="p">,</span>
                 <span class="n">arg_label</span><span class="o">=</span><span class="sa">r</span><span class="s2">&quot;\pi/2&quot;</span><span class="p">),</span>
            <span class="n">Gate</span><span class="p">(</span><span class="s2">&quot;RZ&quot;</span><span class="p">,</span>
                 <span class="n">controls</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
                 <span class="n">targets</span><span class="o">=</span><span class="n">gate</span><span class="o">.</span><span class="n">targets</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span>
                 <span class="n">arg_value</span><span class="o">=</span><span class="n">pi</span><span class="p">,</span>
                 <span class="n">arg_label</span><span class="o">=</span><span class="sa">r</span><span class="s2">&quot;\pi&quot;</span><span class="p">),</span>
            <span class="n">Gate</span><span class="p">(</span><span class="s2">&quot;CNOT&quot;</span><span class="p">,</span>
                 <span class="n">controls</span><span class="o">=</span><span class="n">gate</span><span class="o">.</span><span class="n">targets</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span>
                 <span class="n">targets</span><span class="o">=</span><span class="n">gate</span><span class="o">.</span><span class="n">targets</span><span class="p">[</span><span class="mi">1</span><span class="p">]),</span>
            <span class="n">Gate</span><span class="p">(</span><span class="s2">&quot;RZ&quot;</span><span class="p">,</span>
                 <span class="n">controls</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
                 <span class="n">targets</span><span class="o">=</span><span class="n">gate</span><span class="o">.</span><span class="n">targets</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span>
                 <span class="n">arg_value</span><span class="o">=-</span> <span class="n">pi</span> <span class="o">/</span> <span class="mi">4</span><span class="p">,</span>
                 <span class="n">arg_label</span><span class="o">=</span><span class="sa">r</span><span class="s2">&quot;-\pi/4&quot;</span><span class="p">),</span>
            <span class="n">Gate</span><span class="p">(</span><span class="s2">&quot;CNOT&quot;</span><span class="p">,</span>
                 <span class="n">controls</span><span class="o">=</span><span class="n">gate</span><span class="o">.</span><span class="n">controls</span><span class="p">,</span>
                 <span class="n">targets</span><span class="o">=</span><span class="n">gate</span><span class="o">.</span><span class="n">targets</span><span class="p">[</span><span class="mi">1</span><span class="p">]),</span>
            <span class="n">Gate</span><span class="p">(</span><span class="s2">&quot;RZ&quot;</span><span class="p">,</span>
                 <span class="n">controls</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
                 <span class="n">targets</span><span class="o">=</span><span class="n">gate</span><span class="o">.</span><span class="n">targets</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span>
                 <span class="n">arg_value</span><span class="o">=</span><span class="n">pi</span> <span class="o">/</span> <span class="mi">4</span><span class="p">,</span>
                 <span class="n">arg_label</span><span class="o">=</span><span class="sa">r</span><span class="s2">&quot;\pi/4&quot;</span><span class="p">),</span>
            <span class="n">Gate</span><span class="p">(</span><span class="s2">&quot;CNOT&quot;</span><span class="p">,</span>
                 <span class="n">controls</span><span class="o">=</span><span class="n">gate</span><span class="o">.</span><span class="n">targets</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span>
                 <span class="n">targets</span><span class="o">=</span><span class="n">gate</span><span class="o">.</span><span class="n">targets</span><span class="p">[</span><span class="mi">1</span><span class="p">]),</span>
            <span class="n">Gate</span><span class="p">(</span><span class="s2">&quot;RZ&quot;</span><span class="p">,</span>
                 <span class="n">controls</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
                 <span class="n">targets</span><span class="o">=</span><span class="n">gate</span><span class="o">.</span><span class="n">targets</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span>
                 <span class="n">arg_value</span><span class="o">=</span><span class="n">pi</span> <span class="o">/</span> <span class="mi">4</span><span class="p">,</span>
                 <span class="n">arg_label</span><span class="o">=</span><span class="sa">r</span><span class="s2">&quot;\pi/4&quot;</span><span class="p">),</span>
            <span class="n">Gate</span><span class="p">(</span><span class="s2">&quot;RZ&quot;</span><span class="p">,</span>
                 <span class="n">controls</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
                 <span class="n">targets</span><span class="o">=</span><span class="n">gate</span><span class="o">.</span><span class="n">targets</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span>
                 <span class="n">arg_value</span><span class="o">=-</span> <span class="n">pi</span> <span class="o">/</span> <span class="mi">4</span><span class="p">,</span>
                 <span class="n">arg_label</span><span class="o">=</span><span class="sa">r</span><span class="s2">&quot;-\pi/4&quot;</span><span class="p">),</span>
            <span class="n">Gate</span><span class="p">(</span><span class="s2">&quot;CNOT&quot;</span><span class="p">,</span>
                 <span class="n">controls</span><span class="o">=</span><span class="n">gate</span><span class="o">.</span><span class="n">controls</span><span class="p">,</span>
                 <span class="n">targets</span><span class="o">=</span><span class="n">gate</span><span class="o">.</span><span class="n">targets</span><span class="p">[</span><span class="mi">1</span><span class="p">]),</span>
            <span class="n">Gate</span><span class="p">(</span><span class="s2">&quot;CNOT&quot;</span><span class="p">,</span>
                 <span class="n">controls</span><span class="o">=</span><span class="n">gate</span><span class="o">.</span><span class="n">controls</span><span class="p">,</span>
                 <span class="n">targets</span><span class="o">=</span><span class="n">gate</span><span class="o">.</span><span class="n">targets</span><span class="p">[</span><span class="mi">0</span><span class="p">]),</span>
            <span class="n">Gate</span><span class="p">(</span><span class="s2">&quot;RZ&quot;</span><span class="p">,</span>
                 <span class="n">controls</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
                 <span class="n">targets</span><span class="o">=</span><span class="n">gate</span><span class="o">.</span><span class="n">controls</span><span class="p">,</span>
                 <span class="n">arg_value</span><span class="o">=</span><span class="n">pi</span> <span class="o">/</span> <span class="mi">4</span><span class="p">,</span>
                 <span class="n">arg_label</span><span class="o">=</span><span class="sa">r</span><span class="s2">&quot;\pi/4&quot;</span><span class="p">),</span>
            <span class="n">Gate</span><span class="p">(</span><span class="s2">&quot;RZ&quot;</span><span class="p">,</span>
                 <span class="n">controls</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
                 <span class="n">targets</span><span class="o">=</span><span class="n">gate</span><span class="o">.</span><span class="n">targets</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span>
                 <span class="n">arg_value</span><span class="o">=-</span> <span class="n">pi</span> <span class="o">/</span> <span class="mi">4</span><span class="p">,</span>
                 <span class="n">arg_label</span><span class="o">=</span><span class="sa">r</span><span class="s2">&quot;-\pi/4&quot;</span><span class="p">),</span>
            <span class="n">Gate</span><span class="p">(</span><span class="s2">&quot;CNOT&quot;</span><span class="p">,</span>
                 <span class="n">controls</span><span class="o">=</span><span class="n">gate</span><span class="o">.</span><span class="n">controls</span><span class="p">,</span>
                 <span class="n">targets</span><span class="o">=</span><span class="n">gate</span><span class="o">.</span><span class="n">targets</span><span class="p">[</span><span class="mi">0</span><span class="p">]),</span>
            <span class="n">Gate</span><span class="p">(</span><span class="s2">&quot;RZ&quot;</span><span class="p">,</span>
                 <span class="n">controls</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
                 <span class="n">targets</span><span class="o">=</span><span class="n">gate</span><span class="o">.</span><span class="n">targets</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span>
                 <span class="n">arg_value</span><span class="o">=-</span> <span class="mi">3</span> <span class="o">*</span> <span class="n">pi</span> <span class="o">/</span> <span class="mi">4</span><span class="p">,</span>
                 <span class="n">arg_label</span><span class="o">=</span><span class="sa">r</span><span class="s2">&quot;-3\pi/4&quot;</span><span class="p">),</span>
            <span class="n">Gate</span><span class="p">(</span><span class="s2">&quot;RX&quot;</span><span class="p">,</span>
                 <span class="n">controls</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
                 <span class="n">targets</span><span class="o">=</span><span class="n">gate</span><span class="o">.</span><span class="n">targets</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span>
                 <span class="n">arg_value</span><span class="o">=</span><span class="n">pi</span> <span class="o">/</span> <span class="mi">2</span><span class="p">,</span>
                 <span class="n">arg_label</span><span class="o">=</span><span class="sa">r</span><span class="s2">&quot;\pi/2&quot;</span><span class="p">),</span>
            <span class="n">Gate</span><span class="p">(</span><span class="s2">&quot;RZ&quot;</span><span class="p">,</span>
                 <span class="n">controls</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
                 <span class="n">targets</span><span class="o">=</span><span class="n">gate</span><span class="o">.</span><span class="n">targets</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span>
                 <span class="n">arg_value</span><span class="o">=-</span> <span class="n">pi</span> <span class="o">/</span> <span class="mi">2</span><span class="p">,</span>
                 <span class="n">arg_label</span><span class="o">=</span><span class="sa">r</span><span class="s2">&quot;-\pi/2&quot;</span><span class="p">),</span>
            <span class="n">Gate</span><span class="p">(</span><span class="s2">&quot;RX&quot;</span><span class="p">,</span>
                 <span class="n">controls</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
                 <span class="n">targets</span><span class="o">=</span><span class="n">gate</span><span class="o">.</span><span class="n">targets</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span>
                 <span class="n">arg_value</span><span class="o">=</span><span class="n">pi</span> <span class="o">/</span> <span class="mi">2</span><span class="p">,</span>
                 <span class="n">arg_label</span><span class="o">=</span><span class="sa">r</span><span class="s2">&quot;\pi/2&quot;</span><span class="p">),</span>
            <span class="n">Gate</span><span class="p">(</span><span class="s2">&quot;RZ&quot;</span><span class="p">,</span>
                 <span class="n">controls</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
                 <span class="n">targets</span><span class="o">=</span><span class="n">gate</span><span class="o">.</span><span class="n">targets</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span>
                 <span class="n">arg_value</span><span class="o">=</span><span class="n">pi</span><span class="p">,</span>
                 <span class="n">arg_label</span><span class="o">=</span><span class="sa">r</span><span class="s2">&quot;\pi&quot;</span><span class="p">),</span>
            <span class="n">Gate</span><span class="p">(</span><span class="s2">&quot;CNOT&quot;</span><span class="p">,</span>
                 <span class="n">controls</span><span class="o">=</span><span class="n">gate</span><span class="o">.</span><span class="n">targets</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span>
                 <span class="n">targets</span><span class="o">=</span><span class="n">gate</span><span class="o">.</span><span class="n">targets</span><span class="p">[</span><span class="mi">0</span><span class="p">]),</span>
            <span class="n">Gate</span><span class="p">(</span><span class="s2">&quot;GLOBALPHASE&quot;</span><span class="p">,</span>
                 <span class="n">controls</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
                 <span class="n">targets</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
                 <span class="n">arg_value</span><span class="o">=</span><span class="n">pi</span> <span class="o">/</span> <span class="mi">8</span><span class="p">,</span>
                 <span class="n">arg_label</span><span class="o">=</span><span class="sa">r</span><span class="s2">&quot;\pi/8&quot;</span><span class="p">)</span>
        <span class="p">]</span>

    <span class="k">def</span> <span class="nf">_gate_TOFFOLI</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">gate</span><span class="p">,</span> <span class="n">temp_resolved</span><span class="p">):</span>
        <span class="n">half_pi</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">pi</span> <span class="o">/</span> <span class="mi">2</span>
        <span class="n">quarter_pi</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">pi</span> <span class="o">/</span> <span class="mi">4</span>
        <span class="n">temp_resolved</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">Gate</span><span class="p">(</span><span class="s2">&quot;GLOBALPHASE&quot;</span><span class="p">,</span> <span class="kc">None</span><span class="p">,</span> <span class="kc">None</span><span class="p">,</span>
                                  <span class="n">arg_value</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">pi</span> <span class="o">/</span> <span class="mi">8</span><span class="p">,</span>
                                  <span class="n">arg_label</span><span class="o">=</span><span class="sa">r</span><span class="s2">&quot;\pi/8&quot;</span><span class="p">))</span>
        <span class="n">temp_resolved</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">Gate</span><span class="p">(</span><span class="s2">&quot;RZ&quot;</span><span class="p">,</span> <span class="n">gate</span><span class="o">.</span><span class="n">controls</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span> <span class="kc">None</span><span class="p">,</span>
                                  <span class="n">arg_value</span><span class="o">=</span><span class="n">half_pi</span><span class="p">,</span>
                                  <span class="n">arg_label</span><span class="o">=</span><span class="sa">r</span><span class="s2">&quot;\pi/2&quot;</span><span class="p">))</span>
        <span class="n">temp_resolved</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">Gate</span><span class="p">(</span><span class="s2">&quot;RZ&quot;</span><span class="p">,</span> <span class="n">gate</span><span class="o">.</span><span class="n">controls</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="kc">None</span><span class="p">,</span>
                                  <span class="n">arg_value</span><span class="o">=</span><span class="n">quarter_pi</span><span class="p">,</span>
                                  <span class="n">arg_label</span><span class="o">=</span><span class="sa">r</span><span class="s2">&quot;\pi/4&quot;</span><span class="p">))</span>
        <span class="n">temp_resolved</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">Gate</span><span class="p">(</span><span class="s2">&quot;CNOT&quot;</span><span class="p">,</span> <span class="n">gate</span><span class="o">.</span><span class="n">controls</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span>
                                  <span class="n">gate</span><span class="o">.</span><span class="n">controls</span><span class="p">[</span><span class="mi">0</span><span class="p">]))</span>
        <span class="n">temp_resolved</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">Gate</span><span class="p">(</span><span class="s2">&quot;RZ&quot;</span><span class="p">,</span> <span class="n">gate</span><span class="o">.</span><span class="n">controls</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span> <span class="kc">None</span><span class="p">,</span>
                                  <span class="n">arg_value</span><span class="o">=-</span><span class="n">quarter_pi</span><span class="p">,</span>
                                  <span class="n">arg_label</span><span class="o">=</span><span class="sa">r</span><span class="s2">&quot;-\pi/4&quot;</span><span class="p">))</span>
        <span class="n">temp_resolved</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">Gate</span><span class="p">(</span><span class="s2">&quot;CNOT&quot;</span><span class="p">,</span> <span class="n">gate</span><span class="o">.</span><span class="n">controls</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span>
                                  <span class="n">gate</span><span class="o">.</span><span class="n">controls</span><span class="p">[</span><span class="mi">0</span><span class="p">]))</span>
        <span class="n">temp_resolved</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">Gate</span><span class="p">(</span><span class="s2">&quot;GLOBALPHASE&quot;</span><span class="p">,</span> <span class="kc">None</span><span class="p">,</span> <span class="kc">None</span><span class="p">,</span>
                                  <span class="n">arg_value</span><span class="o">=</span><span class="n">half_pi</span><span class="p">,</span>
                                  <span class="n">arg_label</span><span class="o">=</span><span class="sa">r</span><span class="s2">&quot;\pi/2&quot;</span><span class="p">))</span>
        <span class="n">temp_resolved</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">Gate</span><span class="p">(</span><span class="s2">&quot;RY&quot;</span><span class="p">,</span> <span class="n">gate</span><span class="o">.</span><span class="n">targets</span><span class="p">,</span> <span class="kc">None</span><span class="p">,</span>
                                  <span class="n">arg_value</span><span class="o">=</span><span class="n">half_pi</span><span class="p">,</span>
                                  <span class="n">arg_label</span><span class="o">=</span><span class="sa">r</span><span class="s2">&quot;\pi/2&quot;</span><span class="p">))</span>
        <span class="n">temp_resolved</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">Gate</span><span class="p">(</span><span class="s2">&quot;RX&quot;</span><span class="p">,</span> <span class="n">gate</span><span class="o">.</span><span class="n">targets</span><span class="p">,</span> <span class="kc">None</span><span class="p">,</span>
                                  <span class="n">arg_value</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">pi</span><span class="p">,</span> <span class="n">arg_label</span><span class="o">=</span><span class="sa">r</span><span class="s2">&quot;\pi&quot;</span><span class="p">))</span>
        <span class="n">temp_resolved</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">Gate</span><span class="p">(</span><span class="s2">&quot;RZ&quot;</span><span class="p">,</span> <span class="n">gate</span><span class="o">.</span><span class="n">controls</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span> <span class="kc">None</span><span class="p">,</span>
                                  <span class="n">arg_value</span><span class="o">=-</span><span class="n">quarter_pi</span><span class="p">,</span>
                                  <span class="n">arg_label</span><span class="o">=</span><span class="sa">r</span><span class="s2">&quot;-\pi/4&quot;</span><span class="p">))</span>
        <span class="n">temp_resolved</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">Gate</span><span class="p">(</span><span class="s2">&quot;RZ&quot;</span><span class="p">,</span> <span class="n">gate</span><span class="o">.</span><span class="n">targets</span><span class="p">,</span> <span class="kc">None</span><span class="p">,</span>
                                  <span class="n">arg_value</span><span class="o">=</span><span class="n">quarter_pi</span><span class="p">,</span>
                                  <span class="n">arg_label</span><span class="o">=</span><span class="sa">r</span><span class="s2">&quot;\pi/4&quot;</span><span class="p">))</span>
        <span class="n">temp_resolved</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">Gate</span><span class="p">(</span><span class="s2">&quot;CNOT&quot;</span><span class="p">,</span> <span class="n">gate</span><span class="o">.</span><span class="n">targets</span><span class="p">,</span>
                                  <span class="n">gate</span><span class="o">.</span><span class="n">controls</span><span class="p">[</span><span class="mi">0</span><span class="p">]))</span>
        <span class="n">temp_resolved</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">Gate</span><span class="p">(</span><span class="s2">&quot;RZ&quot;</span><span class="p">,</span> <span class="n">gate</span><span class="o">.</span><span class="n">targets</span><span class="p">,</span> <span class="kc">None</span><span class="p">,</span>
                                  <span class="n">arg_value</span><span class="o">=-</span><span class="n">quarter_pi</span><span class="p">,</span>
                                  <span class="n">arg_label</span><span class="o">=</span><span class="sa">r</span><span class="s2">&quot;-\pi/4&quot;</span><span class="p">))</span>
        <span class="n">temp_resolved</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">Gate</span><span class="p">(</span><span class="s2">&quot;CNOT&quot;</span><span class="p">,</span> <span class="n">gate</span><span class="o">.</span><span class="n">targets</span><span class="p">,</span>
                                  <span class="n">gate</span><span class="o">.</span><span class="n">controls</span><span class="p">[</span><span class="mi">1</span><span class="p">]))</span>
        <span class="n">temp_resolved</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">Gate</span><span class="p">(</span><span class="s2">&quot;RZ&quot;</span><span class="p">,</span> <span class="n">gate</span><span class="o">.</span><span class="n">targets</span><span class="p">,</span> <span class="kc">None</span><span class="p">,</span>
                                  <span class="n">arg_value</span><span class="o">=</span><span class="n">quarter_pi</span><span class="p">,</span>
                                  <span class="n">arg_label</span><span class="o">=</span><span class="sa">r</span><span class="s2">&quot;\pi/4&quot;</span><span class="p">))</span>
        <span class="n">temp_resolved</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">Gate</span><span class="p">(</span><span class="s2">&quot;CNOT&quot;</span><span class="p">,</span> <span class="n">gate</span><span class="o">.</span><span class="n">targets</span><span class="p">,</span>
                                  <span class="n">gate</span><span class="o">.</span><span class="n">controls</span><span class="p">[</span><span class="mi">0</span><span class="p">]))</span>
        <span class="n">temp_resolved</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">Gate</span><span class="p">(</span><span class="s2">&quot;RZ&quot;</span><span class="p">,</span> <span class="n">gate</span><span class="o">.</span><span class="n">targets</span><span class="p">,</span> <span class="kc">None</span><span class="p">,</span>
                                  <span class="n">arg_value</span><span class="o">=-</span><span class="n">quarter_pi</span><span class="p">,</span>
                                  <span class="n">arg_label</span><span class="o">=</span><span class="sa">r</span><span class="s2">&quot;-\pi/4&quot;</span><span class="p">))</span>
        <span class="n">temp_resolved</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">Gate</span><span class="p">(</span><span class="s2">&quot;CNOT&quot;</span><span class="p">,</span> <span class="n">gate</span><span class="o">.</span><span class="n">targets</span><span class="p">,</span>
                                  <span class="n">gate</span><span class="o">.</span><span class="n">controls</span><span class="p">[</span><span class="mi">1</span><span class="p">]))</span>
        <span class="n">temp_resolved</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">Gate</span><span class="p">(</span><span class="s2">&quot;GLOBALPHASE&quot;</span><span class="p">,</span> <span class="kc">None</span><span class="p">,</span> <span class="kc">None</span><span class="p">,</span>
                                  <span class="n">arg_value</span><span class="o">=</span><span class="n">half_pi</span><span class="p">,</span>
                                  <span class="n">arg_label</span><span class="o">=</span><span class="sa">r</span><span class="s2">&quot;\pi/2&quot;</span><span class="p">))</span>
        <span class="n">temp_resolved</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">Gate</span><span class="p">(</span><span class="s2">&quot;RY&quot;</span><span class="p">,</span> <span class="n">gate</span><span class="o">.</span><span class="n">targets</span><span class="p">,</span> <span class="kc">None</span><span class="p">,</span>
                                  <span class="n">arg_value</span><span class="o">=</span><span class="n">half_pi</span><span class="p">,</span>
                                  <span class="n">arg_label</span><span class="o">=</span><span class="sa">r</span><span class="s2">&quot;\pi/2&quot;</span><span class="p">))</span>
        <span class="n">temp_resolved</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">Gate</span><span class="p">(</span><span class="s2">&quot;RX&quot;</span><span class="p">,</span> <span class="n">gate</span><span class="o">.</span><span class="n">targets</span><span class="p">,</span> <span class="kc">None</span><span class="p">,</span>
                                  <span class="n">arg_value</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">pi</span><span class="p">,</span> <span class="n">arg_label</span><span class="o">=</span><span class="sa">r</span><span class="s2">&quot;\pi&quot;</span><span class="p">))</span>

    <span class="k">def</span> <span class="nf">_gate_GLOBALPHASE</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">gate</span><span class="p">,</span> <span class="n">temp_resolved</span><span class="p">):</span>
        <span class="n">temp_resolved</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">Gate</span><span class="p">(</span><span class="n">gate</span><span class="o">.</span><span class="n">name</span><span class="p">,</span> <span class="n">gate</span><span class="o">.</span><span class="n">targets</span><span class="p">,</span>
                                  <span class="n">gate</span><span class="o">.</span><span class="n">controls</span><span class="p">,</span>
                                  <span class="n">gate</span><span class="o">.</span><span class="n">arg_value</span><span class="p">,</span> <span class="n">gate</span><span class="o">.</span><span class="n">arg_label</span><span class="p">))</span>

    <span class="k">def</span> <span class="nf">_resolve_2q_basis</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">basis</span><span class="p">,</span> <span class="n">qc_temp</span><span class="p">,</span> <span class="n">temp_resolved</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Dispatch method&quot;&quot;&quot;</span>
        <span class="n">method</span> <span class="o">=</span> <span class="nb">getattr</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="s1">&#39;_basis_&#39;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">basis</span><span class="p">),</span> <span class="n">temp_resolved</span><span class="p">)</span>
        <span class="n">method</span><span class="p">(</span><span class="n">qc_temp</span><span class="p">,</span> <span class="n">temp_resolved</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">_basis_CSIGN</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">qc_temp</span><span class="p">,</span> <span class="n">temp_resolved</span><span class="p">):</span>
        <span class="n">half_pi</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">pi</span> <span class="o">/</span> <span class="mi">2</span>
        <span class="k">for</span> <span class="n">gate</span> <span class="ow">in</span> <span class="n">temp_resolved</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">gate</span><span class="o">.</span><span class="n">name</span> <span class="o">==</span> <span class="s2">&quot;CNOT&quot;</span><span class="p">:</span>
                <span class="n">qc_temp</span><span class="o">.</span><span class="n">gates</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">Gate</span><span class="p">(</span><span class="s2">&quot;RY&quot;</span><span class="p">,</span> <span class="n">gate</span><span class="o">.</span><span class="n">targets</span><span class="p">,</span> <span class="kc">None</span><span class="p">,</span>
                                          <span class="n">arg_value</span><span class="o">=-</span><span class="n">half_pi</span><span class="p">,</span>
                                          <span class="n">arg_label</span><span class="o">=</span><span class="sa">r</span><span class="s2">&quot;-\pi/2&quot;</span><span class="p">))</span>
                <span class="n">qc_temp</span><span class="o">.</span><span class="n">gates</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">Gate</span><span class="p">(</span><span class="s2">&quot;CSIGN&quot;</span><span class="p">,</span> <span class="n">gate</span><span class="o">.</span><span class="n">targets</span><span class="p">,</span>
                                          <span class="n">gate</span><span class="o">.</span><span class="n">controls</span><span class="p">))</span>
                <span class="n">qc_temp</span><span class="o">.</span><span class="n">gates</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">Gate</span><span class="p">(</span><span class="s2">&quot;RY&quot;</span><span class="p">,</span> <span class="n">gate</span><span class="o">.</span><span class="n">targets</span><span class="p">,</span> <span class="kc">None</span><span class="p">,</span>
                                          <span class="n">arg_value</span><span class="o">=</span><span class="n">half_pi</span><span class="p">,</span>
                                          <span class="n">arg_label</span><span class="o">=</span><span class="sa">r</span><span class="s2">&quot;\pi/2&quot;</span><span class="p">))</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">qc_temp</span><span class="o">.</span><span class="n">gates</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">gate</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">_basis_ISWAP</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">qc_temp</span><span class="p">,</span> <span class="n">temp_resolved</span><span class="p">):</span>
        <span class="n">half_pi</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">pi</span> <span class="o">/</span> <span class="mi">2</span>
        <span class="n">quarter_pi</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">pi</span> <span class="o">/</span> <span class="mi">4</span>
        <span class="k">for</span> <span class="n">gate</span> <span class="ow">in</span> <span class="n">temp_resolved</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">gate</span><span class="o">.</span><span class="n">name</span> <span class="o">==</span> <span class="s2">&quot;CNOT&quot;</span><span class="p">:</span>
                <span class="n">qc_temp</span><span class="o">.</span><span class="n">gates</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">Gate</span><span class="p">(</span><span class="s2">&quot;GLOBALPHASE&quot;</span><span class="p">,</span> <span class="kc">None</span><span class="p">,</span> <span class="kc">None</span><span class="p">,</span>
                                          <span class="n">arg_value</span><span class="o">=</span><span class="n">quarter_pi</span><span class="p">,</span>
                                          <span class="n">arg_label</span><span class="o">=</span><span class="sa">r</span><span class="s2">&quot;\pi/4&quot;</span><span class="p">))</span>
                <span class="n">qc_temp</span><span class="o">.</span><span class="n">gates</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">Gate</span><span class="p">(</span><span class="s2">&quot;ISWAP&quot;</span><span class="p">,</span> <span class="p">[</span><span class="n">gate</span><span class="o">.</span><span class="n">controls</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span>
                                          <span class="n">gate</span><span class="o">.</span><span class="n">targets</span><span class="p">[</span><span class="mi">0</span><span class="p">]],</span>
                                          <span class="kc">None</span><span class="p">))</span>
                <span class="n">qc_temp</span><span class="o">.</span><span class="n">gates</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">Gate</span><span class="p">(</span><span class="s2">&quot;RZ&quot;</span><span class="p">,</span> <span class="n">gate</span><span class="o">.</span><span class="n">targets</span><span class="p">,</span> <span class="kc">None</span><span class="p">,</span>
                                          <span class="n">arg_value</span><span class="o">=-</span><span class="n">half_pi</span><span class="p">,</span>
                                          <span class="n">arg_label</span><span class="o">=</span><span class="sa">r</span><span class="s2">&quot;-\pi/2&quot;</span><span class="p">))</span>
                <span class="n">qc_temp</span><span class="o">.</span><span class="n">gates</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">Gate</span><span class="p">(</span><span class="s2">&quot;RY&quot;</span><span class="p">,</span> <span class="n">gate</span><span class="o">.</span><span class="n">controls</span><span class="p">,</span> <span class="kc">None</span><span class="p">,</span>
                                          <span class="n">arg_value</span><span class="o">=-</span><span class="n">half_pi</span><span class="p">,</span>
                                          <span class="n">arg_label</span><span class="o">=</span><span class="sa">r</span><span class="s2">&quot;-\pi/2&quot;</span><span class="p">))</span>
                <span class="n">qc_temp</span><span class="o">.</span><span class="n">gates</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">Gate</span><span class="p">(</span><span class="s2">&quot;RZ&quot;</span><span class="p">,</span> <span class="n">gate</span><span class="o">.</span><span class="n">controls</span><span class="p">,</span> <span class="kc">None</span><span class="p">,</span>
                                          <span class="n">arg_value</span><span class="o">=</span><span class="n">half_pi</span><span class="p">,</span>
                                          <span class="n">arg_label</span><span class="o">=</span><span class="sa">r</span><span class="s2">&quot;\pi/2&quot;</span><span class="p">))</span>
                <span class="n">qc_temp</span><span class="o">.</span><span class="n">gates</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">Gate</span><span class="p">(</span><span class="s2">&quot;ISWAP&quot;</span><span class="p">,</span> <span class="p">[</span><span class="n">gate</span><span class="o">.</span><span class="n">controls</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span>
                                          <span class="n">gate</span><span class="o">.</span><span class="n">targets</span><span class="p">[</span><span class="mi">0</span><span class="p">]],</span> <span class="kc">None</span><span class="p">))</span>
                <span class="n">qc_temp</span><span class="o">.</span><span class="n">gates</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">Gate</span><span class="p">(</span><span class="s2">&quot;RY&quot;</span><span class="p">,</span> <span class="n">gate</span><span class="o">.</span><span class="n">targets</span><span class="p">,</span> <span class="kc">None</span><span class="p">,</span>
                                          <span class="n">arg_value</span><span class="o">=-</span><span class="n">half_pi</span><span class="p">,</span>
                                          <span class="n">arg_label</span><span class="o">=</span><span class="sa">r</span><span class="s2">&quot;-\pi/2&quot;</span><span class="p">))</span>
                <span class="n">qc_temp</span><span class="o">.</span><span class="n">gates</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">Gate</span><span class="p">(</span><span class="s2">&quot;RZ&quot;</span><span class="p">,</span> <span class="n">gate</span><span class="o">.</span><span class="n">targets</span><span class="p">,</span> <span class="kc">None</span><span class="p">,</span>
                                          <span class="n">arg_value</span><span class="o">=</span><span class="n">half_pi</span><span class="p">,</span>
                                          <span class="n">arg_label</span><span class="o">=</span><span class="sa">r</span><span class="s2">&quot;\pi/2&quot;</span><span class="p">))</span>
            <span class="k">elif</span> <span class="n">gate</span><span class="o">.</span><span class="n">name</span> <span class="o">==</span> <span class="s2">&quot;SWAP&quot;</span><span class="p">:</span>
                <span class="n">qc_temp</span><span class="o">.</span><span class="n">gates</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">Gate</span><span class="p">(</span><span class="s2">&quot;GLOBALPHASE&quot;</span><span class="p">,</span> <span class="kc">None</span><span class="p">,</span> <span class="kc">None</span><span class="p">,</span>
                                          <span class="n">arg_value</span><span class="o">=</span><span class="n">quarter_pi</span><span class="p">,</span>
                                          <span class="n">arg_label</span><span class="o">=</span><span class="sa">r</span><span class="s2">&quot;\pi/4&quot;</span><span class="p">))</span>
                <span class="n">qc_temp</span><span class="o">.</span><span class="n">gates</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">Gate</span><span class="p">(</span><span class="s2">&quot;ISWAP&quot;</span><span class="p">,</span> <span class="n">gate</span><span class="o">.</span><span class="n">targets</span><span class="p">,</span> <span class="kc">None</span><span class="p">))</span>
                <span class="n">qc_temp</span><span class="o">.</span><span class="n">gates</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">Gate</span><span class="p">(</span><span class="s2">&quot;RX&quot;</span><span class="p">,</span> <span class="n">gate</span><span class="o">.</span><span class="n">targets</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="kc">None</span><span class="p">,</span>
                                          <span class="n">arg_value</span><span class="o">=-</span><span class="n">half_pi</span><span class="p">,</span>
                                          <span class="n">arg_label</span><span class="o">=</span><span class="sa">r</span><span class="s2">&quot;-\pi/2&quot;</span><span class="p">))</span>
                <span class="n">qc_temp</span><span class="o">.</span><span class="n">gates</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">Gate</span><span class="p">(</span><span class="s2">&quot;ISWAP&quot;</span><span class="p">,</span> <span class="n">gate</span><span class="o">.</span><span class="n">targets</span><span class="p">,</span> <span class="kc">None</span><span class="p">))</span>
                <span class="n">qc_temp</span><span class="o">.</span><span class="n">gates</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">Gate</span><span class="p">(</span><span class="s2">&quot;RX&quot;</span><span class="p">,</span> <span class="n">gate</span><span class="o">.</span><span class="n">targets</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span> <span class="kc">None</span><span class="p">,</span>
                                          <span class="n">arg_value</span><span class="o">=-</span><span class="n">half_pi</span><span class="p">,</span>
                                          <span class="n">arg_label</span><span class="o">=</span><span class="sa">r</span><span class="s2">&quot;-\pi/2&quot;</span><span class="p">))</span>
                <span class="n">qc_temp</span><span class="o">.</span><span class="n">gates</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">Gate</span><span class="p">(</span><span class="s2">&quot;ISWAP&quot;</span><span class="p">,</span> <span class="p">[</span><span class="n">gate</span><span class="o">.</span><span class="n">targets</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span>
                                          <span class="n">gate</span><span class="o">.</span><span class="n">targets</span><span class="p">[</span><span class="mi">0</span><span class="p">]],</span> <span class="kc">None</span><span class="p">))</span>
                <span class="n">qc_temp</span><span class="o">.</span><span class="n">gates</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">Gate</span><span class="p">(</span><span class="s2">&quot;RX&quot;</span><span class="p">,</span> <span class="n">gate</span><span class="o">.</span><span class="n">targets</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="kc">None</span><span class="p">,</span>
                                          <span class="n">arg_value</span><span class="o">=-</span><span class="n">half_pi</span><span class="p">,</span>
                                          <span class="n">arg_label</span><span class="o">=</span><span class="sa">r</span><span class="s2">&quot;-\pi/2&quot;</span><span class="p">))</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">qc_temp</span><span class="o">.</span><span class="n">gates</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">gate</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">_basis_SQRTSWAP</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">qc_temp</span><span class="p">,</span> <span class="n">temp_resolved</span><span class="p">):</span>
        <span class="n">half_pi</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">pi</span> <span class="o">/</span> <span class="mi">2</span>
        <span class="k">for</span> <span class="n">gate</span> <span class="ow">in</span> <span class="n">temp_resolved</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">gate</span><span class="o">.</span><span class="n">name</span> <span class="o">==</span> <span class="s2">&quot;CNOT&quot;</span><span class="p">:</span>
                <span class="n">qc_temp</span><span class="o">.</span><span class="n">gates</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">Gate</span><span class="p">(</span><span class="s2">&quot;RY&quot;</span><span class="p">,</span> <span class="n">gate</span><span class="o">.</span><span class="n">targets</span><span class="p">,</span> <span class="kc">None</span><span class="p">,</span>
                                          <span class="n">arg_value</span><span class="o">=</span><span class="n">half_pi</span><span class="p">,</span>
                                          <span class="n">arg_label</span><span class="o">=</span><span class="sa">r</span><span class="s2">&quot;\pi/2&quot;</span><span class="p">))</span>
                <span class="n">qc_temp</span><span class="o">.</span><span class="n">gates</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">Gate</span><span class="p">(</span><span class="s2">&quot;SQRTSWAP&quot;</span><span class="p">,</span> <span class="p">[</span><span class="n">gate</span><span class="o">.</span><span class="n">controls</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span>
                                          <span class="n">gate</span><span class="o">.</span><span class="n">targets</span><span class="p">[</span><span class="mi">0</span><span class="p">]],</span>
                                          <span class="kc">None</span><span class="p">))</span>
                <span class="n">qc_temp</span><span class="o">.</span><span class="n">gates</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">Gate</span><span class="p">(</span><span class="s2">&quot;RZ&quot;</span><span class="p">,</span> <span class="n">gate</span><span class="o">.</span><span class="n">controls</span><span class="p">,</span> <span class="kc">None</span><span class="p">,</span>
                                          <span class="n">arg_value</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">pi</span><span class="p">,</span>
                                          <span class="n">arg_label</span><span class="o">=</span><span class="sa">r</span><span class="s2">&quot;\pi&quot;</span><span class="p">))</span>
                <span class="n">qc_temp</span><span class="o">.</span><span class="n">gates</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">Gate</span><span class="p">(</span><span class="s2">&quot;SQRTSWAP&quot;</span><span class="p">,</span> <span class="p">[</span><span class="n">gate</span><span class="o">.</span><span class="n">controls</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span>
                                          <span class="n">gate</span><span class="o">.</span><span class="n">targets</span><span class="p">[</span><span class="mi">0</span><span class="p">]],</span> <span class="kc">None</span><span class="p">))</span>
                <span class="n">qc_temp</span><span class="o">.</span><span class="n">gates</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">Gate</span><span class="p">(</span><span class="s2">&quot;RZ&quot;</span><span class="p">,</span> <span class="n">gate</span><span class="o">.</span><span class="n">targets</span><span class="p">,</span> <span class="kc">None</span><span class="p">,</span>
                                          <span class="n">arg_value</span><span class="o">=-</span><span class="n">half_pi</span><span class="p">,</span>
                                          <span class="n">arg_label</span><span class="o">=</span><span class="sa">r</span><span class="s2">&quot;-\pi/2&quot;</span><span class="p">))</span>
                <span class="n">qc_temp</span><span class="o">.</span><span class="n">gates</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">Gate</span><span class="p">(</span><span class="s2">&quot;RY&quot;</span><span class="p">,</span> <span class="n">gate</span><span class="o">.</span><span class="n">targets</span><span class="p">,</span> <span class="kc">None</span><span class="p">,</span>
                                          <span class="n">arg_value</span><span class="o">=-</span><span class="n">half_pi</span><span class="p">,</span>
                                          <span class="n">arg_label</span><span class="o">=</span><span class="sa">r</span><span class="s2">&quot;-\pi/2&quot;</span><span class="p">))</span>
                <span class="n">qc_temp</span><span class="o">.</span><span class="n">gates</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">Gate</span><span class="p">(</span><span class="s2">&quot;RZ&quot;</span><span class="p">,</span> <span class="n">gate</span><span class="o">.</span><span class="n">controls</span><span class="p">,</span> <span class="kc">None</span><span class="p">,</span>
                                          <span class="n">arg_value</span><span class="o">=-</span><span class="n">half_pi</span><span class="p">,</span>
                                          <span class="n">arg_label</span><span class="o">=</span><span class="sa">r</span><span class="s2">&quot;-\pi/2&quot;</span><span class="p">))</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">qc_temp</span><span class="o">.</span><span class="n">gates</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">gate</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">_basis_SQRTISWAP</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">qc_temp</span><span class="p">,</span> <span class="n">temp_resolved</span><span class="p">):</span>
        <span class="n">half_pi</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">pi</span> <span class="o">/</span> <span class="mi">2</span>
        <span class="n">quarter_pi</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">pi</span> <span class="o">/</span> <span class="mi">4</span>
        <span class="k">for</span> <span class="n">gate</span> <span class="ow">in</span> <span class="n">temp_resolved</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">gate</span><span class="o">.</span><span class="n">name</span> <span class="o">==</span> <span class="s2">&quot;CNOT&quot;</span><span class="p">:</span>
                <span class="n">qc_temp</span><span class="o">.</span><span class="n">gates</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">Gate</span><span class="p">(</span><span class="s2">&quot;RY&quot;</span><span class="p">,</span> <span class="n">gate</span><span class="o">.</span><span class="n">controls</span><span class="p">,</span> <span class="kc">None</span><span class="p">,</span>
                                          <span class="n">arg_value</span><span class="o">=-</span><span class="n">half_pi</span><span class="p">,</span>
                                          <span class="n">arg_label</span><span class="o">=</span><span class="sa">r</span><span class="s2">&quot;-\pi/2&quot;</span><span class="p">))</span>
                <span class="n">qc_temp</span><span class="o">.</span><span class="n">gates</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">Gate</span><span class="p">(</span><span class="s2">&quot;RX&quot;</span><span class="p">,</span> <span class="n">gate</span><span class="o">.</span><span class="n">controls</span><span class="p">,</span> <span class="kc">None</span><span class="p">,</span>
                                          <span class="n">arg_value</span><span class="o">=</span><span class="n">half_pi</span><span class="p">,</span>
                                          <span class="n">arg_label</span><span class="o">=</span><span class="sa">r</span><span class="s2">&quot;\pi/2&quot;</span><span class="p">))</span>
                <span class="n">qc_temp</span><span class="o">.</span><span class="n">gates</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">Gate</span><span class="p">(</span><span class="s2">&quot;RX&quot;</span><span class="p">,</span> <span class="n">gate</span><span class="o">.</span><span class="n">targets</span><span class="p">,</span> <span class="kc">None</span><span class="p">,</span>
                                          <span class="n">arg_value</span><span class="o">=-</span><span class="n">half_pi</span><span class="p">,</span>
                                          <span class="n">arg_label</span><span class="o">=</span><span class="sa">r</span><span class="s2">&quot;-\pi/2&quot;</span><span class="p">))</span>
                <span class="n">qc_temp</span><span class="o">.</span><span class="n">gates</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">Gate</span><span class="p">(</span><span class="s2">&quot;SQRTISWAP&quot;</span><span class="p">,</span> <span class="p">[</span><span class="n">gate</span><span class="o">.</span><span class="n">controls</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span>
                                          <span class="n">gate</span><span class="o">.</span><span class="n">targets</span><span class="p">[</span><span class="mi">0</span><span class="p">]],</span>
                                          <span class="kc">None</span><span class="p">))</span>
                <span class="n">qc_temp</span><span class="o">.</span><span class="n">gates</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">Gate</span><span class="p">(</span><span class="s2">&quot;RX&quot;</span><span class="p">,</span> <span class="n">gate</span><span class="o">.</span><span class="n">controls</span><span class="p">,</span> <span class="kc">None</span><span class="p">,</span>
                                          <span class="n">arg_value</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">pi</span><span class="p">,</span>
                                          <span class="n">arg_label</span><span class="o">=</span><span class="sa">r</span><span class="s2">&quot;\pi&quot;</span><span class="p">))</span>
                <span class="n">qc_temp</span><span class="o">.</span><span class="n">gates</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">Gate</span><span class="p">(</span><span class="s2">&quot;SQRTISWAP&quot;</span><span class="p">,</span> <span class="p">[</span><span class="n">gate</span><span class="o">.</span><span class="n">controls</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span>
                                          <span class="n">gate</span><span class="o">.</span><span class="n">targets</span><span class="p">[</span><span class="mi">0</span><span class="p">]],</span> <span class="kc">None</span><span class="p">))</span>
                <span class="n">qc_temp</span><span class="o">.</span><span class="n">gates</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">Gate</span><span class="p">(</span><span class="s2">&quot;RY&quot;</span><span class="p">,</span> <span class="n">gate</span><span class="o">.</span><span class="n">controls</span><span class="p">,</span> <span class="kc">None</span><span class="p">,</span>
                                          <span class="n">arg_value</span><span class="o">=</span><span class="n">half_pi</span><span class="p">,</span>
                                          <span class="n">arg_label</span><span class="o">=</span><span class="sa">r</span><span class="s2">&quot;\pi/2&quot;</span><span class="p">))</span>
                <span class="n">qc_temp</span><span class="o">.</span><span class="n">gates</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">Gate</span><span class="p">(</span><span class="s2">&quot;GLOBALPHASE&quot;</span><span class="p">,</span> <span class="kc">None</span><span class="p">,</span> <span class="kc">None</span><span class="p">,</span>
                                          <span class="n">arg_value</span><span class="o">=</span><span class="n">quarter_pi</span><span class="p">,</span>
                                          <span class="n">arg_label</span><span class="o">=</span><span class="sa">r</span><span class="s2">&quot;\pi/4&quot;</span><span class="p">))</span>
                <span class="n">qc_temp</span><span class="o">.</span><span class="n">gates</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">Gate</span><span class="p">(</span><span class="s2">&quot;RZ&quot;</span><span class="p">,</span> <span class="n">gate</span><span class="o">.</span><span class="n">controls</span><span class="p">,</span> <span class="kc">None</span><span class="p">,</span>
                                          <span class="n">arg_value</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">pi</span><span class="p">,</span>
                                          <span class="n">arg_label</span><span class="o">=</span><span class="sa">r</span><span class="s2">&quot;\pi&quot;</span><span class="p">))</span>
                <span class="n">qc_temp</span><span class="o">.</span><span class="n">gates</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">Gate</span><span class="p">(</span><span class="s2">&quot;GLOBALPHASE&quot;</span><span class="p">,</span> <span class="kc">None</span><span class="p">,</span> <span class="kc">None</span><span class="p">,</span>
                                          <span class="n">arg_value</span><span class="o">=</span><span class="mi">3</span> <span class="o">*</span> <span class="n">half_pi</span><span class="p">,</span>
                                          <span class="n">arg_label</span><span class="o">=</span><span class="sa">r</span><span class="s2">&quot;3\pi/2&quot;</span><span class="p">))</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">qc_temp</span><span class="o">.</span><span class="n">gates</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">gate</span><span class="p">)</span>

<div class="viewcode-block" id="QubitCircuit.run"><a class="viewcode-back" href="../../../apidoc/classes.html#qutip.qip.QubitCircuit.run">[docs]</a>    <span class="k">def</span> <span class="nf">run</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">state</span><span class="p">,</span> <span class="n">cbits</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">U_list</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
            <span class="n">measure_results</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">precompute_unitary</span><span class="o">=</span><span class="kc">False</span><span class="p">):</span>
        <span class="sd">&#39;&#39;&#39;</span>
<span class="sd">        Calculate the result of one instance of circuit run.</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        state : ket or oper</span>
<span class="sd">                state vector or density matrix input.</span>
<span class="sd">        cbits : List of ints, optional</span>
<span class="sd">                initialization of the classical bits.</span>
<span class="sd">        U_list: list of Qobj, optional</span>
<span class="sd">            list of predefined unitaries corresponding to circuit.</span>
<span class="sd">        measure_results : tuple of ints, optional</span>
<span class="sd">            optional specification of each measurement result to enable</span>
<span class="sd">            post-selection. If specified, the measurement results are</span>
<span class="sd">            set to the tuple of bits (sequentially) instead of being</span>
<span class="sd">            chosen at random.</span>
<span class="sd">        precompute_unitary: Boolean, optional</span>
<span class="sd">            Specify if computation is done by pre-computing and aggregating</span>
<span class="sd">            gate unitaries. Possibly a faster method in the case of</span>
<span class="sd">            large number of repeat runs with different state inputs.</span>

<span class="sd">        Returns</span>
<span class="sd">        -------</span>
<span class="sd">        final_state : Qobj</span>
<span class="sd">                output state of the circuit run.</span>
<span class="sd">        &#39;&#39;&#39;</span>

        <span class="k">if</span> <span class="n">state</span><span class="o">.</span><span class="n">isket</span><span class="p">:</span>
            <span class="n">sim</span> <span class="o">=</span> <span class="n">CircuitSimulator</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">state</span><span class="p">,</span> <span class="n">cbits</span><span class="p">,</span> <span class="n">U_list</span><span class="p">,</span> <span class="n">measure_results</span><span class="p">,</span>
                                   <span class="s2">&quot;state_vector_simulator&quot;</span><span class="p">,</span>
                                   <span class="n">precompute_unitary</span><span class="p">)</span>
        <span class="k">elif</span> <span class="n">state</span><span class="o">.</span><span class="n">isoper</span><span class="p">:</span>
            <span class="n">sim</span> <span class="o">=</span> <span class="n">CircuitSimulator</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">state</span><span class="p">,</span> <span class="n">cbits</span><span class="p">,</span> <span class="n">U_list</span><span class="p">,</span> <span class="n">measure_results</span><span class="p">,</span>
                                   <span class="s2">&quot;density_matrix_simulator&quot;</span><span class="p">,</span>
                                   <span class="n">precompute_unitary</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">TypeError</span><span class="p">(</span><span class="s2">&quot;State is not a ket or a density matrix.&quot;</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">sim</span><span class="o">.</span><span class="n">run</span><span class="p">(</span><span class="n">state</span><span class="p">,</span> <span class="n">cbits</span><span class="p">)</span><span class="o">.</span><span class="n">get_final_states</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span></div>

<div class="viewcode-block" id="QubitCircuit.run_statistics"><a class="viewcode-back" href="../../../apidoc/classes.html#qutip.qip.QubitCircuit.run_statistics">[docs]</a>    <span class="k">def</span> <span class="nf">run_statistics</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">state</span><span class="p">,</span> <span class="n">U_list</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
                       <span class="n">cbits</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">precompute_unitary</span><span class="o">=</span><span class="kc">False</span><span class="p">):</span>
        <span class="sd">&#39;&#39;&#39;</span>
<span class="sd">        Calculate all the possible outputs of a circuit</span>
<span class="sd">        (varied by measurement gates).</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        state : ket or oper</span>
<span class="sd">                state vector or density matrix input.</span>
<span class="sd">        cbits : List of ints, optional</span>
<span class="sd">                initialization of the classical bits.</span>
<span class="sd">        U_list: list of Qobj, optional</span>
<span class="sd">            list of predefined unitaries corresponding to circuit.</span>
<span class="sd">        measure_results : tuple of ints, optional</span>
<span class="sd">            optional specification of each measurement result to enable</span>
<span class="sd">            post-selection. If specified, the measurement results are</span>
<span class="sd">            set to the tuple of bits (sequentially) instead of being</span>
<span class="sd">            chosen at random.</span>
<span class="sd">        precompute_unitary: Boolean, optional</span>
<span class="sd">            Specify if computation is done by pre-computing and aggregating</span>
<span class="sd">            gate unitaries. Possibly a faster method in the case of</span>
<span class="sd">            large number of repeat runs with different state inputs.</span>

<span class="sd">        Returns</span>
<span class="sd">        -------</span>
<span class="sd">        result: CircuitResult</span>
<span class="sd">            Return a CircuitResult object containing</span>
<span class="sd">            output states and and their probabilities.</span>
<span class="sd">        &#39;&#39;&#39;</span>

        <span class="k">if</span> <span class="n">state</span><span class="o">.</span><span class="n">isket</span><span class="p">:</span>
            <span class="n">sim</span> <span class="o">=</span> <span class="n">CircuitSimulator</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">state</span><span class="p">,</span> <span class="n">cbits</span><span class="p">,</span> <span class="n">U_list</span><span class="p">,</span>
                                   <span class="n">mode</span><span class="o">=</span><span class="s2">&quot;state_vector_simulator&quot;</span><span class="p">,</span>
                                   <span class="n">precompute_unitary</span><span class="o">=</span><span class="n">precompute_unitary</span><span class="p">)</span>
        <span class="k">elif</span> <span class="n">state</span><span class="o">.</span><span class="n">isoper</span><span class="p">:</span>
            <span class="n">sim</span> <span class="o">=</span> <span class="n">CircuitSimulator</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">state</span><span class="p">,</span> <span class="n">cbits</span><span class="p">,</span> <span class="n">U_list</span><span class="p">,</span>
                                   <span class="n">mode</span><span class="o">=</span><span class="s2">&quot;density_matrix_simulator&quot;</span><span class="p">,</span>
                                   <span class="n">precompute_unitary</span><span class="o">=</span><span class="n">precompute_unitary</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">TypeError</span><span class="p">(</span><span class="s2">&quot;State is not a ket or a density matrix.&quot;</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">sim</span><span class="o">.</span><span class="n">run_statistics</span><span class="p">(</span><span class="n">state</span><span class="p">,</span> <span class="n">cbits</span><span class="p">)</span></div>

<div class="viewcode-block" id="QubitCircuit.resolve_gates"><a class="viewcode-back" href="../../../apidoc/classes.html#qutip.qip.QubitCircuit.resolve_gates">[docs]</a>    <span class="k">def</span> <span class="nf">resolve_gates</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">basis</span><span class="o">=</span><span class="p">[</span><span class="s2">&quot;CNOT&quot;</span><span class="p">,</span> <span class="s2">&quot;RX&quot;</span><span class="p">,</span> <span class="s2">&quot;RY&quot;</span><span class="p">,</span> <span class="s2">&quot;RZ&quot;</span><span class="p">]):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Unitary matrix calculator for N qubits returning the individual</span>
<span class="sd">        steps as unitary matrices operating from left to right in the specified</span>
<span class="sd">        basis.</span>
<span class="sd">        Calls &#39;_resolve_to_universal&#39; for each gate, this function maps</span>
<span class="sd">        each &#39;GATENAME&#39; with its corresponding &#39;_gate_basis_2q&#39;</span>
<span class="sd">        Subsequently calls _resolve_2q_basis for each basis, this function maps</span>
<span class="sd">        each &#39;2QGATENAME&#39; with its corresponding &#39;_basis_&#39;</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        basis : list.</span>
<span class="sd">            Basis of the resolved circuit.</span>

<span class="sd">        Returns</span>
<span class="sd">        -------</span>
<span class="sd">        qc : :class:`.QubitCircuit`</span>
<span class="sd">            Return :class:`.QubitCircuit` of resolved gates</span>
<span class="sd">            for the qubit circuit in the desired basis.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">qc_temp</span> <span class="o">=</span> <span class="n">QubitCircuit</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">N</span><span class="p">,</span> <span class="n">reverse_states</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">reverse_states</span><span class="p">,</span>
                               <span class="n">num_cbits</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">num_cbits</span><span class="p">)</span>
        <span class="n">temp_resolved</span> <span class="o">=</span> <span class="p">[]</span>

        <span class="n">basis_1q_valid</span> <span class="o">=</span> <span class="p">[</span><span class="s2">&quot;RX&quot;</span><span class="p">,</span> <span class="s2">&quot;RY&quot;</span><span class="p">,</span> <span class="s2">&quot;RZ&quot;</span><span class="p">]</span>
        <span class="n">basis_2q_valid</span> <span class="o">=</span> <span class="p">[</span><span class="s2">&quot;CNOT&quot;</span><span class="p">,</span> <span class="s2">&quot;CSIGN&quot;</span><span class="p">,</span> <span class="s2">&quot;ISWAP&quot;</span><span class="p">,</span> <span class="s2">&quot;SQRTSWAP&quot;</span><span class="p">,</span> <span class="s2">&quot;SQRTISWAP&quot;</span><span class="p">]</span>

        <span class="n">num_measurements</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="nb">list</span><span class="p">(</span><span class="nb">filter</span><span class="p">(</span>
                                <span class="k">lambda</span> <span class="n">x</span><span class="p">:</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">Measurement</span><span class="p">),</span>
                                <span class="bp">self</span><span class="o">.</span><span class="n">gates</span><span class="p">)))</span>
        <span class="k">if</span> <span class="n">num_measurements</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">NotImplementedError</span><span class="p">(</span><span class="s2">&quot;adjacent_gates must be called before </span><span class="se">\</span>
<span class="s2">            measurements are added to the circuit&quot;</span><span class="p">)</span>

        <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">basis</span><span class="p">,</span> <span class="nb">list</span><span class="p">):</span>
            <span class="n">basis_1q</span> <span class="o">=</span> <span class="p">[]</span>
            <span class="n">basis_2q</span> <span class="o">=</span> <span class="p">[]</span>
            <span class="k">for</span> <span class="n">gate</span> <span class="ow">in</span> <span class="n">basis</span><span class="p">:</span>
                <span class="k">if</span> <span class="n">gate</span> <span class="ow">in</span> <span class="n">basis_2q_valid</span><span class="p">:</span>
                    <span class="n">basis_2q</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">gate</span><span class="p">)</span>
                <span class="k">elif</span> <span class="n">gate</span> <span class="ow">in</span> <span class="n">basis_1q_valid</span><span class="p">:</span>
                    <span class="n">basis_1q</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">gate</span><span class="p">)</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="k">raise</span> <span class="ne">NotImplementedError</span><span class="p">(</span>
                        <span class="s2">&quot;</span><span class="si">%s</span><span class="s2"> is not a valid basis gate&quot;</span> <span class="o">%</span> <span class="n">gate</span><span class="p">)</span>
            <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">basis_1q</span><span class="p">)</span> <span class="o">==</span> <span class="mi">1</span><span class="p">:</span>
                <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">&quot;Not sufficient single-qubit gates in basis&quot;</span><span class="p">)</span>
            <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">basis_1q</span><span class="p">)</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
                <span class="n">basis_1q</span> <span class="o">=</span> <span class="p">[</span><span class="s2">&quot;RX&quot;</span><span class="p">,</span> <span class="s2">&quot;RY&quot;</span><span class="p">,</span> <span class="s2">&quot;RZ&quot;</span><span class="p">]</span>

        <span class="k">else</span><span class="p">:</span>  <span class="c1"># only one 2q gate is given as basis</span>
            <span class="n">basis_1q</span> <span class="o">=</span> <span class="p">[</span><span class="s2">&quot;RX&quot;</span><span class="p">,</span> <span class="s2">&quot;RY&quot;</span><span class="p">,</span> <span class="s2">&quot;RZ&quot;</span><span class="p">]</span>
            <span class="k">if</span> <span class="n">basis</span> <span class="ow">in</span> <span class="n">basis_2q_valid</span><span class="p">:</span>
                <span class="n">basis_2q</span> <span class="o">=</span> <span class="p">[</span><span class="n">basis</span><span class="p">]</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">&quot;</span><span class="si">%s</span><span class="s2"> is not a valid two-qubit basis gate&quot;</span>
                                 <span class="o">%</span> <span class="n">basis</span><span class="p">)</span>

        <span class="k">for</span> <span class="n">gate</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">gates</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">gate</span><span class="o">.</span><span class="n">name</span> <span class="ow">in</span> <span class="p">(</span><span class="s2">&quot;X&quot;</span><span class="p">,</span> <span class="s2">&quot;Y&quot;</span><span class="p">,</span> <span class="s2">&quot;Z&quot;</span><span class="p">):</span>
                <span class="n">qc_temp</span><span class="o">.</span><span class="n">gates</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">Gate</span><span class="p">(</span><span class="s2">&quot;GLOBALPHASE&quot;</span><span class="p">,</span> <span class="n">arg_value</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">pi</span><span class="o">/</span><span class="mi">2</span><span class="p">))</span>
                <span class="n">gate</span> <span class="o">=</span> <span class="n">Gate</span><span class="p">(</span>
                    <span class="s2">&quot;R&quot;</span> <span class="o">+</span> <span class="n">gate</span><span class="o">.</span><span class="n">name</span><span class="p">,</span> <span class="n">targets</span><span class="o">=</span><span class="n">gate</span><span class="o">.</span><span class="n">targets</span><span class="p">,</span> <span class="n">arg_value</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">pi</span><span class="p">)</span>
            <span class="k">try</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">_resolve_to_universal</span><span class="p">(</span><span class="n">gate</span><span class="p">,</span> <span class="n">temp_resolved</span><span class="p">,</span>
                                           <span class="n">basis_1q</span><span class="p">,</span> <span class="n">basis_2q</span><span class="p">)</span>
            <span class="k">except</span> <span class="ne">AttributeError</span><span class="p">:</span>
                <span class="n">exception</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">&quot;Gate </span><span class="si">{</span><span class="n">gate</span><span class="o">.</span><span class="n">name</span><span class="si">}</span><span class="s2"> cannot be resolved.&quot;</span>
                <span class="k">raise</span> <span class="ne">NotImplementedError</span><span class="p">(</span><span class="n">exception</span><span class="p">)</span>

        <span class="n">match</span> <span class="o">=</span> <span class="kc">False</span>
        <span class="k">for</span> <span class="n">basis_unit</span> <span class="ow">in</span> <span class="p">[</span><span class="s2">&quot;CSIGN&quot;</span><span class="p">,</span> <span class="s2">&quot;ISWAP&quot;</span><span class="p">,</span> <span class="s2">&quot;SQRTSWAP&quot;</span><span class="p">,</span> <span class="s2">&quot;SQRTISWAP&quot;</span><span class="p">]:</span>
            <span class="k">if</span> <span class="n">basis_unit</span> <span class="ow">in</span> <span class="n">basis_2q</span><span class="p">:</span>
                <span class="n">match</span> <span class="o">=</span> <span class="kc">True</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">_resolve_2q_basis</span><span class="p">(</span><span class="n">basis_unit</span><span class="p">,</span> <span class="n">qc_temp</span><span class="p">,</span> <span class="n">temp_resolved</span><span class="p">)</span>
                <span class="k">break</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="n">match</span><span class="p">:</span>
            <span class="n">qc_temp</span><span class="o">.</span><span class="n">gates</span> <span class="o">=</span> <span class="n">temp_resolved</span>

        <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">basis_1q</span><span class="p">)</span> <span class="o">==</span> <span class="mi">2</span><span class="p">:</span>
            <span class="n">temp_resolved</span> <span class="o">=</span> <span class="n">qc_temp</span><span class="o">.</span><span class="n">gates</span>
            <span class="n">qc_temp</span><span class="o">.</span><span class="n">gates</span> <span class="o">=</span> <span class="p">[]</span>
            <span class="n">half_pi</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">pi</span> <span class="o">/</span> <span class="mi">2</span>
            <span class="k">for</span> <span class="n">gate</span> <span class="ow">in</span> <span class="n">temp_resolved</span><span class="p">:</span>
                <span class="k">if</span> <span class="n">gate</span><span class="o">.</span><span class="n">name</span> <span class="o">==</span> <span class="s2">&quot;RX&quot;</span> <span class="ow">and</span> <span class="s2">&quot;RX&quot;</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">basis_1q</span><span class="p">:</span>
                    <span class="n">qc_temp</span><span class="o">.</span><span class="n">gates</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">Gate</span><span class="p">(</span><span class="s2">&quot;RY&quot;</span><span class="p">,</span> <span class="n">gate</span><span class="o">.</span><span class="n">targets</span><span class="p">,</span> <span class="kc">None</span><span class="p">,</span>
                                              <span class="n">arg_value</span><span class="o">=-</span><span class="n">half_pi</span><span class="p">,</span>
                                              <span class="n">arg_label</span><span class="o">=</span><span class="sa">r</span><span class="s2">&quot;-\pi/2&quot;</span><span class="p">))</span>
                    <span class="n">qc_temp</span><span class="o">.</span><span class="n">gates</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">Gate</span><span class="p">(</span><span class="s2">&quot;RZ&quot;</span><span class="p">,</span> <span class="n">gate</span><span class="o">.</span><span class="n">targets</span><span class="p">,</span> <span class="kc">None</span><span class="p">,</span>
                                              <span class="n">gate</span><span class="o">.</span><span class="n">arg_value</span><span class="p">,</span> <span class="n">gate</span><span class="o">.</span><span class="n">arg_label</span><span class="p">))</span>
                    <span class="n">qc_temp</span><span class="o">.</span><span class="n">gates</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">Gate</span><span class="p">(</span><span class="s2">&quot;RY&quot;</span><span class="p">,</span> <span class="n">gate</span><span class="o">.</span><span class="n">targets</span><span class="p">,</span> <span class="kc">None</span><span class="p">,</span>
                                              <span class="n">arg_value</span><span class="o">=</span><span class="n">half_pi</span><span class="p">,</span>
                                              <span class="n">arg_label</span><span class="o">=</span><span class="sa">r</span><span class="s2">&quot;\pi/2&quot;</span><span class="p">))</span>
                <span class="k">elif</span> <span class="n">gate</span><span class="o">.</span><span class="n">name</span> <span class="o">==</span> <span class="s2">&quot;RY&quot;</span> <span class="ow">and</span> <span class="s2">&quot;RY&quot;</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">basis_1q</span><span class="p">:</span>
                    <span class="n">qc_temp</span><span class="o">.</span><span class="n">gates</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">Gate</span><span class="p">(</span><span class="s2">&quot;RZ&quot;</span><span class="p">,</span> <span class="n">gate</span><span class="o">.</span><span class="n">targets</span><span class="p">,</span> <span class="kc">None</span><span class="p">,</span>
                                              <span class="n">arg_value</span><span class="o">=-</span><span class="n">half_pi</span><span class="p">,</span>
                                              <span class="n">arg_label</span><span class="o">=</span><span class="sa">r</span><span class="s2">&quot;-\pi/2&quot;</span><span class="p">))</span>
                    <span class="n">qc_temp</span><span class="o">.</span><span class="n">gates</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">Gate</span><span class="p">(</span><span class="s2">&quot;RX&quot;</span><span class="p">,</span> <span class="n">gate</span><span class="o">.</span><span class="n">targets</span><span class="p">,</span> <span class="kc">None</span><span class="p">,</span>
                                              <span class="n">gate</span><span class="o">.</span><span class="n">arg_value</span><span class="p">,</span> <span class="n">gate</span><span class="o">.</span><span class="n">arg_label</span><span class="p">))</span>
                    <span class="n">qc_temp</span><span class="o">.</span><span class="n">gates</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">Gate</span><span class="p">(</span><span class="s2">&quot;RZ&quot;</span><span class="p">,</span> <span class="n">gate</span><span class="o">.</span><span class="n">targets</span><span class="p">,</span> <span class="kc">None</span><span class="p">,</span>
                                              <span class="n">arg_value</span><span class="o">=</span><span class="n">half_pi</span><span class="p">,</span>
                                              <span class="n">arg_label</span><span class="o">=</span><span class="sa">r</span><span class="s2">&quot;\pi/2&quot;</span><span class="p">))</span>
                <span class="k">elif</span> <span class="n">gate</span><span class="o">.</span><span class="n">name</span> <span class="o">==</span> <span class="s2">&quot;RZ&quot;</span> <span class="ow">and</span> <span class="s2">&quot;RZ&quot;</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">basis_1q</span><span class="p">:</span>
                    <span class="n">qc_temp</span><span class="o">.</span><span class="n">gates</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">Gate</span><span class="p">(</span><span class="s2">&quot;RX&quot;</span><span class="p">,</span> <span class="n">gate</span><span class="o">.</span><span class="n">targets</span><span class="p">,</span> <span class="kc">None</span><span class="p">,</span>
                                              <span class="n">arg_value</span><span class="o">=-</span><span class="n">half_pi</span><span class="p">,</span>
                                              <span class="n">arg_label</span><span class="o">=</span><span class="sa">r</span><span class="s2">&quot;-\pi/2&quot;</span><span class="p">))</span>
                    <span class="n">qc_temp</span><span class="o">.</span><span class="n">gates</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">Gate</span><span class="p">(</span><span class="s2">&quot;RY&quot;</span><span class="p">,</span> <span class="n">gate</span><span class="o">.</span><span class="n">targets</span><span class="p">,</span> <span class="kc">None</span><span class="p">,</span>
                                              <span class="n">gate</span><span class="o">.</span><span class="n">arg_value</span><span class="p">,</span> <span class="n">gate</span><span class="o">.</span><span class="n">arg_label</span><span class="p">))</span>
                    <span class="n">qc_temp</span><span class="o">.</span><span class="n">gates</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">Gate</span><span class="p">(</span><span class="s2">&quot;RX&quot;</span><span class="p">,</span> <span class="n">gate</span><span class="o">.</span><span class="n">targets</span><span class="p">,</span> <span class="kc">None</span><span class="p">,</span>
                                              <span class="n">arg_value</span><span class="o">=</span><span class="n">half_pi</span><span class="p">,</span>
                                              <span class="n">arg_label</span><span class="o">=</span><span class="sa">r</span><span class="s2">&quot;\pi/2&quot;</span><span class="p">))</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="n">qc_temp</span><span class="o">.</span><span class="n">gates</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">gate</span><span class="p">)</span>

        <span class="n">qc_temp</span><span class="o">.</span><span class="n">gates</span> <span class="o">=</span> <span class="n">deepcopy</span><span class="p">(</span><span class="n">qc_temp</span><span class="o">.</span><span class="n">gates</span><span class="p">)</span>

        <span class="k">return</span> <span class="n">qc_temp</span></div>

<div class="viewcode-block" id="QubitCircuit.adjacent_gates"><a class="viewcode-back" href="../../../apidoc/classes.html#qutip.qip.QubitCircuit.adjacent_gates">[docs]</a>    <span class="k">def</span> <span class="nf">adjacent_gates</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Method to resolve two qubit gates with non-adjacent control/s or</span>
<span class="sd">        target/s in terms of gates with adjacent interactions.</span>

<span class="sd">        Returns</span>
<span class="sd">        -------</span>
<span class="sd">        qubit_circuit: :class:`.QubitCircuit`</span>
<span class="sd">            Return :class:`.QubitCircuit` of the gates</span>
<span class="sd">            for the qubit circuit with the resolved non-adjacent gates.</span>

<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">temp</span> <span class="o">=</span> <span class="n">QubitCircuit</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">N</span><span class="p">,</span> <span class="n">reverse_states</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">reverse_states</span><span class="p">,</span>
                            <span class="n">num_cbits</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">num_cbits</span><span class="p">)</span>
        <span class="n">swap_gates</span> <span class="o">=</span> <span class="p">[</span><span class="s2">&quot;SWAP&quot;</span><span class="p">,</span> <span class="s2">&quot;ISWAP&quot;</span><span class="p">,</span> <span class="s2">&quot;SQRTISWAP&quot;</span><span class="p">,</span> <span class="s2">&quot;SQRTSWAP&quot;</span><span class="p">,</span> <span class="s2">&quot;BERKELEY&quot;</span><span class="p">,</span>
                      <span class="s2">&quot;SWAPalpha&quot;</span><span class="p">]</span>
        <span class="n">num_measurements</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="nb">list</span><span class="p">(</span><span class="nb">filter</span><span class="p">(</span>
                                <span class="k">lambda</span> <span class="n">x</span><span class="p">:</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">Measurement</span><span class="p">),</span>
                                <span class="bp">self</span><span class="o">.</span><span class="n">gates</span><span class="p">)))</span>
        <span class="k">if</span> <span class="n">num_measurements</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">NotImplementedError</span><span class="p">(</span><span class="s2">&quot;adjacent_gates must be called before </span><span class="se">\</span>
<span class="s2">            measurements are added to the circuit&quot;</span><span class="p">)</span>

        <span class="k">for</span> <span class="n">gate</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">gates</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">gate</span><span class="o">.</span><span class="n">name</span> <span class="o">==</span> <span class="s2">&quot;CNOT&quot;</span> <span class="ow">or</span> <span class="n">gate</span><span class="o">.</span><span class="n">name</span> <span class="o">==</span> <span class="s2">&quot;CSIGN&quot;</span><span class="p">:</span>
                <span class="n">start</span> <span class="o">=</span> <span class="nb">min</span><span class="p">([</span><span class="n">gate</span><span class="o">.</span><span class="n">targets</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">gate</span><span class="o">.</span><span class="n">controls</span><span class="p">[</span><span class="mi">0</span><span class="p">]])</span>
                <span class="n">end</span> <span class="o">=</span> <span class="nb">max</span><span class="p">([</span><span class="n">gate</span><span class="o">.</span><span class="n">targets</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">gate</span><span class="o">.</span><span class="n">controls</span><span class="p">[</span><span class="mi">0</span><span class="p">]])</span>
                <span class="n">i</span> <span class="o">=</span> <span class="n">start</span>
                <span class="k">while</span> <span class="n">i</span> <span class="o">&lt;</span> <span class="n">end</span><span class="p">:</span>
                    <span class="k">if</span> <span class="n">start</span> <span class="o">+</span> <span class="n">end</span> <span class="o">-</span> <span class="n">i</span> <span class="o">-</span> <span class="n">i</span> <span class="o">==</span> <span class="mi">1</span> <span class="ow">and</span> <span class="p">(</span><span class="n">end</span> <span class="o">-</span> <span class="n">start</span> <span class="o">+</span> <span class="mi">1</span><span class="p">)</span> <span class="o">%</span> <span class="mi">2</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
                        <span class="c1"># Apply required gate if control, target are adjacent</span>
                        <span class="c1"># to each other, provided |control-target| is even.</span>
                        <span class="k">if</span> <span class="n">end</span> <span class="o">==</span> <span class="n">gate</span><span class="o">.</span><span class="n">controls</span><span class="p">[</span><span class="mi">0</span><span class="p">]:</span>
                            <span class="n">temp</span><span class="o">.</span><span class="n">gates</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">Gate</span><span class="p">(</span><span class="n">gate</span><span class="o">.</span><span class="n">name</span><span class="p">,</span> <span class="n">targets</span><span class="o">=</span><span class="p">[</span><span class="n">i</span><span class="p">],</span>
                                                   <span class="n">controls</span><span class="o">=</span><span class="p">[</span><span class="n">i</span> <span class="o">+</span> <span class="mi">1</span><span class="p">]))</span>
                        <span class="k">else</span><span class="p">:</span>
                            <span class="n">temp</span><span class="o">.</span><span class="n">gates</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">Gate</span><span class="p">(</span><span class="n">gate</span><span class="o">.</span><span class="n">name</span><span class="p">,</span> <span class="n">targets</span><span class="o">=</span><span class="p">[</span><span class="n">i</span> <span class="o">+</span> <span class="mi">1</span><span class="p">],</span>
                                                   <span class="n">controls</span><span class="o">=</span><span class="p">[</span><span class="n">i</span><span class="p">]))</span>
                    <span class="k">elif</span> <span class="p">(</span><span class="n">start</span> <span class="o">+</span> <span class="n">end</span> <span class="o">-</span> <span class="n">i</span> <span class="o">-</span> <span class="n">i</span> <span class="o">==</span> <span class="mi">2</span> <span class="ow">and</span>
                          <span class="p">(</span><span class="n">end</span> <span class="o">-</span> <span class="n">start</span> <span class="o">+</span> <span class="mi">1</span><span class="p">)</span> <span class="o">%</span> <span class="mi">2</span> <span class="o">==</span> <span class="mi">1</span><span class="p">):</span>
                        <span class="c1"># Apply a swap between i and its adjacent gate, then</span>
                        <span class="c1"># the required gate if and then another swap if control</span>
                        <span class="c1"># and target have one qubit between them, provided</span>
                        <span class="c1"># |control-target| is odd.</span>
                        <span class="n">temp</span><span class="o">.</span><span class="n">gates</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">Gate</span><span class="p">(</span><span class="s2">&quot;SWAP&quot;</span><span class="p">,</span> <span class="n">targets</span><span class="o">=</span><span class="p">[</span><span class="n">i</span><span class="p">,</span> <span class="n">i</span> <span class="o">+</span> <span class="mi">1</span><span class="p">]))</span>
                        <span class="k">if</span> <span class="n">end</span> <span class="o">==</span> <span class="n">gate</span><span class="o">.</span><span class="n">controls</span><span class="p">[</span><span class="mi">0</span><span class="p">]:</span>
                            <span class="n">temp</span><span class="o">.</span><span class="n">gates</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">Gate</span><span class="p">(</span><span class="n">gate</span><span class="o">.</span><span class="n">name</span><span class="p">,</span>
                                                   <span class="n">targets</span><span class="o">=</span><span class="p">[</span><span class="n">i</span> <span class="o">+</span> <span class="mi">1</span><span class="p">],</span>
                                                   <span class="n">controls</span><span class="o">=</span><span class="p">[</span><span class="n">i</span> <span class="o">+</span> <span class="mi">2</span><span class="p">]))</span>
                        <span class="k">else</span><span class="p">:</span>
                            <span class="n">temp</span><span class="o">.</span><span class="n">gates</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">Gate</span><span class="p">(</span><span class="n">gate</span><span class="o">.</span><span class="n">name</span><span class="p">,</span>
                                                   <span class="n">targets</span><span class="o">=</span><span class="p">[</span><span class="n">i</span> <span class="o">+</span> <span class="mi">2</span><span class="p">],</span>
                                                   <span class="n">controls</span><span class="o">=</span><span class="p">[</span><span class="n">i</span> <span class="o">+</span> <span class="mi">1</span><span class="p">]))</span>
                        <span class="n">temp</span><span class="o">.</span><span class="n">gates</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">Gate</span><span class="p">(</span><span class="s2">&quot;SWAP&quot;</span><span class="p">,</span> <span class="n">targets</span><span class="o">=</span><span class="p">[</span><span class="n">i</span><span class="p">,</span> <span class="n">i</span> <span class="o">+</span> <span class="mi">1</span><span class="p">]))</span>
                        <span class="n">i</span> <span class="o">+=</span> <span class="mi">1</span>
                    <span class="k">else</span><span class="p">:</span>
                        <span class="c1"># Swap the target/s and/or control with their adjacent</span>
                        <span class="c1"># qubit to bring them closer.</span>
                        <span class="n">temp</span><span class="o">.</span><span class="n">gates</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">Gate</span><span class="p">(</span><span class="s2">&quot;SWAP&quot;</span><span class="p">,</span> <span class="n">targets</span><span class="o">=</span><span class="p">[</span><span class="n">i</span><span class="p">,</span> <span class="n">i</span> <span class="o">+</span> <span class="mi">1</span><span class="p">]))</span>
                        <span class="n">temp</span><span class="o">.</span><span class="n">gates</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">Gate</span><span class="p">(</span><span class="s2">&quot;SWAP&quot;</span><span class="p">,</span>
                                               <span class="n">targets</span><span class="o">=</span><span class="p">[</span><span class="n">start</span> <span class="o">+</span> <span class="n">end</span> <span class="o">-</span> <span class="n">i</span> <span class="o">-</span> <span class="mi">1</span><span class="p">,</span>
                                                        <span class="n">start</span> <span class="o">+</span> <span class="n">end</span> <span class="o">-</span> <span class="n">i</span><span class="p">]))</span>
                    <span class="n">i</span> <span class="o">+=</span> <span class="mi">1</span>

            <span class="k">elif</span> <span class="n">gate</span><span class="o">.</span><span class="n">name</span> <span class="ow">in</span> <span class="n">swap_gates</span><span class="p">:</span>
                <span class="n">start</span> <span class="o">=</span> <span class="nb">min</span><span class="p">([</span><span class="n">gate</span><span class="o">.</span><span class="n">targets</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">gate</span><span class="o">.</span><span class="n">targets</span><span class="p">[</span><span class="mi">1</span><span class="p">]])</span>
                <span class="n">end</span> <span class="o">=</span> <span class="nb">max</span><span class="p">([</span><span class="n">gate</span><span class="o">.</span><span class="n">targets</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">gate</span><span class="o">.</span><span class="n">targets</span><span class="p">[</span><span class="mi">1</span><span class="p">]])</span>
                <span class="n">i</span> <span class="o">=</span> <span class="n">start</span>
                <span class="k">while</span> <span class="n">i</span> <span class="o">&lt;</span> <span class="n">end</span><span class="p">:</span>
                    <span class="k">if</span> <span class="n">start</span> <span class="o">+</span> <span class="n">end</span> <span class="o">-</span> <span class="n">i</span> <span class="o">-</span> <span class="n">i</span> <span class="o">==</span> <span class="mi">1</span> <span class="ow">and</span> <span class="p">(</span><span class="n">end</span> <span class="o">-</span> <span class="n">start</span> <span class="o">+</span> <span class="mi">1</span><span class="p">)</span> <span class="o">%</span> <span class="mi">2</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
                        <span class="n">temp</span><span class="o">.</span><span class="n">gates</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">Gate</span><span class="p">(</span><span class="n">gate</span><span class="o">.</span><span class="n">name</span><span class="p">,</span> <span class="n">targets</span><span class="o">=</span><span class="p">[</span><span class="n">i</span><span class="p">,</span> <span class="n">i</span> <span class="o">+</span> <span class="mi">1</span><span class="p">]))</span>
                    <span class="k">elif</span> <span class="p">((</span><span class="n">start</span> <span class="o">+</span> <span class="n">end</span> <span class="o">-</span> <span class="n">i</span> <span class="o">-</span> <span class="n">i</span><span class="p">)</span> <span class="o">==</span> <span class="mi">2</span> <span class="ow">and</span>
                          <span class="p">(</span><span class="n">end</span> <span class="o">-</span> <span class="n">start</span> <span class="o">+</span> <span class="mi">1</span><span class="p">)</span> <span class="o">%</span> <span class="mi">2</span> <span class="o">==</span> <span class="mi">1</span><span class="p">):</span>
                        <span class="n">temp</span><span class="o">.</span><span class="n">gates</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">Gate</span><span class="p">(</span><span class="s2">&quot;SWAP&quot;</span><span class="p">,</span> <span class="n">targets</span><span class="o">=</span><span class="p">[</span><span class="n">i</span><span class="p">,</span> <span class="n">i</span> <span class="o">+</span> <span class="mi">1</span><span class="p">]))</span>
                        <span class="n">temp</span><span class="o">.</span><span class="n">gates</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">Gate</span><span class="p">(</span><span class="n">gate</span><span class="o">.</span><span class="n">name</span><span class="p">,</span>
                                               <span class="n">targets</span><span class="o">=</span><span class="p">[</span><span class="n">i</span> <span class="o">+</span> <span class="mi">1</span><span class="p">,</span> <span class="n">i</span> <span class="o">+</span> <span class="mi">2</span><span class="p">]))</span>
                        <span class="n">temp</span><span class="o">.</span><span class="n">gates</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">Gate</span><span class="p">(</span><span class="s2">&quot;SWAP&quot;</span><span class="p">,</span> <span class="n">targets</span><span class="o">=</span><span class="p">[</span><span class="n">i</span><span class="p">,</span> <span class="n">i</span> <span class="o">+</span> <span class="mi">1</span><span class="p">]))</span>
                        <span class="n">i</span> <span class="o">+=</span> <span class="mi">1</span>
                    <span class="k">else</span><span class="p">:</span>
                        <span class="n">temp</span><span class="o">.</span><span class="n">gates</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">Gate</span><span class="p">(</span><span class="s2">&quot;SWAP&quot;</span><span class="p">,</span> <span class="n">targets</span><span class="o">=</span><span class="p">[</span><span class="n">i</span><span class="p">,</span> <span class="n">i</span> <span class="o">+</span> <span class="mi">1</span><span class="p">]))</span>
                        <span class="n">temp</span><span class="o">.</span><span class="n">gates</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">Gate</span><span class="p">(</span><span class="s2">&quot;SWAP&quot;</span><span class="p">,</span>
                                               <span class="n">targets</span><span class="o">=</span><span class="p">[</span><span class="n">start</span> <span class="o">+</span> <span class="n">end</span> <span class="o">-</span> <span class="n">i</span> <span class="o">-</span> <span class="mi">1</span><span class="p">,</span>
                                                        <span class="n">start</span> <span class="o">+</span> <span class="n">end</span> <span class="o">-</span> <span class="n">i</span><span class="p">]))</span>
                    <span class="n">i</span> <span class="o">+=</span> <span class="mi">1</span>

            <span class="k">else</span><span class="p">:</span>
                <span class="k">raise</span> <span class="ne">NotImplementedError</span><span class="p">(</span>
                    <span class="s2">&quot;`adjacent_gates` is not defined for &quot;</span>
                    <span class="s2">&quot;gate </span><span class="si">{}</span><span class="s2">.&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">gate</span><span class="o">.</span><span class="n">name</span><span class="p">))</span>

        <span class="n">temp</span><span class="o">.</span><span class="n">gates</span> <span class="o">=</span> <span class="n">deepcopy</span><span class="p">(</span><span class="n">temp</span><span class="o">.</span><span class="n">gates</span><span class="p">)</span>

        <span class="k">return</span> <span class="n">temp</span></div>

<div class="viewcode-block" id="QubitCircuit.propagators"><a class="viewcode-back" href="../../../apidoc/classes.html#qutip.qip.QubitCircuit.propagators">[docs]</a>    <span class="k">def</span> <span class="nf">propagators</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">expand</span><span class="o">=</span><span class="kc">True</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Propagator matrix calculator for N qubits returning the individual</span>
<span class="sd">        steps as unitary matrices operating from left to right.</span>
<span class="sd">        Returns</span>
<span class="sd">        -------</span>
<span class="sd">        U_list : list</span>
<span class="sd">            Return list of unitary matrices for the qubit circuit.</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="k">if</span> <span class="ow">not</span> <span class="n">expand</span><span class="p">:</span>
            <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">propagators_no_expand</span><span class="p">()</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">U_list</span> <span class="o">=</span> <span class="p">[]</span>

        <span class="n">gates</span> <span class="o">=</span> <span class="nb">filter</span><span class="p">(</span><span class="k">lambda</span> <span class="n">x</span><span class="p">:</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">Gate</span><span class="p">),</span> <span class="bp">self</span><span class="o">.</span><span class="n">gates</span><span class="p">)</span>

        <span class="k">for</span> <span class="n">gate</span> <span class="ow">in</span> <span class="n">gates</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">gate</span><span class="o">.</span><span class="n">name</span> <span class="o">==</span> <span class="s2">&quot;RX&quot;</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">U_list</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">rx</span><span class="p">(</span>
                    <span class="n">gate</span><span class="o">.</span><span class="n">arg_value</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">N</span><span class="p">,</span> <span class="n">gate</span><span class="o">.</span><span class="n">targets</span><span class="p">[</span><span class="mi">0</span><span class="p">]))</span>
            <span class="k">elif</span> <span class="n">gate</span><span class="o">.</span><span class="n">name</span> <span class="o">==</span> <span class="s2">&quot;RY&quot;</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">U_list</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">ry</span><span class="p">(</span>
                    <span class="n">gate</span><span class="o">.</span><span class="n">arg_value</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">N</span><span class="p">,</span> <span class="n">gate</span><span class="o">.</span><span class="n">targets</span><span class="p">[</span><span class="mi">0</span><span class="p">]))</span>
            <span class="k">elif</span> <span class="n">gate</span><span class="o">.</span><span class="n">name</span> <span class="o">==</span> <span class="s2">&quot;RZ&quot;</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">U_list</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">rz</span><span class="p">(</span>
                    <span class="n">gate</span><span class="o">.</span><span class="n">arg_value</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">N</span><span class="p">,</span> <span class="n">gate</span><span class="o">.</span><span class="n">targets</span><span class="p">[</span><span class="mi">0</span><span class="p">]))</span>
            <span class="k">elif</span> <span class="n">gate</span><span class="o">.</span><span class="n">name</span> <span class="o">==</span> <span class="s2">&quot;X&quot;</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">U_list</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">x_gate</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">N</span><span class="p">,</span> <span class="n">gate</span><span class="o">.</span><span class="n">targets</span><span class="p">[</span><span class="mi">0</span><span class="p">]))</span>
            <span class="k">elif</span> <span class="n">gate</span><span class="o">.</span><span class="n">name</span> <span class="o">==</span> <span class="s2">&quot;Y&quot;</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">U_list</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">y_gate</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">N</span><span class="p">,</span> <span class="n">gate</span><span class="o">.</span><span class="n">targets</span><span class="p">[</span><span class="mi">0</span><span class="p">]))</span>
            <span class="k">elif</span> <span class="n">gate</span><span class="o">.</span><span class="n">name</span> <span class="o">==</span> <span class="s2">&quot;CY&quot;</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">U_list</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">cy_gate</span><span class="p">(</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">N</span><span class="p">,</span> <span class="n">gate</span><span class="o">.</span><span class="n">controls</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">gate</span><span class="o">.</span><span class="n">targets</span><span class="p">[</span><span class="mi">0</span><span class="p">]))</span>
            <span class="k">elif</span> <span class="n">gate</span><span class="o">.</span><span class="n">name</span> <span class="o">==</span> <span class="s2">&quot;Z&quot;</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">U_list</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">z_gate</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">N</span><span class="p">,</span> <span class="n">gate</span><span class="o">.</span><span class="n">targets</span><span class="p">[</span><span class="mi">0</span><span class="p">]))</span>
            <span class="k">elif</span> <span class="n">gate</span><span class="o">.</span><span class="n">name</span> <span class="o">==</span> <span class="s2">&quot;CZ&quot;</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">U_list</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">cz_gate</span><span class="p">(</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">N</span><span class="p">,</span> <span class="n">gate</span><span class="o">.</span><span class="n">controls</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">gate</span><span class="o">.</span><span class="n">targets</span><span class="p">[</span><span class="mi">0</span><span class="p">]))</span>
            <span class="k">elif</span> <span class="n">gate</span><span class="o">.</span><span class="n">name</span> <span class="o">==</span> <span class="s2">&quot;T&quot;</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">U_list</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">t_gate</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">N</span><span class="p">,</span> <span class="n">gate</span><span class="o">.</span><span class="n">targets</span><span class="p">[</span><span class="mi">0</span><span class="p">]))</span>
            <span class="k">elif</span> <span class="n">gate</span><span class="o">.</span><span class="n">name</span> <span class="o">==</span> <span class="s2">&quot;CT&quot;</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">U_list</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">ct_gate</span><span class="p">(</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">N</span><span class="p">,</span> <span class="n">gate</span><span class="o">.</span><span class="n">controls</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">gate</span><span class="o">.</span><span class="n">targets</span><span class="p">[</span><span class="mi">0</span><span class="p">]))</span>
            <span class="k">elif</span> <span class="n">gate</span><span class="o">.</span><span class="n">name</span> <span class="o">==</span> <span class="s2">&quot;S&quot;</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">U_list</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">s_gate</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">N</span><span class="p">,</span> <span class="n">gate</span><span class="o">.</span><span class="n">targets</span><span class="p">[</span><span class="mi">0</span><span class="p">]))</span>
            <span class="k">elif</span> <span class="n">gate</span><span class="o">.</span><span class="n">name</span> <span class="o">==</span> <span class="s2">&quot;CS&quot;</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">U_list</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">cs_gate</span><span class="p">(</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">N</span><span class="p">,</span> <span class="n">gate</span><span class="o">.</span><span class="n">controls</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">gate</span><span class="o">.</span><span class="n">targets</span><span class="p">[</span><span class="mi">0</span><span class="p">]))</span>
            <span class="k">elif</span> <span class="n">gate</span><span class="o">.</span><span class="n">name</span> <span class="o">==</span> <span class="s2">&quot;SQRTNOT&quot;</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">U_list</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">sqrtnot</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">N</span><span class="p">,</span> <span class="n">gate</span><span class="o">.</span><span class="n">targets</span><span class="p">[</span><span class="mi">0</span><span class="p">]))</span>
            <span class="k">elif</span> <span class="n">gate</span><span class="o">.</span><span class="n">name</span> <span class="o">==</span> <span class="s2">&quot;SNOT&quot;</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">U_list</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">snot</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">N</span><span class="p">,</span> <span class="n">gate</span><span class="o">.</span><span class="n">targets</span><span class="p">[</span><span class="mi">0</span><span class="p">]))</span>
            <span class="k">elif</span> <span class="n">gate</span><span class="o">.</span><span class="n">name</span> <span class="o">==</span> <span class="s2">&quot;PHASEGATE&quot;</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">U_list</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">phasegate</span><span class="p">(</span><span class="n">gate</span><span class="o">.</span><span class="n">arg_value</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">N</span><span class="p">,</span>
                                             <span class="n">gate</span><span class="o">.</span><span class="n">targets</span><span class="p">[</span><span class="mi">0</span><span class="p">]))</span>
            <span class="k">elif</span> <span class="n">gate</span><span class="o">.</span><span class="n">name</span> <span class="o">==</span> <span class="s2">&quot;QASMU&quot;</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">U_list</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">qasmu_gate</span><span class="p">(</span><span class="n">gate</span><span class="o">.</span><span class="n">arg_value</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">N</span><span class="p">,</span>
                                              <span class="n">gate</span><span class="o">.</span><span class="n">targets</span><span class="p">[</span><span class="mi">0</span><span class="p">]))</span>
            <span class="k">elif</span> <span class="n">gate</span><span class="o">.</span><span class="n">name</span> <span class="o">==</span> <span class="s2">&quot;CRX&quot;</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">U_list</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">controlled_gate</span><span class="p">(</span><span class="n">rx</span><span class="p">(</span><span class="n">gate</span><span class="o">.</span><span class="n">arg_value</span><span class="p">),</span>
                                                   <span class="n">N</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">N</span><span class="p">,</span>
                                                   <span class="n">control</span><span class="o">=</span><span class="n">gate</span><span class="o">.</span><span class="n">controls</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span>
                                                   <span class="n">target</span><span class="o">=</span><span class="n">gate</span><span class="o">.</span><span class="n">targets</span><span class="p">[</span><span class="mi">0</span><span class="p">]))</span>
            <span class="k">elif</span> <span class="n">gate</span><span class="o">.</span><span class="n">name</span> <span class="o">==</span> <span class="s2">&quot;CRY&quot;</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">U_list</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">controlled_gate</span><span class="p">(</span><span class="n">ry</span><span class="p">(</span><span class="n">gate</span><span class="o">.</span><span class="n">arg_value</span><span class="p">),</span>
                                                   <span class="n">N</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">N</span><span class="p">,</span>
                                                   <span class="n">control</span><span class="o">=</span><span class="n">gate</span><span class="o">.</span><span class="n">controls</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span>
                                                   <span class="n">target</span><span class="o">=</span><span class="n">gate</span><span class="o">.</span><span class="n">targets</span><span class="p">[</span><span class="mi">0</span><span class="p">]))</span>
            <span class="k">elif</span> <span class="n">gate</span><span class="o">.</span><span class="n">name</span> <span class="o">==</span> <span class="s2">&quot;CRZ&quot;</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">U_list</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">controlled_gate</span><span class="p">(</span><span class="n">rz</span><span class="p">(</span><span class="n">gate</span><span class="o">.</span><span class="n">arg_value</span><span class="p">),</span>
                                                   <span class="n">N</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">N</span><span class="p">,</span>
                                                   <span class="n">control</span><span class="o">=</span><span class="n">gate</span><span class="o">.</span><span class="n">controls</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span>
                                                   <span class="n">target</span><span class="o">=</span><span class="n">gate</span><span class="o">.</span><span class="n">targets</span><span class="p">[</span><span class="mi">0</span><span class="p">]))</span>
            <span class="k">elif</span> <span class="n">gate</span><span class="o">.</span><span class="n">name</span> <span class="o">==</span> <span class="s2">&quot;CPHASE&quot;</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">U_list</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">cphase</span><span class="p">(</span><span class="n">gate</span><span class="o">.</span><span class="n">arg_value</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">N</span><span class="p">,</span>
                                          <span class="n">gate</span><span class="o">.</span><span class="n">controls</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">gate</span><span class="o">.</span><span class="n">targets</span><span class="p">[</span><span class="mi">0</span><span class="p">]))</span>
            <span class="k">elif</span> <span class="n">gate</span><span class="o">.</span><span class="n">name</span> <span class="o">==</span> <span class="s2">&quot;CNOT&quot;</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">U_list</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">cnot</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">N</span><span class="p">,</span>
                                        <span class="n">gate</span><span class="o">.</span><span class="n">controls</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">gate</span><span class="o">.</span><span class="n">targets</span><span class="p">[</span><span class="mi">0</span><span class="p">]))</span>
            <span class="k">elif</span> <span class="n">gate</span><span class="o">.</span><span class="n">name</span> <span class="o">==</span> <span class="s2">&quot;CSIGN&quot;</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">U_list</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">csign</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">N</span><span class="p">,</span>
                                         <span class="n">gate</span><span class="o">.</span><span class="n">controls</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">gate</span><span class="o">.</span><span class="n">targets</span><span class="p">[</span><span class="mi">0</span><span class="p">]))</span>
            <span class="k">elif</span> <span class="n">gate</span><span class="o">.</span><span class="n">name</span> <span class="o">==</span> <span class="s2">&quot;BERKELEY&quot;</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">U_list</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">berkeley</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">N</span><span class="p">,</span> <span class="n">gate</span><span class="o">.</span><span class="n">targets</span><span class="p">))</span>
            <span class="k">elif</span> <span class="n">gate</span><span class="o">.</span><span class="n">name</span> <span class="o">==</span> <span class="s2">&quot;SWAPalpha&quot;</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">U_list</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">swapalpha</span><span class="p">(</span><span class="n">gate</span><span class="o">.</span><span class="n">arg_value</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">N</span><span class="p">,</span>
                                             <span class="n">gate</span><span class="o">.</span><span class="n">targets</span><span class="p">))</span>
            <span class="k">elif</span> <span class="n">gate</span><span class="o">.</span><span class="n">name</span> <span class="o">==</span> <span class="s2">&quot;SWAP&quot;</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">U_list</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">swap</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">N</span><span class="p">,</span> <span class="n">gate</span><span class="o">.</span><span class="n">targets</span><span class="p">))</span>
            <span class="k">elif</span> <span class="n">gate</span><span class="o">.</span><span class="n">name</span> <span class="o">==</span> <span class="s2">&quot;ISWAP&quot;</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">U_list</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">iswap</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">N</span><span class="p">,</span> <span class="n">gate</span><span class="o">.</span><span class="n">targets</span><span class="p">))</span>
            <span class="k">elif</span> <span class="n">gate</span><span class="o">.</span><span class="n">name</span> <span class="o">==</span> <span class="s2">&quot;SQRTSWAP&quot;</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">U_list</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">sqrtswap</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">N</span><span class="p">,</span> <span class="n">gate</span><span class="o">.</span><span class="n">targets</span><span class="p">))</span>
            <span class="k">elif</span> <span class="n">gate</span><span class="o">.</span><span class="n">name</span> <span class="o">==</span> <span class="s2">&quot;SQRTISWAP&quot;</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">U_list</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">sqrtiswap</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">N</span><span class="p">,</span> <span class="n">gate</span><span class="o">.</span><span class="n">targets</span><span class="p">))</span>
            <span class="k">elif</span> <span class="n">gate</span><span class="o">.</span><span class="n">name</span> <span class="o">==</span> <span class="s2">&quot;FREDKIN&quot;</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">U_list</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">fredkin</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">N</span><span class="p">,</span> <span class="n">gate</span><span class="o">.</span><span class="n">controls</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span>
                                           <span class="n">gate</span><span class="o">.</span><span class="n">targets</span><span class="p">))</span>
            <span class="k">elif</span> <span class="n">gate</span><span class="o">.</span><span class="n">name</span> <span class="o">==</span> <span class="s2">&quot;TOFFOLI&quot;</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">U_list</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">toffoli</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">N</span><span class="p">,</span> <span class="n">gate</span><span class="o">.</span><span class="n">controls</span><span class="p">,</span>
                                           <span class="n">gate</span><span class="o">.</span><span class="n">targets</span><span class="p">[</span><span class="mi">0</span><span class="p">]))</span>
            <span class="k">elif</span> <span class="n">gate</span><span class="o">.</span><span class="n">name</span> <span class="o">==</span> <span class="s2">&quot;GLOBALPHASE&quot;</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">U_list</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">globalphase</span><span class="p">(</span><span class="n">gate</span><span class="o">.</span><span class="n">arg_value</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">N</span><span class="p">))</span>
            <span class="k">elif</span> <span class="n">gate</span><span class="o">.</span><span class="n">name</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">user_gates</span><span class="p">:</span>
                <span class="k">if</span> <span class="n">gate</span><span class="o">.</span><span class="n">controls</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
                    <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">&quot;A user defined gate </span><span class="si">{}</span><span class="s2"> takes only  &quot;</span>
                                     <span class="s2">&quot;`targets` variable.&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">gate</span><span class="o">.</span><span class="n">name</span><span class="p">))</span>
                <span class="n">func_or_oper</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">user_gates</span><span class="p">[</span><span class="n">gate</span><span class="o">.</span><span class="n">name</span><span class="p">]</span>
                <span class="k">if</span> <span class="n">inspect</span><span class="o">.</span><span class="n">isfunction</span><span class="p">(</span><span class="n">func_or_oper</span><span class="p">):</span>
                    <span class="n">func</span> <span class="o">=</span> <span class="n">func_or_oper</span>
                    <span class="n">para_num</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">inspect</span><span class="o">.</span><span class="n">getfullargspec</span><span class="p">(</span><span class="n">func</span><span class="p">)[</span><span class="mi">0</span><span class="p">])</span>
                    <span class="k">if</span> <span class="n">para_num</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
                        <span class="n">oper</span> <span class="o">=</span> <span class="n">func</span><span class="p">()</span>
                    <span class="k">elif</span> <span class="n">para_num</span> <span class="o">==</span> <span class="mi">1</span><span class="p">:</span>
                        <span class="n">oper</span> <span class="o">=</span> <span class="n">func</span><span class="p">(</span><span class="n">gate</span><span class="o">.</span><span class="n">arg_value</span><span class="p">)</span>
                    <span class="k">else</span><span class="p">:</span>
                        <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span>
                                <span class="s2">&quot;gate function takes at most one parameters.&quot;</span><span class="p">)</span>
                <span class="k">elif</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">func_or_oper</span><span class="p">,</span> <span class="n">Qobj</span><span class="p">):</span>
                    <span class="n">oper</span> <span class="o">=</span> <span class="n">func_or_oper</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">&quot;gate is neither function nor operator&quot;</span><span class="p">)</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">U_list</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">expand_operator</span><span class="p">(</span>
                    <span class="n">oper</span><span class="p">,</span> <span class="n">N</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">N</span><span class="p">,</span> <span class="n">targets</span><span class="o">=</span><span class="n">gate</span><span class="o">.</span><span class="n">targets</span><span class="p">,</span> <span class="n">dims</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">dims</span><span class="p">))</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="k">raise</span> <span class="ne">NotImplementedError</span><span class="p">(</span>
                    <span class="s2">&quot;</span><span class="si">{}</span><span class="s2"> gate is an unknown gate.&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">gate</span><span class="o">.</span><span class="n">name</span><span class="p">))</span>

        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">U_list</span></div>

<div class="viewcode-block" id="QubitCircuit.propagators_no_expand"><a class="viewcode-back" href="../../../apidoc/classes.html#qutip.qip.QubitCircuit.propagators_no_expand">[docs]</a>    <span class="k">def</span> <span class="nf">propagators_no_expand</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Propagator matrix calculator for N qubits returning the individual</span>
<span class="sd">        steps as unitary matrices operating from left to right.</span>

<span class="sd">        Returns</span>
<span class="sd">        -------</span>
<span class="sd">        U_list : list</span>
<span class="sd">            Return list of unitary matrices for the qubit circuit.</span>

<span class="sd">        &quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">U_list</span> <span class="o">=</span> <span class="p">[]</span>

        <span class="n">gates</span> <span class="o">=</span> <span class="nb">filter</span><span class="p">(</span><span class="k">lambda</span> <span class="n">x</span><span class="p">:</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">Gate</span><span class="p">),</span> <span class="bp">self</span><span class="o">.</span><span class="n">gates</span><span class="p">)</span>

        <span class="k">for</span> <span class="n">gate</span> <span class="ow">in</span> <span class="n">gates</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">gate</span><span class="o">.</span><span class="n">name</span> <span class="o">==</span> <span class="s2">&quot;RX&quot;</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">U_list</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">rx</span><span class="p">(</span><span class="n">gate</span><span class="o">.</span><span class="n">arg_value</span><span class="p">))</span>
            <span class="k">elif</span> <span class="n">gate</span><span class="o">.</span><span class="n">name</span> <span class="o">==</span> <span class="s2">&quot;RY&quot;</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">U_list</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">ry</span><span class="p">(</span><span class="n">gate</span><span class="o">.</span><span class="n">arg_value</span><span class="p">))</span>
            <span class="k">elif</span> <span class="n">gate</span><span class="o">.</span><span class="n">name</span> <span class="o">==</span> <span class="s2">&quot;RZ&quot;</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">U_list</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">rz</span><span class="p">(</span><span class="n">gate</span><span class="o">.</span><span class="n">arg_value</span><span class="p">))</span>
            <span class="k">elif</span> <span class="n">gate</span><span class="o">.</span><span class="n">name</span> <span class="o">==</span> <span class="s2">&quot;X&quot;</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">U_list</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">x_gate</span><span class="p">())</span>
            <span class="k">elif</span> <span class="n">gate</span><span class="o">.</span><span class="n">name</span> <span class="o">==</span> <span class="s2">&quot;Y&quot;</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">U_list</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">y_gate</span><span class="p">())</span>
            <span class="k">elif</span> <span class="n">gate</span><span class="o">.</span><span class="n">name</span> <span class="o">==</span> <span class="s2">&quot;CY&quot;</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">U_list</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">cy_gate</span><span class="p">())</span>
            <span class="k">elif</span> <span class="n">gate</span><span class="o">.</span><span class="n">name</span> <span class="o">==</span> <span class="s2">&quot;Z&quot;</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">U_list</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">z_gate</span><span class="p">())</span>
            <span class="k">elif</span> <span class="n">gate</span><span class="o">.</span><span class="n">name</span> <span class="o">==</span> <span class="s2">&quot;CZ&quot;</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">U_list</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">cz_gate</span><span class="p">())</span>
            <span class="k">elif</span> <span class="n">gate</span><span class="o">.</span><span class="n">name</span> <span class="o">==</span> <span class="s2">&quot;T&quot;</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">U_list</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">t_gate</span><span class="p">())</span>
            <span class="k">elif</span> <span class="n">gate</span><span class="o">.</span><span class="n">name</span> <span class="o">==</span> <span class="s2">&quot;CT&quot;</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">U_list</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">ct_gate</span><span class="p">())</span>
            <span class="k">elif</span> <span class="n">gate</span><span class="o">.</span><span class="n">name</span> <span class="o">==</span> <span class="s2">&quot;S&quot;</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">U_list</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">s_gate</span><span class="p">())</span>
            <span class="k">elif</span> <span class="n">gate</span><span class="o">.</span><span class="n">name</span> <span class="o">==</span> <span class="s2">&quot;CS&quot;</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">U_list</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">cs_gate</span><span class="p">())</span>
            <span class="k">elif</span> <span class="n">gate</span><span class="o">.</span><span class="n">name</span> <span class="o">==</span> <span class="s2">&quot;SQRTNOT&quot;</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">U_list</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">sqrtnot</span><span class="p">())</span>
            <span class="k">elif</span> <span class="n">gate</span><span class="o">.</span><span class="n">name</span> <span class="o">==</span> <span class="s2">&quot;SNOT&quot;</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">U_list</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">snot</span><span class="p">())</span>
            <span class="k">elif</span> <span class="n">gate</span><span class="o">.</span><span class="n">name</span> <span class="o">==</span> <span class="s2">&quot;PHASEGATE&quot;</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">U_list</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">phasegate</span><span class="p">(</span><span class="n">gate</span><span class="o">.</span><span class="n">arg_value</span><span class="p">))</span>
            <span class="k">elif</span> <span class="n">gate</span><span class="o">.</span><span class="n">name</span> <span class="o">==</span> <span class="s2">&quot;QASMU&quot;</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">U_list</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">qasmu_gate</span><span class="p">(</span><span class="n">gate</span><span class="o">.</span><span class="n">arg_value</span><span class="p">))</span>
            <span class="k">elif</span> <span class="n">gate</span><span class="o">.</span><span class="n">name</span> <span class="o">==</span> <span class="s2">&quot;CRX&quot;</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">U_list</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">controlled_gate</span><span class="p">(</span><span class="n">rx</span><span class="p">(</span><span class="n">gate</span><span class="o">.</span><span class="n">arg_value</span><span class="p">)))</span>
            <span class="k">elif</span> <span class="n">gate</span><span class="o">.</span><span class="n">name</span> <span class="o">==</span> <span class="s2">&quot;CRY&quot;</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">U_list</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">controlled_gate</span><span class="p">(</span><span class="n">ry</span><span class="p">(</span><span class="n">gate</span><span class="o">.</span><span class="n">arg_value</span><span class="p">)))</span>
            <span class="k">elif</span> <span class="n">gate</span><span class="o">.</span><span class="n">name</span> <span class="o">==</span> <span class="s2">&quot;CRZ&quot;</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">U_list</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">controlled_gate</span><span class="p">(</span><span class="n">rz</span><span class="p">(</span><span class="n">gate</span><span class="o">.</span><span class="n">arg_value</span><span class="p">)))</span>
            <span class="k">elif</span> <span class="n">gate</span><span class="o">.</span><span class="n">name</span> <span class="o">==</span> <span class="s2">&quot;CPHASE&quot;</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">U_list</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">cphase</span><span class="p">(</span><span class="n">gate</span><span class="o">.</span><span class="n">arg_value</span><span class="p">))</span>
            <span class="k">elif</span> <span class="n">gate</span><span class="o">.</span><span class="n">name</span> <span class="o">==</span> <span class="s2">&quot;CNOT&quot;</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">U_list</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">cnot</span><span class="p">())</span>
            <span class="k">elif</span> <span class="n">gate</span><span class="o">.</span><span class="n">name</span> <span class="o">==</span> <span class="s2">&quot;CSIGN&quot;</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">U_list</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">csign</span><span class="p">())</span>
            <span class="k">elif</span> <span class="n">gate</span><span class="o">.</span><span class="n">name</span> <span class="o">==</span> <span class="s2">&quot;BERKELEY&quot;</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">U_list</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">berkeley</span><span class="p">())</span>
            <span class="k">elif</span> <span class="n">gate</span><span class="o">.</span><span class="n">name</span> <span class="o">==</span> <span class="s2">&quot;SWAPalpha&quot;</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">U_list</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">swapalpha</span><span class="p">(</span><span class="n">gate</span><span class="o">.</span><span class="n">arg_value</span><span class="p">))</span>
            <span class="k">elif</span> <span class="n">gate</span><span class="o">.</span><span class="n">name</span> <span class="o">==</span> <span class="s2">&quot;SWAP&quot;</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">U_list</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">swap</span><span class="p">())</span>
            <span class="k">elif</span> <span class="n">gate</span><span class="o">.</span><span class="n">name</span> <span class="o">==</span> <span class="s2">&quot;ISWAP&quot;</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">U_list</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">iswap</span><span class="p">())</span>
            <span class="k">elif</span> <span class="n">gate</span><span class="o">.</span><span class="n">name</span> <span class="o">==</span> <span class="s2">&quot;SQRTSWAP&quot;</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">U_list</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">sqrtswap</span><span class="p">())</span>
            <span class="k">elif</span> <span class="n">gate</span><span class="o">.</span><span class="n">name</span> <span class="o">==</span> <span class="s2">&quot;SQRTISWAP&quot;</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">U_list</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">sqrtiswap</span><span class="p">())</span>
            <span class="k">elif</span> <span class="n">gate</span><span class="o">.</span><span class="n">name</span> <span class="o">==</span> <span class="s2">&quot;FREDKIN&quot;</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">U_list</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">fredkin</span><span class="p">())</span>
            <span class="k">elif</span> <span class="n">gate</span><span class="o">.</span><span class="n">name</span> <span class="o">==</span> <span class="s2">&quot;TOFFOLI&quot;</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">U_list</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">toffoli</span><span class="p">())</span>
            <span class="k">elif</span> <span class="n">gate</span><span class="o">.</span><span class="n">name</span> <span class="o">==</span> <span class="s2">&quot;GLOBALPHASE&quot;</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">U_list</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">globalphase</span><span class="p">(</span><span class="n">gate</span><span class="o">.</span><span class="n">arg_value</span><span class="p">))</span>
            <span class="k">elif</span> <span class="n">gate</span><span class="o">.</span><span class="n">name</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">user_gates</span><span class="p">:</span>
                <span class="k">if</span> <span class="n">gate</span><span class="o">.</span><span class="n">controls</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
                    <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">&quot;A user defined gate </span><span class="si">{}</span><span class="s2"> takes only  &quot;</span>
                                     <span class="s2">&quot;`targets` variable.&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">gate</span><span class="o">.</span><span class="n">name</span><span class="p">))</span>
                <span class="n">func_or_oper</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">user_gates</span><span class="p">[</span><span class="n">gate</span><span class="o">.</span><span class="n">name</span><span class="p">]</span>
                <span class="k">if</span> <span class="n">inspect</span><span class="o">.</span><span class="n">isfunction</span><span class="p">(</span><span class="n">func_or_oper</span><span class="p">):</span>
                    <span class="n">func</span> <span class="o">=</span> <span class="n">func_or_oper</span>
                    <span class="n">para_num</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">inspect</span><span class="o">.</span><span class="n">getfullargspec</span><span class="p">(</span><span class="n">func</span><span class="p">)[</span><span class="mi">0</span><span class="p">])</span>
                    <span class="k">if</span> <span class="n">para_num</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
                        <span class="n">oper</span> <span class="o">=</span> <span class="n">func</span><span class="p">()</span>
                    <span class="k">elif</span> <span class="n">para_num</span> <span class="o">==</span> <span class="mi">1</span><span class="p">:</span>
                        <span class="n">oper</span> <span class="o">=</span> <span class="n">func</span><span class="p">(</span><span class="n">gate</span><span class="o">.</span><span class="n">arg_value</span><span class="p">)</span>
                    <span class="k">else</span><span class="p">:</span>
                        <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span>
                                <span class="s2">&quot;gate function takes at most one parameters.&quot;</span><span class="p">)</span>
                <span class="k">elif</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">func_or_oper</span><span class="p">,</span> <span class="n">Qobj</span><span class="p">):</span>
                    <span class="n">oper</span> <span class="o">=</span> <span class="n">func_or_oper</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">&quot;gate is neither function nor operator&quot;</span><span class="p">)</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">U_list</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">oper</span><span class="p">)</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="k">raise</span> <span class="ne">NotImplementedError</span><span class="p">(</span>
                    <span class="s2">&quot;</span><span class="si">{}</span><span class="s2"> gate is an unknown gate.&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">gate</span><span class="o">.</span><span class="n">name</span><span class="p">))</span>

        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">U_list</span></div>

    <span class="k">def</span> <span class="nf">latex_code</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="n">rows</span> <span class="o">=</span> <span class="p">[]</span>

        <span class="n">ops</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">gates</span>
        <span class="n">col</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="k">for</span> <span class="n">op</span> <span class="ow">in</span> <span class="n">ops</span><span class="p">:</span>
            <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">op</span><span class="p">,</span> <span class="n">Gate</span><span class="p">):</span>
                <span class="n">gate</span> <span class="o">=</span> <span class="n">op</span>
                <span class="n">col</span> <span class="o">=</span> <span class="p">[]</span>
                <span class="n">_swap_processing</span> <span class="o">=</span> <span class="kc">False</span>
                <span class="k">for</span> <span class="n">n</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">N</span><span class="o">+</span><span class="bp">self</span><span class="o">.</span><span class="n">num_cbits</span><span class="p">):</span>

                    <span class="k">if</span> <span class="n">gate</span><span class="o">.</span><span class="n">targets</span> <span class="ow">and</span> <span class="n">n</span> <span class="ow">in</span> <span class="n">gate</span><span class="o">.</span><span class="n">targets</span><span class="p">:</span>

                        <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">gate</span><span class="o">.</span><span class="n">targets</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">1</span><span class="p">:</span>
                            <span class="k">if</span> <span class="n">gate</span><span class="o">.</span><span class="n">name</span> <span class="o">==</span> <span class="s2">&quot;SWAP&quot;</span><span class="p">:</span>
                                <span class="k">if</span> <span class="n">_swap_processing</span><span class="p">:</span>
                                    <span class="n">col</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="sa">r</span><span class="s2">&quot; \qswap \qw&quot;</span><span class="p">)</span>
                                    <span class="k">continue</span>
                                <span class="n">distance</span> <span class="o">=</span> <span class="nb">abs</span><span class="p">(</span>
                                    <span class="n">gate</span><span class="o">.</span><span class="n">targets</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">-</span> <span class="n">gate</span><span class="o">.</span><span class="n">targets</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span>
                                <span class="n">col</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="sa">r</span><span class="s2">&quot; \qswap \qwx[</span><span class="si">%d</span><span class="s2">] \qw&quot;</span> <span class="o">%</span> <span class="n">distance</span><span class="p">)</span>
                                <span class="n">_swap_processing</span> <span class="o">=</span> <span class="kc">True</span>

                            <span class="k">elif</span> <span class="p">((</span><span class="bp">self</span><span class="o">.</span><span class="n">reverse_states</span> <span class="ow">and</span>
                                   <span class="n">n</span> <span class="o">==</span> <span class="nb">max</span><span class="p">(</span><span class="n">gate</span><span class="o">.</span><span class="n">targets</span><span class="p">))</span> <span class="ow">or</span>
                                  <span class="p">(</span><span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">reverse_states</span> <span class="ow">and</span>
                                   <span class="n">n</span> <span class="o">==</span> <span class="nb">min</span><span class="p">(</span><span class="n">gate</span><span class="o">.</span><span class="n">targets</span><span class="p">))):</span>
                                <span class="n">col</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="sa">r</span><span class="s2">&quot; \multigate{</span><span class="si">%d</span><span class="s2">}{</span><span class="si">%s</span><span class="s2">} &quot;</span> <span class="o">%</span>
                                           <span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">gate</span><span class="o">.</span><span class="n">targets</span><span class="p">)</span> <span class="o">-</span> <span class="mi">1</span><span class="p">,</span>
                                            <span class="n">_gate_label</span><span class="p">(</span><span class="n">gate</span><span class="o">.</span><span class="n">name</span><span class="p">,</span>
                                                        <span class="n">gate</span><span class="o">.</span><span class="n">arg_label</span><span class="p">)))</span>
                            <span class="k">else</span><span class="p">:</span>
                                <span class="n">col</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="sa">r</span><span class="s2">&quot; \ghost{</span><span class="si">%s</span><span class="s2">} &quot;</span> <span class="o">%</span>
                                           <span class="p">(</span><span class="n">_gate_label</span><span class="p">(</span><span class="n">gate</span><span class="o">.</span><span class="n">name</span><span class="p">,</span>
                                                        <span class="n">gate</span><span class="o">.</span><span class="n">arg_label</span><span class="p">)))</span>

                        <span class="k">elif</span> <span class="n">gate</span><span class="o">.</span><span class="n">name</span> <span class="o">==</span> <span class="s2">&quot;CNOT&quot;</span><span class="p">:</span>
                            <span class="n">col</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="sa">r</span><span class="s2">&quot; \targ &quot;</span><span class="p">)</span>
                        <span class="k">elif</span> <span class="n">gate</span><span class="o">.</span><span class="n">name</span> <span class="o">==</span> <span class="s2">&quot;CY&quot;</span><span class="p">:</span>
                            <span class="n">col</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="sa">r</span><span class="s2">&quot; \targ &quot;</span><span class="p">)</span>
                        <span class="k">elif</span> <span class="n">gate</span><span class="o">.</span><span class="n">name</span> <span class="o">==</span> <span class="s2">&quot;CZ&quot;</span><span class="p">:</span>
                            <span class="n">col</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="sa">r</span><span class="s2">&quot; \targ &quot;</span><span class="p">)</span>
                        <span class="k">elif</span> <span class="n">gate</span><span class="o">.</span><span class="n">name</span> <span class="o">==</span> <span class="s2">&quot;CS&quot;</span><span class="p">:</span>
                            <span class="n">col</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="sa">r</span><span class="s2">&quot; \targ &quot;</span><span class="p">)</span>
                        <span class="k">elif</span> <span class="n">gate</span><span class="o">.</span><span class="n">name</span> <span class="o">==</span> <span class="s2">&quot;CT&quot;</span><span class="p">:</span>
                            <span class="n">col</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="sa">r</span><span class="s2">&quot; \targ &quot;</span><span class="p">)</span>
                        <span class="k">elif</span> <span class="n">gate</span><span class="o">.</span><span class="n">name</span> <span class="o">==</span> <span class="s2">&quot;TOFFOLI&quot;</span><span class="p">:</span>
                            <span class="n">col</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="sa">r</span><span class="s2">&quot; \targ &quot;</span><span class="p">)</span>
                        <span class="k">else</span><span class="p">:</span>
                            <span class="n">col</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="sa">r</span><span class="s2">&quot; \gate{</span><span class="si">%s</span><span class="s2">} &quot;</span> <span class="o">%</span>
                                       <span class="n">_gate_label</span><span class="p">(</span><span class="n">gate</span><span class="o">.</span><span class="n">name</span><span class="p">,</span> <span class="n">gate</span><span class="o">.</span><span class="n">arg_label</span><span class="p">))</span>

                    <span class="k">elif</span> <span class="n">gate</span><span class="o">.</span><span class="n">controls</span> <span class="ow">and</span> <span class="n">n</span> <span class="ow">in</span> <span class="n">gate</span><span class="o">.</span><span class="n">controls</span><span class="p">:</span>
                        <span class="n">control_tag</span> <span class="o">=</span> <span class="p">(</span><span class="o">-</span><span class="mi">1</span> <span class="k">if</span>
                                       <span class="bp">self</span><span class="o">.</span><span class="n">reverse_states</span>
                                       <span class="k">else</span> <span class="mi">1</span><span class="p">)</span> <span class="o">*</span> <span class="p">(</span><span class="n">gate</span><span class="o">.</span><span class="n">targets</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">-</span> <span class="n">n</span><span class="p">)</span>
                        <span class="n">col</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="sa">r</span><span class="s2">&quot; \ctrl{</span><span class="si">%d</span><span class="s2">} &quot;</span> <span class="o">%</span> <span class="n">control_tag</span><span class="p">)</span>

                    <span class="k">elif</span> <span class="p">(</span><span class="n">gate</span><span class="o">.</span><span class="n">classical_controls</span> <span class="ow">and</span>
                            <span class="p">(</span><span class="n">n</span> <span class="o">-</span> <span class="bp">self</span><span class="o">.</span><span class="n">N</span><span class="p">)</span> <span class="ow">in</span> <span class="n">gate</span><span class="o">.</span><span class="n">classical_controls</span><span class="p">):</span>
                        <span class="n">control_tag</span> <span class="o">=</span> <span class="n">n</span> <span class="o">-</span> <span class="n">gate</span><span class="o">.</span><span class="n">targets</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
                        <span class="n">col</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="sa">r</span><span class="s2">&quot; \ctrl{</span><span class="si">%d</span><span class="s2">} &quot;</span> <span class="o">%</span> <span class="n">control_tag</span><span class="p">)</span>

                    <span class="k">elif</span> <span class="p">(</span><span class="ow">not</span> <span class="n">gate</span><span class="o">.</span><span class="n">controls</span> <span class="ow">and</span> <span class="ow">not</span> <span class="n">gate</span><span class="o">.</span><span class="n">targets</span><span class="p">):</span>
                        <span class="c1"># global gate</span>
                        <span class="k">if</span> <span class="p">((</span><span class="bp">self</span><span class="o">.</span><span class="n">reverse_states</span> <span class="ow">and</span> <span class="n">n</span> <span class="o">==</span> <span class="bp">self</span><span class="o">.</span><span class="n">N</span> <span class="o">-</span> <span class="mi">1</span><span class="p">)</span> <span class="ow">or</span>
                                <span class="p">(</span><span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">reverse_states</span> <span class="ow">and</span> <span class="n">n</span> <span class="o">==</span> <span class="mi">0</span><span class="p">)):</span>
                            <span class="n">col</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="sa">r</span><span class="s2">&quot; \multigate{</span><span class="si">%d</span><span class="s2">}{</span><span class="si">%s</span><span class="s2">} &quot;</span> <span class="o">%</span>
                                       <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">N</span> <span class="o">-</span> <span class="mi">1</span><span class="p">,</span>
                                        <span class="n">_gate_label</span><span class="p">(</span><span class="n">gate</span><span class="o">.</span><span class="n">name</span><span class="p">,</span>
                                                    <span class="n">gate</span><span class="o">.</span><span class="n">arg_label</span><span class="p">)))</span>
                        <span class="k">else</span><span class="p">:</span>
                            <span class="n">col</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="sa">r</span><span class="s2">&quot; \ghost{</span><span class="si">%s</span><span class="s2">} &quot;</span> <span class="o">%</span>
                                       <span class="p">(</span><span class="n">_gate_label</span><span class="p">(</span><span class="n">gate</span><span class="o">.</span><span class="n">name</span><span class="p">,</span>
                                                    <span class="n">gate</span><span class="o">.</span><span class="n">arg_label</span><span class="p">)))</span>
                    <span class="k">else</span><span class="p">:</span>
                        <span class="n">col</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="sa">r</span><span class="s2">&quot; \qw &quot;</span><span class="p">)</span>

            <span class="k">else</span><span class="p">:</span>
                <span class="n">measurement</span> <span class="o">=</span> <span class="n">op</span>
                <span class="n">col</span> <span class="o">=</span> <span class="p">[]</span>
                <span class="k">for</span> <span class="n">n</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">N</span><span class="o">+</span><span class="bp">self</span><span class="o">.</span><span class="n">num_cbits</span><span class="p">):</span>
                    <span class="k">if</span> <span class="n">n</span> <span class="ow">in</span> <span class="n">measurement</span><span class="o">.</span><span class="n">targets</span><span class="p">:</span>
                        <span class="n">col</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="sa">r</span><span class="s2">&quot; \meter&quot;</span><span class="p">)</span>
                    <span class="k">elif</span> <span class="p">(</span><span class="n">n</span><span class="o">-</span><span class="bp">self</span><span class="o">.</span><span class="n">N</span><span class="p">)</span> <span class="o">==</span> <span class="n">measurement</span><span class="o">.</span><span class="n">classical_store</span><span class="p">:</span>
                        <span class="n">sgn</span> <span class="o">=</span> <span class="mi">1</span> <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">reverse_states</span> <span class="k">else</span> <span class="o">-</span><span class="mi">1</span>
                        <span class="n">store_tag</span> <span class="o">=</span> <span class="n">sgn</span> <span class="o">*</span> <span class="p">(</span><span class="n">n</span> <span class="o">-</span> <span class="n">measurement</span><span class="o">.</span><span class="n">targets</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span>
                        <span class="n">col</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="sa">r</span><span class="s2">&quot; \qw \cwx[</span><span class="si">%d</span><span class="s2">] &quot;</span> <span class="o">%</span> <span class="n">store_tag</span><span class="p">)</span>
                    <span class="k">else</span><span class="p">:</span>
                        <span class="n">col</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="sa">r</span><span class="s2">&quot; \qw &quot;</span><span class="p">)</span>

            <span class="n">col</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="sa">r</span><span class="s2">&quot; \qw &quot;</span><span class="p">)</span>
            <span class="n">rows</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">col</span><span class="p">)</span>

        <span class="n">input_states_quantum</span> <span class="o">=</span> <span class="p">[</span><span class="sa">r</span><span class="s2">&quot;\lstick{\ket{&quot;</span> <span class="o">+</span> <span class="n">x</span> <span class="o">+</span> <span class="s2">&quot;}}&quot;</span> <span class="k">if</span> <span class="n">x</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span>
                                <span class="k">else</span> <span class="s2">&quot;&quot;</span> <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">input_states</span><span class="p">[:</span><span class="bp">self</span><span class="o">.</span><span class="n">N</span><span class="p">]]</span>
        <span class="n">input_states_classical</span> <span class="o">=</span> <span class="p">[</span><span class="sa">r</span><span class="s2">&quot;\lstick{&quot;</span> <span class="o">+</span> <span class="n">x</span> <span class="o">+</span> <span class="s2">&quot;}&quot;</span> <span class="k">if</span> <span class="n">x</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span>
                                  <span class="k">else</span> <span class="s2">&quot;&quot;</span> <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">input_states</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">N</span><span class="p">:]]</span>
        <span class="n">input_states</span> <span class="o">=</span> <span class="n">input_states_quantum</span> <span class="o">+</span> <span class="n">input_states_classical</span>

        <span class="n">code</span> <span class="o">=</span> <span class="s2">&quot;&quot;</span>
        <span class="n">n_iter</span> <span class="o">=</span> <span class="p">(</span><span class="nb">reversed</span><span class="p">(</span><span class="nb">range</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">N</span><span class="o">+</span><span class="bp">self</span><span class="o">.</span><span class="n">num_cbits</span><span class="p">))</span> <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">reverse_states</span>
                  <span class="k">else</span> <span class="nb">range</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">N</span><span class="o">+</span><span class="bp">self</span><span class="o">.</span><span class="n">num_cbits</span><span class="p">))</span>
        <span class="k">for</span> <span class="n">n</span> <span class="ow">in</span> <span class="n">n_iter</span><span class="p">:</span>
            <span class="n">code</span> <span class="o">+=</span> <span class="sa">r</span><span class="s2">&quot; &amp; </span><span class="si">%s</span><span class="s2">&quot;</span> <span class="o">%</span> <span class="n">input_states</span><span class="p">[</span><span class="n">n</span><span class="p">]</span>
            <span class="k">for</span> <span class="n">m</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">ops</span><span class="p">)):</span>
                <span class="n">code</span> <span class="o">+=</span> <span class="sa">r</span><span class="s2">&quot; &amp; </span><span class="si">%s</span><span class="s2">&quot;</span> <span class="o">%</span> <span class="n">rows</span><span class="p">[</span><span class="n">m</span><span class="p">][</span><span class="n">n</span><span class="p">]</span>
            <span class="n">code</span> <span class="o">+=</span> <span class="sa">r</span><span class="s2">&quot; &amp; \qw </span><span class="se">\\</span><span class="s2"> &quot;</span> <span class="o">+</span> <span class="s2">&quot;</span><span class="se">\n</span><span class="s2">&quot;</span>

        <span class="k">return</span> <span class="n">code</span>

    <span class="c1"># This slightly convoluted dance with the conversion formats is because</span>
    <span class="c1"># image conversion has optional dependencies.  We always want the `png` and</span>
    <span class="c1"># `svg` methods to be available so that they are discoverable by the user,</span>
    <span class="c1"># however if one is called without the required dependency, then they&#39;ll</span>
    <span class="c1"># get a `RuntimeError` explaining the problem.  We only want the IPython</span>
    <span class="c1"># magic methods `_repr_xxx_` to be defined if we know that the image</span>
    <span class="c1"># conversion is available, so the user doesn&#39;t get exceptions on display</span>
    <span class="c1"># because IPython tried to do something behind their back.</span>

    <span class="k">def</span> <span class="nf">_raw_png</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="n">_latex</span><span class="o">.</span><span class="n">image_from_latex</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">latex_code</span><span class="p">(),</span> <span class="s2">&quot;png&quot;</span><span class="p">)</span>

    <span class="k">if</span> <span class="s1">&#39;png&#39;</span> <span class="ow">in</span> <span class="n">_latex</span><span class="o">.</span><span class="n">CONVERTERS</span><span class="p">:</span>
        <span class="n">_repr_png_</span> <span class="o">=</span> <span class="n">_raw_png</span>

    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">png</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="n">DisplayImage</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_raw_png</span><span class="p">(),</span> <span class="n">embed</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">_raw_svg</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="n">_latex</span><span class="o">.</span><span class="n">image_from_latex</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">latex_code</span><span class="p">(),</span> <span class="s2">&quot;svg&quot;</span><span class="p">)</span>

    <span class="k">if</span> <span class="s1">&#39;svg&#39;</span> <span class="ow">in</span> <span class="n">_latex</span><span class="o">.</span><span class="n">CONVERTERS</span><span class="p">:</span>
        <span class="n">_repr_svg_</span> <span class="o">=</span> <span class="n">_raw_svg</span>

    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">svg</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="n">DisplaySVG</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_raw_svg</span><span class="p">())</span>

    <span class="k">def</span> <span class="nf">_to_qasm</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">qasm_out</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Pipe output of circuit object to QasmOutput object.</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        qasm_out: QasmOutput</span>
<span class="sd">            object to store QASM output.</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="n">qasm_out</span><span class="o">.</span><span class="n">output</span><span class="p">(</span><span class="s2">&quot;qreg q[</span><span class="si">{}</span><span class="s2">];&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">N</span><span class="p">))</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">num_cbits</span><span class="p">:</span>
            <span class="n">qasm_out</span><span class="o">.</span><span class="n">output</span><span class="p">(</span><span class="s2">&quot;creg c[</span><span class="si">{}</span><span class="s2">];&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">num_cbits</span><span class="p">))</span>
        <span class="n">qasm_out</span><span class="o">.</span><span class="n">output</span><span class="p">(</span><span class="n">n</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>

        <span class="k">for</span> <span class="n">op</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">gates</span><span class="p">:</span>
            <span class="k">if</span> <span class="p">((</span><span class="ow">not</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">op</span><span class="p">,</span> <span class="n">Measurement</span><span class="p">))</span>
                    <span class="ow">and</span> <span class="ow">not</span> <span class="n">qasm_out</span><span class="o">.</span><span class="n">is_defined</span><span class="p">(</span><span class="n">op</span><span class="o">.</span><span class="n">name</span><span class="p">)):</span>
                <span class="n">qasm_out</span><span class="o">.</span><span class="n">_qasm_defns</span><span class="p">(</span><span class="n">op</span><span class="p">)</span>

        <span class="k">for</span> <span class="n">op</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">gates</span><span class="p">:</span>
            <span class="n">op</span><span class="o">.</span><span class="n">_to_qasm</span><span class="p">(</span><span class="n">qasm_out</span><span class="p">)</span></div>


<div class="viewcode-block" id="CircuitResult"><a class="viewcode-back" href="../../../apidoc/classes.html#qutip.qip.CircuitResult">[docs]</a><span class="k">class</span> <span class="nc">CircuitResult</span><span class="p">:</span>

    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">final_states</span><span class="p">,</span> <span class="n">probabilities</span><span class="p">,</span> <span class="n">cbits</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Store result of CircuitSimulator.</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        final_states: list of Qobj.</span>
<span class="sd">            List of output kets or density matrices.</span>

<span class="sd">        probabilities: list of float.</span>
<span class="sd">            List of probabilities of obtaining each output state.</span>

<span class="sd">        cbits: list of list of int, optional</span>
<span class="sd">            List of cbits for each output.</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">final_states</span><span class="p">,</span> <span class="n">Qobj</span><span class="p">)</span> <span class="ow">or</span> <span class="n">final_states</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">final_states</span> <span class="o">=</span> <span class="p">[</span><span class="n">final_states</span><span class="p">]</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">probabilities</span> <span class="o">=</span> <span class="p">[</span><span class="n">probabilities</span><span class="p">]</span>
            <span class="k">if</span> <span class="n">cbits</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">cbits</span> <span class="o">=</span> <span class="p">[</span><span class="n">cbits</span><span class="p">]</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">inds</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="nb">filter</span><span class="p">(</span><span class="k">lambda</span> <span class="n">x</span><span class="p">:</span> <span class="n">final_states</span><span class="p">[</span><span class="n">x</span><span class="p">]</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">,</span>
                               <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">final_states</span><span class="p">))))</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">final_states</span> <span class="o">=</span> <span class="p">[</span><span class="n">final_states</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="n">inds</span><span class="p">]</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">probabilities</span> <span class="o">=</span> <span class="p">[</span><span class="n">probabilities</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="n">inds</span><span class="p">]</span>
            <span class="k">if</span> <span class="n">cbits</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">cbits</span> <span class="o">=</span> <span class="p">[</span><span class="n">cbits</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="n">inds</span><span class="p">]</span>

<div class="viewcode-block" id="CircuitResult.get_final_states"><a class="viewcode-back" href="../../../apidoc/classes.html#qutip.qip.CircuitResult.get_final_states">[docs]</a>    <span class="k">def</span> <span class="nf">get_final_states</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">index</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Return list of output states.</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        index: int</span>
<span class="sd">            Indicates i-th state to be returned.</span>

<span class="sd">        Returns</span>
<span class="sd">        ----------</span>
<span class="sd">        final_states: Qobj or list of Qobj.</span>
<span class="sd">            List of output kets or density matrices.</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="k">if</span> <span class="n">index</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">final_states</span><span class="p">[</span><span class="n">index</span><span class="p">]</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">final_states</span></div>

<div class="viewcode-block" id="CircuitResult.get_probabilities"><a class="viewcode-back" href="../../../apidoc/classes.html#qutip.qip.CircuitResult.get_probabilities">[docs]</a>    <span class="k">def</span> <span class="nf">get_probabilities</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">index</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Return list of probabilities corresponding to the output states.</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        index: int</span>
<span class="sd">            Indicates i-th probability to be returned.</span>

<span class="sd">        Returns</span>
<span class="sd">        -------</span>
<span class="sd">        probabilities: float or list of float</span>
<span class="sd">            Probabilities associated with each output state.</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="k">if</span> <span class="n">index</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">probabilities</span><span class="p">[</span><span class="n">index</span><span class="p">]</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">probabilities</span></div>

<div class="viewcode-block" id="CircuitResult.get_cbits"><a class="viewcode-back" href="../../../apidoc/classes.html#qutip.qip.CircuitResult.get_cbits">[docs]</a>    <span class="k">def</span> <span class="nf">get_cbits</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">index</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Return list of classical bit outputs corresponding to the results.</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        index: int</span>
<span class="sd">            Indicates i-th output, probability pair to be returned.</span>

<span class="sd">        Returns</span>
<span class="sd">        -------</span>
<span class="sd">        cbits: list of int or list of list of int</span>
<span class="sd">            list of classical bit outputs</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="k">if</span> <span class="n">index</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">cbits</span><span class="p">[</span><span class="n">index</span><span class="p">]</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">cbits</span></div></div>


<div class="viewcode-block" id="CircuitSimulator"><a class="viewcode-back" href="../../../apidoc/classes.html#qutip.qip.CircuitSimulator">[docs]</a><span class="k">class</span> <span class="nc">CircuitSimulator</span><span class="p">:</span>

    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">qc</span><span class="p">,</span> <span class="n">state</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">cbits</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
                 <span class="n">U_list</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">measure_results</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
                 <span class="n">mode</span><span class="o">=</span><span class="s2">&quot;state_vector_simulator&quot;</span><span class="p">,</span> <span class="n">precompute_unitary</span><span class="o">=</span><span class="kc">False</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Simulate state evolution for Quantum Circuits.</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        qc: :class:`.QubitCircuit`</span>
<span class="sd">            Quantum Circuit to be simulated.</span>

<span class="sd">        state: ket or oper</span>
<span class="sd">            ket or density matrix</span>

<span class="sd">        cbits: list of int, optional</span>
<span class="sd">            initial value of classical bits</span>

<span class="sd">        U_list: list of Qobj, optional</span>
<span class="sd">            list of predefined unitaries corresponding to circuit.</span>

<span class="sd">        measure_results : tuple of ints, optional</span>
<span class="sd">            optional specification of each measurement result to enable</span>
<span class="sd">            post-selection. If specified, the measurement results are</span>
<span class="sd">            set to the tuple of bits (sequentially) instead of being</span>
<span class="sd">            chosen at random.</span>

<span class="sd">        mode: string, optional</span>
<span class="sd">            Specify if input state (and therefore computation) is in</span>
<span class="sd">            state-vector mode or in density matrix mode.</span>
<span class="sd">            In state_vector_simulator mode, the input must be a ket</span>
<span class="sd">            and with each measurement, one of the collapsed</span>
<span class="sd">            states is the new state (when using run()).</span>
<span class="sd">            In density_matrix_simulator mode, the input can be a ket or a</span>
<span class="sd">            density matrix and after measurement, the new state is the</span>
<span class="sd">            mixed ensemble state obtained after the measurement.</span>
<span class="sd">            If in density_matrix_simulator mode and given</span>
<span class="sd">            a state vector input, the output must be assumed to</span>
<span class="sd">            be a density matrix.</span>

<span class="sd">        precompute_unitary: Boolean, optional</span>
<span class="sd">            Specify if computation is done by pre-computing and aggregating</span>
<span class="sd">            gate unitaries. Possibly a faster method in the case of</span>
<span class="sd">            large number of repeat runs with different state inputs.</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">qc</span> <span class="o">=</span> <span class="n">qc</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">mode</span> <span class="o">=</span> <span class="n">mode</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">precompute_unitary</span> <span class="o">=</span> <span class="n">precompute_unitary</span>

        <span class="k">if</span> <span class="n">U_list</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">U_list</span> <span class="o">=</span> <span class="n">U_list</span>
        <span class="k">elif</span> <span class="n">precompute_unitary</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">U_list</span> <span class="o">=</span> <span class="n">qc</span><span class="o">.</span><span class="n">propagators</span><span class="p">(</span><span class="n">expand</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">U_list</span> <span class="o">=</span> <span class="n">qc</span><span class="o">.</span><span class="n">propagators</span><span class="p">()</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">ops</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">inds_list</span> <span class="o">=</span> <span class="p">[]</span>

        <span class="k">if</span> <span class="n">precompute_unitary</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_process_ops_precompute</span><span class="p">()</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_process_ops</span><span class="p">()</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">initialize</span><span class="p">(</span><span class="n">state</span><span class="p">,</span> <span class="n">cbits</span><span class="p">,</span> <span class="n">measure_results</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">_process_ops</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&#39;&#39;&#39;</span>
<span class="sd">        Process list of gates (including measurements), and stores</span>
<span class="sd">        them in self.ops (as unitaries) for further computation.</span>
<span class="sd">        &#39;&#39;&#39;</span>

        <span class="n">U_list_index</span> <span class="o">=</span> <span class="mi">0</span>

        <span class="k">for</span> <span class="n">operation</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">qc</span><span class="o">.</span><span class="n">gates</span><span class="p">:</span>
            <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">operation</span><span class="p">,</span> <span class="n">Measurement</span><span class="p">):</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">ops</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">operation</span><span class="p">)</span>
            <span class="k">elif</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">operation</span><span class="p">,</span> <span class="n">Gate</span><span class="p">):</span>
                <span class="k">if</span> <span class="n">operation</span><span class="o">.</span><span class="n">classical_controls</span><span class="p">:</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">ops</span><span class="o">.</span><span class="n">append</span><span class="p">((</span><span class="n">operation</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">U_list</span><span class="p">[</span><span class="n">U_list_index</span><span class="p">]))</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">ops</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">U_list</span><span class="p">[</span><span class="n">U_list_index</span><span class="p">])</span>
                <span class="n">U_list_index</span> <span class="o">+=</span> <span class="mi">1</span>

    <span class="k">def</span> <span class="nf">_process_ops_precompute</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&#39;&#39;&#39;</span>
<span class="sd">        Process list of gates (including measurements), aggregate</span>
<span class="sd">        gate unitaries (by multiplying) and store them in self.ops</span>
<span class="sd">        for further computation. The gate multiplication is carried out</span>
<span class="sd">        only for groups of matrices in between classically controlled gates</span>
<span class="sd">        and measurement gates.</span>

<span class="sd">        Examples</span>
<span class="sd">        --------</span>

<span class="sd">        If we have a circuit that looks like:</span>

<span class="sd">        ----|X|-----|Y|----|M0|-----|X|----</span>

<span class="sd">        then self.ops = [YX, M0, X]</span>
<span class="sd">        &#39;&#39;&#39;</span>

        <span class="n">prev_index</span> <span class="o">=</span> <span class="mi">0</span>
        <span class="n">U_list_index</span> <span class="o">=</span> <span class="mi">0</span>

        <span class="k">for</span> <span class="n">gate</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">qc</span><span class="o">.</span><span class="n">gates</span><span class="p">:</span>
            <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">gate</span><span class="p">,</span> <span class="n">Measurement</span><span class="p">):</span>
                <span class="k">continue</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">inds_list</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">gate</span><span class="o">.</span><span class="n">get_inds</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">qc</span><span class="o">.</span><span class="n">N</span><span class="p">))</span>

        <span class="k">for</span> <span class="n">operation</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">qc</span><span class="o">.</span><span class="n">gates</span><span class="p">:</span>
            <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">operation</span><span class="p">,</span> <span class="n">Measurement</span><span class="p">):</span>
                <span class="k">if</span> <span class="n">U_list_index</span> <span class="o">&gt;</span> <span class="n">prev_index</span><span class="p">:</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">ops</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_compute_unitary</span><span class="p">(</span>
                                    <span class="bp">self</span><span class="o">.</span><span class="n">U_list</span><span class="p">[</span><span class="n">prev_index</span><span class="p">:</span><span class="n">U_list_index</span><span class="p">],</span>
                                    <span class="bp">self</span><span class="o">.</span><span class="n">inds_list</span><span class="p">[</span><span class="n">prev_index</span><span class="p">:</span><span class="n">U_list_index</span><span class="p">]))</span>
                    <span class="n">prev_index</span> <span class="o">=</span> <span class="n">U_list_index</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">ops</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">operation</span><span class="p">)</span>

            <span class="k">elif</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">operation</span><span class="p">,</span> <span class="n">Gate</span><span class="p">):</span>
                <span class="k">if</span> <span class="n">operation</span><span class="o">.</span><span class="n">classical_controls</span><span class="p">:</span>
                    <span class="k">if</span> <span class="n">U_list_index</span> <span class="o">&gt;</span> <span class="n">prev_index</span><span class="p">:</span>
                        <span class="bp">self</span><span class="o">.</span><span class="n">ops</span><span class="o">.</span><span class="n">append</span><span class="p">(</span>
                            <span class="bp">self</span><span class="o">.</span><span class="n">_compute_unitary</span><span class="p">(</span>
                                    <span class="bp">self</span><span class="o">.</span><span class="n">U_list</span><span class="p">[</span><span class="n">prev_index</span><span class="p">:</span><span class="n">U_list_index</span><span class="p">],</span>
                                    <span class="bp">self</span><span class="o">.</span><span class="n">inds_list</span><span class="p">[</span><span class="n">prev_index</span><span class="p">:</span><span class="n">U_list_index</span><span class="p">]))</span>
                        <span class="n">prev_index</span> <span class="o">=</span> <span class="n">U_list_index</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">ops</span><span class="o">.</span><span class="n">append</span><span class="p">((</span><span class="n">operation</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">U_list</span><span class="p">[</span><span class="n">prev_index</span><span class="p">]))</span>
                    <span class="n">prev_index</span> <span class="o">+=</span> <span class="mi">1</span>
                    <span class="n">U_list_index</span> <span class="o">+=</span> <span class="mi">1</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="n">U_list_index</span> <span class="o">+=</span> <span class="mi">1</span>

        <span class="k">if</span> <span class="n">U_list_index</span> <span class="o">&gt;</span> <span class="n">prev_index</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">ops</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_compute_unitary</span><span class="p">(</span>
                            <span class="bp">self</span><span class="o">.</span><span class="n">U_list</span><span class="p">[</span><span class="n">prev_index</span><span class="p">:</span><span class="n">U_list_index</span><span class="p">],</span>
                            <span class="bp">self</span><span class="o">.</span><span class="n">inds_list</span><span class="p">[</span><span class="n">prev_index</span><span class="p">:</span><span class="n">U_list_index</span><span class="p">]))</span>
            <span class="n">prev_index</span> <span class="o">=</span> <span class="n">U_list_index</span> <span class="o">+</span> <span class="mi">1</span>
            <span class="n">U_list_index</span> <span class="o">=</span> <span class="n">prev_index</span>

<div class="viewcode-block" id="CircuitSimulator.initialize"><a class="viewcode-back" href="../../../apidoc/classes.html#qutip.qip.CircuitSimulator.initialize">[docs]</a>    <span class="k">def</span> <span class="nf">initialize</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">state</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">cbits</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">measure_results</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
        <span class="sd">&#39;&#39;&#39;</span>
<span class="sd">        Reset Simulator state variables to start a new run.</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        state: ket or oper</span>
<span class="sd">            ket or density matrix</span>

<span class="sd">        cbits: list of int, optional</span>
<span class="sd">            initial value of classical bits</span>

<span class="sd">        U_list: list of Qobj, optional</span>
<span class="sd">            list of predefined unitaries corresponding to circuit.</span>

<span class="sd">        measure_results : tuple of ints, optional</span>
<span class="sd">            optional specification of each measurement result to enable</span>
<span class="sd">            post-selection. If specified, the measurement results are</span>
<span class="sd">            set to the tuple of bits (sequentially) instead of being</span>
<span class="sd">            chosen at random.</span>
<span class="sd">        &#39;&#39;&#39;</span>

        <span class="k">if</span> <span class="n">cbits</span> <span class="ow">and</span> <span class="nb">len</span><span class="p">(</span><span class="n">cbits</span><span class="p">)</span> <span class="o">==</span> <span class="bp">self</span><span class="o">.</span><span class="n">qc</span><span class="o">.</span><span class="n">num_cbits</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">cbits</span> <span class="o">=</span> <span class="n">cbits</span>
        <span class="k">elif</span> <span class="bp">self</span><span class="o">.</span><span class="n">qc</span><span class="o">.</span><span class="n">num_cbits</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">cbits</span> <span class="o">=</span> <span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">*</span> <span class="bp">self</span><span class="o">.</span><span class="n">qc</span><span class="o">.</span><span class="n">num_cbits</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">cbits</span> <span class="o">=</span> <span class="kc">None</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">state</span> <span class="o">=</span> <span class="kc">None</span>

        <span class="k">if</span> <span class="n">state</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">mode</span> <span class="o">==</span> <span class="s2">&quot;density_matrix_simulator&quot;</span> <span class="ow">and</span> <span class="n">state</span><span class="o">.</span><span class="n">isket</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">state</span> <span class="o">=</span> <span class="n">ket2dm</span><span class="p">(</span><span class="n">state</span><span class="p">)</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">state</span> <span class="o">=</span> <span class="n">state</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">probability</span> <span class="o">=</span> <span class="mi">1</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">op_index</span> <span class="o">=</span> <span class="mi">0</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">measure_results</span> <span class="o">=</span> <span class="n">measure_results</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">measure_ind</span> <span class="o">=</span> <span class="mi">0</span></div>

    <span class="k">def</span> <span class="nf">_compute_unitary</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">U_list</span><span class="p">,</span> <span class="n">inds_list</span><span class="p">):</span>
        <span class="sd">&#39;&#39;&#39;</span>
<span class="sd">        Compute unitary corresponding to a product of unitaries in U_list</span>
<span class="sd">        and expand it to size of circuit.</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        U_list: list of Qobj</span>
<span class="sd">            list of predefined unitaries.</span>

<span class="sd">        inds_list: list of list of int</span>
<span class="sd">            list of qubit indices corresponding to each unitary in U_list</span>

<span class="sd">        Returns</span>
<span class="sd">        -------</span>
<span class="sd">        U: Qobj</span>
<span class="sd">            resultant unitary</span>
<span class="sd">        &#39;&#39;&#39;</span>

        <span class="n">U_overall</span><span class="p">,</span> <span class="n">overall_inds</span> <span class="o">=</span> <span class="n">gate_sequence_product</span><span class="p">(</span><span class="n">U_list</span><span class="p">,</span>
                                                        <span class="n">inds_list</span><span class="o">=</span><span class="n">inds_list</span><span class="p">,</span>
                                                        <span class="n">expand</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>

        <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">overall_inds</span><span class="p">)</span> <span class="o">!=</span> <span class="bp">self</span><span class="o">.</span><span class="n">qc</span><span class="o">.</span><span class="n">N</span><span class="p">:</span>
            <span class="n">U_overall</span> <span class="o">=</span> <span class="n">expand_operator</span><span class="p">(</span><span class="n">U_overall</span><span class="p">,</span>
                                        <span class="n">N</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">qc</span><span class="o">.</span><span class="n">N</span><span class="p">,</span>
                                        <span class="n">targets</span><span class="o">=</span><span class="n">overall_inds</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">U_overall</span>

<div class="viewcode-block" id="CircuitSimulator.run"><a class="viewcode-back" href="../../../apidoc/classes.html#qutip.qip.CircuitSimulator.run">[docs]</a>    <span class="k">def</span> <span class="nf">run</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">state</span><span class="p">,</span> <span class="n">cbits</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">measure_results</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
        <span class="sd">&#39;&#39;&#39;</span>
<span class="sd">        Calculate the result of one instance of circuit run.</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        state : ket or oper</span>
<span class="sd">                state vector or density matrix input.</span>
<span class="sd">        cbits : List of ints, optional</span>
<span class="sd">                initialization of the classical bits.</span>
<span class="sd">        measure_results : tuple of ints, optional</span>
<span class="sd">                optional specification of each measurement result to enable</span>
<span class="sd">                post-selection. If specified, the measurement results are</span>
<span class="sd">                set to the tuple of bits (sequentially) instead of being</span>
<span class="sd">                chosen at random.</span>

<span class="sd">        Returns</span>
<span class="sd">        -------</span>
<span class="sd">        result: CircuitResult</span>
<span class="sd">            Return a CircuitResult object containing</span>
<span class="sd">            output state and probability.</span>
<span class="sd">        &#39;&#39;&#39;</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">initialize</span><span class="p">(</span><span class="n">state</span><span class="p">,</span> <span class="n">cbits</span><span class="p">,</span> <span class="n">measure_results</span><span class="p">)</span>
        <span class="k">for</span> <span class="n">_</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">ops</span><span class="p">)):</span>
            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">step</span><span class="p">()</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
                <span class="k">break</span>
        <span class="k">return</span> <span class="n">CircuitResult</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">state</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">probability</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">cbits</span><span class="p">)</span></div>

<div class="viewcode-block" id="CircuitSimulator.run_statistics"><a class="viewcode-back" href="../../../apidoc/classes.html#qutip.qip.CircuitSimulator.run_statistics">[docs]</a>    <span class="k">def</span> <span class="nf">run_statistics</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">state</span><span class="p">,</span> <span class="n">cbits</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
        <span class="sd">&#39;&#39;&#39;</span>
<span class="sd">        Calculate all the possible outputs of a circuit</span>
<span class="sd">        (varied by measurement gates).</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        state : ket</span>
<span class="sd">                state to be observed on specified by density matrix.</span>
<span class="sd">        cbits : List of ints, optional</span>
<span class="sd">                initialization of the classical bits.</span>

<span class="sd">        Returns</span>
<span class="sd">        -------</span>
<span class="sd">        result: CircuitResult</span>
<span class="sd">            Return a CircuitResult object containing</span>
<span class="sd">            output states and and their probabilities.</span>
<span class="sd">        &#39;&#39;&#39;</span>

        <span class="n">probabilities</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="n">states</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="n">cbits_results</span> <span class="o">=</span> <span class="p">[]</span>

        <span class="n">num_measurements</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="nb">list</span><span class="p">(</span><span class="nb">filter</span><span class="p">(</span>
                                <span class="k">lambda</span> <span class="n">x</span><span class="p">:</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">Measurement</span><span class="p">),</span>
                                <span class="bp">self</span><span class="o">.</span><span class="n">qc</span><span class="o">.</span><span class="n">gates</span><span class="p">)))</span>

        <span class="k">for</span> <span class="n">results</span> <span class="ow">in</span> <span class="n">product</span><span class="p">(</span><span class="s2">&quot;01&quot;</span><span class="p">,</span> <span class="n">repeat</span><span class="o">=</span><span class="n">num_measurements</span><span class="p">):</span>
            <span class="n">run_result</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">run</span><span class="p">(</span><span class="n">state</span><span class="p">,</span> <span class="n">cbits</span><span class="o">=</span><span class="n">cbits</span><span class="p">,</span> <span class="n">measure_results</span><span class="o">=</span><span class="n">results</span><span class="p">)</span>
            <span class="n">final_state</span> <span class="o">=</span> <span class="n">run_result</span><span class="o">.</span><span class="n">get_final_states</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span>
            <span class="n">probability</span> <span class="o">=</span> <span class="n">run_result</span><span class="o">.</span><span class="n">get_probabilities</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span>
            <span class="n">states</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">final_state</span><span class="p">)</span>
            <span class="n">probabilities</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">probability</span><span class="p">)</span>
            <span class="n">cbits_results</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">cbits</span><span class="p">)</span>

        <span class="k">return</span> <span class="n">CircuitResult</span><span class="p">(</span><span class="n">states</span><span class="p">,</span> <span class="n">probabilities</span><span class="p">,</span> <span class="n">cbits_results</span><span class="p">)</span></div>

<div class="viewcode-block" id="CircuitSimulator.step"><a class="viewcode-back" href="../../../apidoc/classes.html#qutip.qip.CircuitSimulator.step">[docs]</a>    <span class="k">def</span> <span class="nf">step</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&#39;&#39;&#39;</span>
<span class="sd">        Return state after one step of circuit evolution</span>
<span class="sd">        (gate or measurement).</span>

<span class="sd">        Returns</span>
<span class="sd">        -------</span>
<span class="sd">        state : ket or oper</span>
<span class="sd">            state after one evolution step.</span>
<span class="sd">        &#39;&#39;&#39;</span>

        <span class="n">op</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">ops</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">op_index</span><span class="p">]</span>
        <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">op</span><span class="p">,</span> <span class="n">Measurement</span><span class="p">):</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_apply_measurement</span><span class="p">(</span><span class="n">op</span><span class="p">)</span>
        <span class="k">elif</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">op</span><span class="p">,</span> <span class="nb">tuple</span><span class="p">):</span>
            <span class="n">operation</span><span class="p">,</span> <span class="n">U</span> <span class="o">=</span> <span class="n">op</span>
            <span class="n">apply_gate</span> <span class="o">=</span> <span class="nb">all</span><span class="p">([</span><span class="bp">self</span><span class="o">.</span><span class="n">cbits</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="k">for</span> <span class="n">i</span>
                              <span class="ow">in</span> <span class="n">operation</span><span class="o">.</span><span class="n">classical_controls</span><span class="p">])</span>
            <span class="k">if</span> <span class="n">apply_gate</span><span class="p">:</span>
                <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">precompute_unitary</span><span class="p">:</span>
                    <span class="n">U</span> <span class="o">=</span> <span class="n">expand_operator</span><span class="p">(</span><span class="n">U</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">qc</span><span class="o">.</span><span class="n">N</span><span class="p">,</span>
                                        <span class="n">operation</span><span class="o">.</span><span class="n">get_inds</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">qc</span><span class="o">.</span><span class="n">N</span><span class="p">))</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">_evolve_state</span><span class="p">(</span><span class="n">U</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_evolve_state</span><span class="p">(</span><span class="n">op</span><span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">op_index</span> <span class="o">+=</span> <span class="mi">1</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">state</span></div>

    <span class="k">def</span> <span class="nf">_evolve_state</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">U</span><span class="p">):</span>
        <span class="sd">&#39;&#39;&#39;</span>
<span class="sd">        Applies unitary to state.</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        U: Qobj</span>
<span class="sd">            unitary to be applied.</span>
<span class="sd">        &#39;&#39;&#39;</span>

        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">mode</span> <span class="o">==</span> <span class="s2">&quot;state_vector_simulator&quot;</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_evolve_ket</span><span class="p">(</span><span class="n">U</span><span class="p">)</span>
        <span class="k">elif</span> <span class="bp">self</span><span class="o">.</span><span class="n">mode</span> <span class="o">==</span> <span class="s2">&quot;density_matrix_simulator&quot;</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_evolve_dm</span><span class="p">(</span><span class="n">U</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">NotImplementedError</span><span class="p">(</span>
                <span class="s2">&quot;mode </span><span class="si">{}</span><span class="s2"> is not available.&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">mode</span><span class="p">))</span>

    <span class="k">def</span> <span class="nf">_evolve_ket</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">U</span><span class="p">):</span>
        <span class="sd">&#39;&#39;&#39;</span>
<span class="sd">        Applies unitary to ket state.</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        U: Qobj</span>
<span class="sd">            unitary to be applied.</span>
<span class="sd">        &#39;&#39;&#39;</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">state</span> <span class="o">=</span> <span class="n">U</span> <span class="o">*</span> <span class="bp">self</span><span class="o">.</span><span class="n">state</span>

    <span class="k">def</span> <span class="nf">_evolve_dm</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">U</span><span class="p">):</span>
        <span class="sd">&#39;&#39;&#39;</span>
<span class="sd">        Applies unitary to density matrix state.</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        U: Qobj</span>
<span class="sd">            unitary to be applied.</span>
<span class="sd">        &#39;&#39;&#39;</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">state</span> <span class="o">=</span> <span class="n">U</span> <span class="o">*</span> <span class="bp">self</span><span class="o">.</span><span class="n">state</span> <span class="o">*</span> <span class="n">U</span><span class="o">.</span><span class="n">dag</span><span class="p">()</span>

    <span class="k">def</span> <span class="nf">_apply_measurement</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">operation</span><span class="p">):</span>
        <span class="sd">&#39;&#39;&#39;</span>
<span class="sd">        Applies measurement gate specified by operation to current state.</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        operation: :class:`.Measurement`</span>
<span class="sd">            Measurement gate in a circuit object.</span>
<span class="sd">        &#39;&#39;&#39;</span>

        <span class="n">states</span><span class="p">,</span> <span class="n">probabilities</span> <span class="o">=</span> <span class="n">operation</span><span class="o">.</span><span class="n">measurement_comp_basis</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">state</span><span class="p">)</span>

        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">mode</span> <span class="o">==</span> <span class="s2">&quot;state_vector_simulator&quot;</span><span class="p">:</span>
            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">measure_results</span><span class="p">:</span>
                <span class="n">i</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">measure_results</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">measure_ind</span><span class="p">])</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">measure_ind</span> <span class="o">+=</span> <span class="mi">1</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">probabilities</span> <span class="o">=</span> <span class="p">[</span><span class="n">p</span><span class="o">/</span><span class="nb">sum</span><span class="p">(</span><span class="n">probabilities</span><span class="p">)</span> <span class="k">for</span> <span class="n">p</span> <span class="ow">in</span> <span class="n">probabilities</span><span class="p">]</span>
                <span class="n">i</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">choice</span><span class="p">([</span><span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">],</span> <span class="n">p</span><span class="o">=</span><span class="n">probabilities</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">probability</span> <span class="o">*=</span> <span class="n">probabilities</span><span class="p">[</span><span class="n">i</span><span class="p">]</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">state</span> <span class="o">=</span> <span class="n">states</span><span class="p">[</span><span class="n">i</span><span class="p">]</span>
            <span class="k">if</span> <span class="n">operation</span><span class="o">.</span><span class="n">classical_store</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">cbits</span><span class="p">[</span><span class="n">operation</span><span class="o">.</span><span class="n">classical_store</span><span class="p">]</span> <span class="o">=</span> <span class="n">i</span>

        <span class="k">elif</span> <span class="bp">self</span><span class="o">.</span><span class="n">mode</span> <span class="o">==</span> <span class="s2">&quot;density_matrix_simulator&quot;</span><span class="p">:</span>
            <span class="n">states</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="nb">filter</span><span class="p">(</span><span class="k">lambda</span> <span class="n">x</span><span class="p">:</span> <span class="n">x</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">,</span> <span class="n">states</span><span class="p">))</span>
            <span class="n">probabilities</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="nb">filter</span><span class="p">(</span><span class="k">lambda</span> <span class="n">x</span><span class="p">:</span> <span class="n">x</span> <span class="o">!=</span> <span class="mi">0</span><span class="p">,</span> <span class="n">probabilities</span><span class="p">))</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">state</span> <span class="o">=</span> <span class="nb">sum</span><span class="p">(</span><span class="n">p</span> <span class="o">*</span> <span class="n">s</span> <span class="k">for</span> <span class="n">s</span><span class="p">,</span> <span class="n">p</span> <span class="ow">in</span> <span class="nb">zip</span><span class="p">(</span><span class="n">states</span><span class="p">,</span> <span class="n">probabilities</span><span class="p">))</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">NotImplementedError</span><span class="p">(</span>
                <span class="s2">&quot;mode </span><span class="si">{}</span><span class="s2"> is not available.&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">mode</span><span class="p">))</span></div>
</pre></div>

           </div>
           
          </div>
          <footer>

  <hr/>

  <div role="contentinfo">
    <p>
        &#169; <a href="../../../copyright.html">Copyright</a> 2011 to 2021 inclusive, QuTiP developers and contributors.
      <span class="lastupdated">
        Last updated on Dec 12, 2022.
      </span>

    </p>
  </div>
    
    
    
    Built with <a href="https://www.sphinx-doc.org/">Sphinx</a> using a
    
    <a href="https://github.com/readthedocs/sphinx_rtd_theme">theme</a>
    
    provided by <a href="https://readthedocs.org">Read the Docs</a>. 

</footer>
        </div>
      </div>

    </section>

  </div>
  

  <script type="text/javascript">
      jQuery(function () {
          SphinxRtdTheme.Navigation.enable(true);
      });
  </script>

  
  
    
   

</body>
</html>